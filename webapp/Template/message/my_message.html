{% extends "stock_base.html" %}
{% block current_user %}
    {{ current_user.username }}
{% endblock %}

{% block body %}
    <style>

        ul li {
            list-style: none
        }

        .my_profile {
            height: 74px;
            width: 74px;
            float: left;
            margin-top: 20px;
            margin-left: 10px;
            border: 0.1px solid darkgray
        }

        .mytext {
            height: 150px;
            width: 96%;
            margin-top: 5px;
            margin-left: 2%;
        }

        .mytitle {
            height: 20px;
            width: 96%;
            margin-top: 15px;
            margin-left: 2%;
        }

        .fbbutton {
            height: 30px;
            width: 100px;
            background-color: #555555;
            border: none;
            color: white;
            text-align: center;
            font-kerning: normal;
            text-decoration: none;
            display: inline-block;
            font-family: KaiTi;
            border-radius: 12px;
            font-size: 20px;
            float: right;
            margin-top: 10px;
            margin-right: 2%;
        }

        .grbox {
            height: 220px;
            width: 260px;
            background-color: lightyellow;
            position: absolute;
            z-index: 999;
            display: none;
        }

        .box_top {
            height: 110px;
            width: 260px;
            float: left;
            background-color: aliceblue;
            margin-top: 0;
            position: absolute;
        }

        .box_photo {
            height: 80px;
            width: 80px;
            border-radius: 50%;
            border: none;
            overflow: hidden;
            margin-top: 60px;
            float: left;
            margin-left: 90px;
            background-color: white;
            position: absolute;
        }

        .my_photo {
            height: 50px;
            width: 50px;
            float: left;
            margin-top: 0;
            margin-left: 10px;
            background-color: #afd9ee;
            border-radius: 50%;
            border: 2px solid #fff;
            overflow: hidden;
        }

        .comment_avatar {
            height: 30px;
            width: 30px;
            float: left;
            margin-top: 0;
            margin-left: 10px;
            background-color: #afd9ee;
            border-radius: 50%;
            border: 2px solid #fff;
            overflow: hidden;
        }

        .box_bottom {
            height: 60px;
            width: 260px;
            margin-top: 155px;
            position: absolute;
            text-align: center;
        }

        .item_prose {
            height: 50px;
            width: 60px;
            float: left;
            margin-top: 5px;
            margin-left: -2px;
            text-align: center;
            list-style: none;
            list-style-type: none;
        }

        .item_follow {
            height: 50px;
            width: 60px;
            float: left;
            margin-top: 5px;
            margin-left: 8px;
            text-align: center;
            list-style: none;
            list-style-type: none;
        }

        .item_fans {
            height: 50px;
            width: 60px;
            float: left;
            margin-top: 5px;
            margin-left: 8px;
            text-align: center;
            list-style: none;
            list-style-type: none;
        }

        .text_count {
            height: 19px;
            width: 36px;
            float: left;
            margin-top: 5px;
            margin-left: 12px;
            font-size: 18px;
            font-family: 'Adobe Heiti Std';
            color: black;
        }

        .text_atr {
            height: 19px;
            width: 36px;
            text-align: center;
            float: left;
            margin-top: 2px;
            margin-left: 12px;
            font-size: 15px;
            font-family: 'Adobe Heiti Std';
            color: black;
        }

        .line_bor {
            height: 40px;
            width: 1px;
            float: left;
            margin-top: 5px;
            margin-left: 8px;
            background-color: black;
        }

        .post_function {
            float: left;
            width: 100%;
            height: 25px;
            background-color: white;
            margin-top: 5px;
            display: inline-block;
            border-top: 0.1px solid darkgray;
        }

        .to_retrant {
            width: 7.3%;
            border-radius: 5px;
            background-color: white;
            float: left;
            margin-left: 13%;
            margin-top: 0;
            border: none;
            text-align: center;
        }

        .to_comment {
            width: 7.3%;
            border-radius: 5px;
            background-color: white;
            float: left;
            margin-left: 13%;
            margin-top: 0;
            border: none;
            text-align: center;
        }

        .to_upvote {
            width: 7.3%;
            border-radius: 5px;
            background-color: white;
            float: left;
            margin-left: 13%;
            margin-top: 0;
            border: none;
            text-align: center;
        }

        .line {
            width: 0.05%;
            height: 19px;
            background-color: darkgray;
            float: left;
            margin-left: 13%;
            margin-top: 3px;
        }

        .to_follow {
            border-radius: 5px;
            float: right;
            background-color: lightyellow;
            margin-right: 15px;
            margin-top: 10px;
            border: none;
            text-align: center;
        }

        .to_reply {
            border-radius: 5px;
            float: right;
            background-color: #edeeff;
            margin-right: 15px;
            margin-top: 0;
            border: none;
            text-align: center;
        }

        .no_follow {
            border-radius: 5px;
            float: right;
            background-color: lightyellow;
            margin-right: 15px;
            margin-top: 10px;
            border: none;
            text-align: center;
        }

        .post_comment {
            display: none;
            width: 100%;
            height: auto;
            float: left;
            margin-left: 0;
            margin-top: 10px;
        }

        .comment_input {
            width: 80%;
            height: 20px;
            float: left;
            margin-left: 10px;
            margin-top: 5px;
            border-radius: 10px;
        }

        .to_release {
            border-radius: 5px;
            background-color: #edeeff;
            float: left;
            margin-left: 20px;
            margin-top: 5px;
            border: none;
            text-align: center;
        }

        .to_withdraw {
            border-radius: 5px;
            background-color: #edeeff;
            float: left;
            margin-left: 20px;
            margin-top: 5px;
            border: none;
            text-align: center;
        }

        .person {
            width: auto;
            height: 18px;
            float: left;
            font-size: 15px;
            font-weight: 800;
            color: black;
        }

        .reply_area {
            width: 100%;
            height: auto;
            float: left;
            margin-left: 0;
            margin-top: 0;
            background-color: lightcyan;
        }

    </style>

    {#    发私信模态框#}
    <div class="modal hide fade" id="send_personal_message_modal" tabindex="-1" role="dialog"
         aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="myModalLabel">发送私信</h4>
                </div>
                <div class="modal-body">
                    <div class="input-group" style="margin-left:10px;width:450px">
                        <input type="text" class="span3 form-control" id="reciver" style="height: 30px;width:95%"
                               placeholder="接收人" name="receiver">

                        <ul class="dropdown-menu" role="menu" style="left: 0!important;"></ul>
                    </div>
                    <div class="input-group" style="width:450px">
                        <textarea id="message_content" class="mytext" placeholder=""></textarea>
                        <ul class="dropdown-menu" role="menu" style="left: 0!important;"></ul>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="send_personal_message()">发送</button>
                </div>

            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div>
    {#    管理员群发消息模态框#}
    <div class="modal hide fade" id="send_admin_message_modal" tabindex="-1" role="dialog"
         aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="myModalLabel">管理员消息</h4>
                </div>
                <div class="modal-body">
                    <div class="input-group" style="margin-left:10px;height:200px;overflow:auto;float:left">
                        <table id="user_list">
                            <thead>
                            <tr>
                                <th>选中</th>
                                <th>用户</th>
                            </tr>
                            </thead>
                            <tbody id="user_tbody">

                            </tbody>
                        </table>
                    </div>
                    <div class="input-group" style="width:300px;float:left">
                        <textarea id="admin_message_content" class="mytext" placeholder=""></textarea>
                        <ul class="dropdown-menu" role="menu" style="left: 0!important;"></ul>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="send_admin_message()">发送</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div>
    {#    更多消息模态框#}
    <div class="modal hide fade" id="more_info_modal" tabindex="-1" role="dialog"
         aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="myModalLabel">消息</h4>
                </div>
                <div class="modal-body" id='div_more_message'>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>

                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div>

    {#    上传图片模态框#}
    <div class="modal hide fade" id="photo_upload_modal" tabindex="-1" role="dialog"
         aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="myModalLabel">上传图片</h4>
                </div>
                <div class="modal-body" id='dd'>
                </div>
                <div class="modal-footer">
                    <form action="{{ url_for("message.my_message") }}" enctype='multipart/form-data'
                          method='POST' id="photo_form"
                          style="float: right;margin-right:15px;margin-top:10px;">
                        <input type="file" name="file" id="doc" multiple="multiple"
                               style="width:150px;display: none;"
                               onchange="javascript:setImagePreviews();" accept="image/*"/>
                        <button type="submit" id="photo_to_upload" class="btn btn-primary"
                                style="float:right;margin-right: 0;margin-top:0;">
                            确定
                        </button>
                    </form>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div>

    <div class="span9">
        <div class="content">
            <div class="btn-controls">
                <!--消息发布-->
                <div class="btn-box-row row-fluid">
                    <div class="module span12">
                        <div class="module-body">
                            <div style="margin: auto;width:95%;height:230px;">
                                <div class="mytitle"><h4 style="font-size:18px;font-family: 'Adobe 黑体 Std R'">
                                    有疑问？大家一起来讨论吧!</h4></div>
                                <textarea type="text" id="inputtext" form="photo_form" name="textarea"
                                          class="mytext">{{ text }}</textarea>
                                <button type="submit" id="fbbutton" class="btn btn-primary"
                                        style="float: right;margin-right: 15px;">点击发布
                                </button>
                                <button class="btn btn-primary" style="float: right;margin-right: 15px;"
                                        id="photo_upload_area">
                                    添加图片
                                </button>
                                <form action="{{ url_for("message.my_message") }}" enctype='multipart/form-data'
                                      method='POST' id="reload_form" display="none">
                                </form>
                            </div>
                        </div>
                    </div>
                    <!--消息显示-->
                    <div class="btn-box-row row-fluid">
                        <div class="module span12" style="background-color: rgba(0,0,0,0);border: 0">
                            <div id="myshow" class="module span12" style="background-color: rgba(0,0,0,0);border: 0">
                                <div class="nav" style="float:left;margin:auto;width:100%;background-color:white">
                                    <ul id="mynav" class="nav nav-tabs nav-justified">
                                        <li><a href="#all_message" data-toggle="tab"
                                               onclick="all_message_show()">全部动态</a></li>
                                        <li><a href="#follow_message" data-toggle="tab"
                                               onclick="follow_message_show()">我的关注</a></li>
                                        <li><a href="#my_message" data-toggle="tab"
                                               onclick="myown_message_show()">我的动态</a>
                                        </li>
                                        <li class="active"><a href="#accept_message" data-toggle="tab"
                                                              onclick="accept_message_show()">消息私信</a></li>
                                    </ul>
                                </div>
                                <div id="mytext" class="tab-content" style="margin-left:0 ;width:100%;height:auto;">
                                    <div id="all_message" class="tab-pane fade"
                                         style="float:left;margin-left:0;width:100%;height:auto;">
                                        <div id="all_post" class="module span12"
                                             style="background-color: rgba(0,0,0,0);border:0;float:left;margin-left:0;width:100%;height:auto;"></div>
                                        <ul id="my_pagination" class="pagination"
                                            style="float:right;margin-top: 0"></ul>
                                        <!-- 回复模态框 -->
                                        <div class="modal hide fade in" style="display: none; " id="reply_modal"
                                             tabindex="-1"
                                             role="dialog"
                                             aria-labelledby="myModalLabel"
                                             aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <!-- 模态框头部 -->
                                                    <div class="modal-header">
                                                        <button type="button" class="close" data-dismiss="modal">&times;
                                                        </button>
                                                        <h4 class="modal-title">回复</h4>
                                                    </div>
                                                    <!-- 模态框主体 -->
                                                    <div class="modal-body">
                                                        <div id="reply" style="height:170px;width:500px;margin:0 auto">
                                                        <textarea id="inputreply" class="mytext"
                                                                  placeholder=""></textarea>
                                                        </div>
                                                    </div>
                                                    <!-- 模态框底部 -->
                                                    <div class="modal-footer">
                                                        <button type="button" class="fbbutton" data-dismiss="modal"
                                                                id="myreply">确认回复
                                                        </button>
                                                    </div>
                                                </div><!-- /.modal-content -->
                                            </div><!-- /.modal-dialog -->
                                        </div>
                                    </div>
                                    <div id="follow_message" class="tab-pane fade"
                                         style="float:left;margin-left:0;width:100%;height:auto;">
                                        <div id="follow_post" class="module span12"
                                             style="background-color: rgba(0,0,0,0);border:0;float:left;margin-left:0;width:100%;height:auto;"></div>
                                        <ul id="my_follow_pagination" class="pagination"
                                            style="float:right;margin-top: 0"></ul>
                                        <!-- 回复模态框 -->
                                        <div class="modal hide fade in" style="display: none; " id="reply_follow_modal"
                                             tabindex="-1"
                                             role="dialog"
                                             aria-labelledby="myModalLabel"
                                             aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <!-- 模态框头部 -->
                                                    <div class="modal-header">
                                                        <button type="button" class="close" data-dismiss="modal">&times;
                                                        </button>
                                                        <h4 class="modal-title">回复</h4>
                                                    </div>
                                                    <!-- 模态框主体 -->
                                                    <div class="modal-body">
                                                        <div id="reply" style="height:170px;width:500px;margin:0 auto">
                                                        <textarea id="inputreply_follow" class="mytext"
                                                                  placeholder=""></textarea>
                                                        </div>
                                                    </div>
                                                    <!-- 模态框底部 -->
                                                    <div class="modal-footer">
                                                        <button type="button" class="fbbutton" data-dismiss="modal"
                                                                id="myreply_follow">确认回复
                                                        </button>
                                                    </div>
                                                </div><!-- /.modal-content -->
                                            </div><!-- /.modal-dialog -->
                                        </div>
                                    </div>
                                    <div id="my_message" class="tab-pane fade"
                                         style="float:left;margin-left:0;width:100%;height:auto;">
                                        <div id="my_own_post" class="module span12"
                                             style="background-color: rgba(0,0,0,0);border:0;float:left;margin-left:0;width:100%;height:auto;"></div>
                                        <ul id="my_own_pagination" class="pagination"
                                            style="float:right;margin-top: 0"></ul>
                                        <!-- 回复模态框 -->
                                        <div class="modal hide fade in" style="display: none; " id="reply_myown_modal"
                                             tabindex="-1"
                                             role="dialog"
                                             aria-labelledby="myModalLabel"
                                             aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <!-- 模态框头部 -->
                                                    <div class="modal-header">
                                                        <button type="button" class="close" data-dismiss="modal">&times;
                                                        </button>
                                                        <h4 class="modal-title">回复</h4>
                                                    </div>
                                                    <!-- 模态框主体 -->
                                                    <div class="modal-body">
                                                        <div id="reply" style="height:170px;width:500px;margin:0 auto">
                                                        <textarea id="inputreply_myown" class="mytext"
                                                                  placeholder=""></textarea>
                                                        </div>
                                                    </div>
                                                    <!-- 模态框底部 -->
                                                    <div class="modal-footer">
                                                        <button type="button" class="fbbutton" data-dismiss="modal"
                                                                id="myreply_myown">确认回复
                                                        </button>
                                                    </div>
                                                </div><!-- /.modal-content -->
                                            </div><!-- /.modal-dialog -->
                                        </div>
                                    </div>
                                    <div id="accept_message" class="tab-pane fade in active"
                                         style="float:left;margin-left:0;width:100%;height:auto;">
                                        <div class="span12">
                                            <div class="content">
                                                <div class="module message">
                                                    <div class="module-option clearfix" id="send_message_div">
                                                        <h3 style="float:left">消息列表</h3>
                                                        <div class="pull-right" style="margin-left: 5px">
                                                            <a onclick="refresh()"
                                                               class="btn btn-primary">刷新列表</a>
                                                        </div>
                                                        <div class="pull-right" style="margin-left: 5px">
                                                            <a data-toggle="modal"
                                                               data-target="#send_personal_message_modal"
                                                               class="btn btn-primary">发送私信</a>
                                                        </div>

                                                    </div>
                                                    <div class="module-body table">
                                                        <table class="table table-message" id="table_message"
                                                               style="width:100%">
                                                            <thead>
                                                            <tr class="heading">
                                                                <td class="cell-icon"></td>
                                                                <td class="cell-title">消息</td>
                                                                <td class="cell-status hidden-phone hidden-tablet"
                                                                    style="text-align: center">状态
                                                                </td>
                                                                <td class="cell-text align-right">时间</td>
                                                            </tr>
                                                            </thead>
                                                            <tbody id="table_message_tbody"></tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div><!--/.content-->
                                        </div><!--/.span9-->
                                    </div>
                                    <!-- 个人信息显示框 -->
                                    <div id="box" class="grbox">
                                        <div class="box_top"></div>
                                        <img class="box_photo" src="">
                                        <div class="box_bottom">
                                            <ul>
                                                <li class="item_prose">
                                                    <span class="text_count" id="fb"></span>
                                                    <br/><span class="text_atr">发布</span></li>
                                                <li class="line_bor"></li>
                                                <li class="item_follow">
                                                    <span class="text_count" id="gz"></span>
                                                    <br/><span class="text_atr">关注</span></li>
                                                <li class="line_bor"></li>
                                                <li class="item_fans">
                                                    <span class="text_count" id="fs"></span>
                                                    <br/><span class="text_atr">粉丝</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    <!-- 转发模态框 -->
                                    <div class="modal hide fade in" style="display: none; " id="all_message_modal"
                                         tabindex="-1"
                                         role="dialog"
                                         aria-labelledby="myModalLabel"
                                         aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <!-- 模态框头部 -->
                                                <div class="modal-header">
                                                    <button type="button" class="close" data-dismiss="modal">&times;
                                                    </button>
                                                    <h4 class="modal-title">转发</h4>
                                                </div>
                                                <!-- 模态框主体 -->
                                                <div class="modal-body">
                                                    <div id="retrant" style="height:170px;width:500px;margin:0 auto">
                                                        <textarea id="inputretrant" class="mytext"
                                                                  placeholder=""></textarea>
                                                    </div>
                                                </div>
                                                <!-- 模态框底部 -->
                                                <div class="modal-footer">
                                                    <button type="button" class="fbbutton" data-dismiss="modal"
                                                            id="myid">确认发布
                                                    </button>
                                                </div>
                                            </div><!-- /.modal-content -->
                                        </div><!-- /.modal-dialog -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            var formData, mytext;
            //选择图片预览
            function setImagePreviews() {
                $("#photo_upload_modal").modal('show');
                var docObj = document.getElementById("doc");
                var dd = document.getElementById("dd");
                dd.innerHTML = "";
                var fileList = docObj.files;
                if (fileList.length > 9) {
                    alert('单条动态图片不得超过9张！');
                    return false;
                }
                for (var i = 0; i < fileList.length; i++) {
                    dd.innerHTML += "<div style='float:left' > <img class='my_profile' id='img" + i + "'  /> </div>";
                    var imgObjPreview = document.getElementById("img" + i);
                    if (docObj.files && docObj.files[i]) {
                        //火狐下，直接设img属性
                        imgObjPreview.style.display = 'block';
                        imgObjPreview.style.width = '74px';
                        imgObjPreview.style.height = '74px';
                        //imgObjPreview.src = docObj.files[0].getAsDataURL();
                        //火狐7以上版本不能用上面的getAsDataURL()方式获取，需要一下方式
                        imgObjPreview.src = window.URL.createObjectURL(docObj.files[i]);
                    }
                    else {
                        //IE下，使用滤镜
                        docObj.select();
                        var imgSrc = document.selection.createRange().text;
                        alert(imgSrc);
                        var localImagId = document.getElementById("img" + i);
                        //必须设置初始大小
                        localImagId.style.width = "74px";
                        localImagId.style.height = "74px";
                        //图片异常的捕捉，防止用户修改后缀来伪造图片
                        try {
                            localImagId.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)";
                            localImagId.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = imgSrc;
                        }
                        catch (e) {
                            alert("您上传的图片格式不正确，请重新选择!");
                            return false;
                        }
                        imgObjPreview.style.display = 'none';
                        document.selection.empty();
                    }
                }
                return true;
            }
            //打开上传图像模态框
            $("#photo_upload_area").click(function () {
                $("#doc").click();
            });
            //发表文章并更新界面
            $("#fbbutton").click(function () {
                mytext = document.getElementById('inputtext').value;
                $.ajax({
                    type: 'POST',
                    url: '{{url_for("message_api.to_input_text")}}',
                    data: {
                        input_text: mytext,
                        photo_num:{{ number }},
                        name: '{{ name }}'
                    },
                    dataType: 'json',
                    success: function (data) {
                        $("#reload_form").submit();
                    }
                })
            });
        </script>

        <!-- 全部动态事件 -->
        <script>
            var parentid, mycomment, followid, myownid, commentid;

            //展开个人信息
            $("div#all_post").on("mouseover", ".person", function () {
                parentid = $(this).parent().parent().attr('id');
                $("#box").val(parentid);
                $.ajax({
                    type: 'GET',
                    url: '{{url_for("message_api.person_box")}}',
                    data: {
                        postID: parentid
                    },
                    dataType: 'json',
                    success: function (data) {
                        var myimg = "/static/avatar/" + data.my_avatar + "?timestamp=" + new Date().getTime()
                        $(".box_photo").attr("src", myimg);
                        $("#fb").empty();
                        $("#fb").append("<b style='float:left;width:36px;font-size: 18px;text-align: center;'>" + data.postnum + "</b>");
                        $("#gz").empty();
                        $("#gz").append("<b style='float:left;width:36px;font-size: 18px;text-align: center;'>" + data.followednum + "</b>");
                        $("#fs").empty();
                        $("#fs").append("<b style='float:left;width:36px;font-size: 18px;text-align: center;'>" + data.followernum + "</b>");
                    }
                });

                var thisdiv = document.getElementById("poster_" + parentid);
                p = getElementLeft(thisdiv);
                q = getElementTop(thisdiv);
                document.getElementById("box").style.display = "block";
                $("#box").css("left", p + 20);
                $("#box").css("top", q + 20);
            });

            //收起个人信息
            $("div#all_post").on("mouseleave", ".person", function () {
                document.getElementById("box").style.display = "none";
            });

            //展开评论区
            $("div#all_post").on("click", ".to_comment", function () {
                parentid = $(this).parent().parent().attr('id');
                $("#comment_area_" + parentid).empty();
                $("#comment_pagination_" + parentid).empty();
                open_comment(parentid);
                $("#post_comment_" + parentid).fadeToggle();
            });

            //收起评论区
            $("div#all_post").on("click", ".to_withdraw", function () {
                parentid = $(this).parent().parent().parent().attr('id');
                $("#post_comment_" + parentid).fadeOut();
                $("#comment_pagination_" + parentid).fadeOut();
            });

            //发布评论
            $("div#all_post").on("click", ".to_release", function () {
                parentid = $(this).parent().parent().parent().attr('id').toString();
                if ($("#comment_input" + parentid).val().length == 0) {
                    alert("评论内容不可为空");
                }
                else {
                    mycomment = $("#comment_input" + parentid).val();
                    $.ajax({
                        type: 'GET',
                        url: '{{url_for("message_api.to_comment")}}',
                        data: {
                            input_comment: mycomment,
                            input_post: parseInt(parentid),
                        },
                        dataType: 'json',
                        success: function (data) {
                            alert("评论成功");
                            $("#comment_input" + parentid).val('');
                            $("#comment_" + parentid).html("评论" + data);
                            open_comment(parentid);
                        }
                    })
                }
            });

            //关注
            $("div#all_post").on("click", ".to_follow", function () {
                parentid = $(this).parent().parent().attr('id');
                $.ajax({
                    type: 'POST',
                    url: '{{url_for("message_api.to_follow")}}',
                    data: {
                        input_post: parseInt(parentid),
                    },
                    dataType: 'json',
                    success: function (data) {
                        alert("关注成功");
                        all_message_show();
                    }
                })
            });

            //取消关注
            $("div#all_post").on("click", ".no_follow", function () {
                parentid = $(this).parent().parent().attr('id');
                $.ajax({
                    type: 'POST',
                    url: '{{url_for("message_api.no_follow")}}',
                    data: {
                        input_post: parseInt(parentid),
                    },
                    dataType: 'json',
                    success: function (data) {
                        alert("取消关注");
                        all_message_show()
                    }
                })
            });

            //点赞
            $("div#all_post").on("click", ".to_upvote", function () {
                parentid = $(this).parent().parent().attr('id');
                $.ajax({
                    type: 'GET',
                    url: '{{url_for("message_api.to_upvote")}}',
                    data: {
                        input_post: parseInt(parentid),
                    },
                    dataType: 'json',
                    success: function (data) {
                        $("#upvote_" + parentid).html("点赞" + data);
                    }
                })
            });

            //打开转发模态框
            $("div#all_post").on("click", ".to_retrant", function () {
                parentid = $(this).parent().parent().attr('id');
                $("#myid").val(parentid);
            });

            //转发发布
            $("div#all_message_modal").on("click", ".fbbutton", function () {
                postid = $(this).val();
                posttext = document.getElementById('inputretrant').value;
                parentid = $(this).parent().parent().attr('id');
                $.ajax({
                    type: 'GET',
                    url: '{{url_for("message_api.to_retrant")}}',
                    data: {
                        get_id: parseInt(postid),
                        get_text: posttext,
                    },
                    dataType: 'json',
                    success: function (data) {
                        alert("转发成功");
                        $("#retrant_" + parentid).html("转发" + data);
                        $("#F_retrant_" + parentid).html("转发" + data);
                    }
                });
            })

            //打开回复模态框
            $("div#all_post").on("click", ".to_reply", function () {
                parentid = $(this).parent().parent().parent().parent().attr('id');
                commentid = $(this).attr('id');
                $("#myreply").val(commentid);
            });

            //回复发布
            $("div#reply_modal").on("click", ".fbbutton", function () {
                thisid = $(this).val();
                posttext = document.getElementById('inputreply').value;
                $.ajax({
                    type: 'POST',
                    url: '{{url_for("message_api.to_reply")}}',
                    data: {
                        get_id: parseInt(thisid),
                        get_text: posttext
                    },
                    dataType: 'json',
                    success: function (data) {
                        alert("回复成功");
                        $('#reply_' + thisid).empty();
                        my_reply(thisid);
                    }
                });
            })

        </script>

        <!-- 我的关注事件 -->
        <script>
            //展开个人信息
            $("div#follow_post").on("mouseover", ".person", function () {
                parentid = $(this).parent().parent().attr('id');
                followid = parentid.substring(2);
                console.log(followid);
                $("#box").val(followid);
                $.ajax({
                    type: 'GET',
                    url: '{{url_for("message_api.person_box")}}',
                    data: {
                        postID: followid
                    },
                    dataType: 'json',
                    success: function (data) {
                        var myimg = "/static/avatar/" + data.my_avatar + "?timestamp=" + new Date().getTime()
                        $(".box_photo").attr("src", myimg);
                        $("#fb").empty();
                        $("#fb").append("<b style='float:left;font-size: 18px;width: 36px;text-align: center;'>" + data.postnum + "</b>")
                        $("#gz").empty();
                        $("#gz").append("<b style='float:left;font-size: 18px;width: 36px;text-align: center;'>" + data.followednum + "</b>")
                        $("#fs").empty();
                        $("#fs").append("<b style='float:left;font-size: 18px;width: 36px;text-align: center;'>" + data.followernum + "</b>")
                    }
                });

                var thisdiv = document.getElementById("F_poster_" + followid);
                p = getElementLeft(thisdiv);
                q = getElementTop(thisdiv);
                document.getElementById("box").style.display = "block";
                $("#box").css("left", p + 20);
                $("#box").css("top", q + 20);
            });

            //收起个人信息
            $("div#follow_post").on("mouseleave", ".person", function () {
                document.getElementById("box").style.display = "none";
            });

            //展开评论区
            $("div#follow_post").on("click", ".to_comment", function () {
                parentid = $(this).parent().parent().attr('id');
                followid = parentid.substring(2);
                $("#F_comment_area_" + followid).empty();
                $("#F_comment_pagination_" + followid).empty();
                open_comment_follow(followid);
                $("#F_post_comment_" + followid).fadeToggle();
            });

            //收起评论区
            $("div#follow_post").on("click", ".to_withdraw", function () {
                parentid = $(this).parent().parent().parent().attr('id');
                followid = parentid.substring(2);
                $("#F_post_comment_" + followid).fadeOut();
                $("#F_comment_pagination_" + followid).fadeOut();
            });

            //发布评论
            $("div#follow_post").on("click", ".to_release", function () {
                parentid = $(this).parent().parent().parent().attr('id').toString();
                followid = parentid.substring(2);
                if ($("#F_comment_input" + followid).val().length == 0) {
                    alert("评论内容不可为空");
                }
                else {
                    mycomment = $("#F_comment_input" + followid).val();
                    $.ajax({
                        type: 'POST',
                        url: '{{url_for("message_api.to_comment")}}',
                        data: {
                            input_comment: mycomment,
                            input_post: parseInt(followid),
                        },
                        dataType: 'json',
                        success: function (data) {
                            alert("评论成功");
                            $("#F_comment_input" + parentid).val('');
                            $("#F_comment_" + parentid).html("评论" + data);
                            open_comment_follow(followid);
                        }
                    })
                }
            });

            //取消关注
            $("div#follow_post").on("click", ".no_follow", function () {
                parentid = $(this).parent().parent().attr('id');
                followid = parentid.substring(2);
                $.ajax({
                    type: 'POST',
                    url: '{{url_for("message_api.no_follow")}}',
                    data: {
                        input_post: parseInt(followid),
                    },
                    dataType: 'json',
                    success: function (data) {
                        alert("取消关注");
                        follow_message_show()
                    }
                })
            });

            //点赞
            $("div#follow_post").on("click", ".to_upvote", function () {
                parentid = $(this).parent().parent().attr('id');
                followid = parentid.substring(2);
                $.ajax({
                    type: 'GET',
                    url: '{{url_for("message_api.to_upvote")}}',
                    data: {
                        input_post: parseInt(followid),
                    },
                    dataType: 'json',
                    success: function (data) {
                        $("#F_upvote_" + followid).html("点赞" + data);
                    }
                })
            });

            //打开转发模态框
            $("div#follow_post").on("click", ".to_retrant", function () {
                parentid = $(this).parent().parent().attr('id');
                followid = parentid.substring(2);
                $("#myid").val(followid);
            });

            //打开回复模态框
            $("div#follow_post").on("click", ".to_reply", function () {
                parentid = $(this).parent().parent().parent().parent().attr('id');
                commentid = $(this).attr('id');
                $("#myreply_follow").val(commentid);
            });

            //回复发布
            $("div#reply_follow_modal").on("click", ".fbbutton", function () {
                thisid = $(this).val();
                posttext = document.getElementById('inputreply_follow').value;
                $.ajax({
                    type: 'POST',
                    url: '{{url_for("message_api.to_reply")}}',
                    data: {
                        get_id: parseInt(thisid),
                        get_text: posttext
                    },
                    dataType: 'json',
                    success: function (data) {
                        alert("回复成功");
                        $('#F_reply_' + thisid).empty();
                        my_reply_follow(thisid);
                    }
                });
            })

        </script>

        <!-- 我的动态事件 -->
        <script>
            //展开个人信息
            $("div#my_own_post").on("mouseover", ".person", function () {
                parentid = $(this).parent().parent().attr('id');
                myownid = parentid.substring(2);
                $("#box").val(myownid);
                $.ajax({
                    type: 'GET',
                    url: '{{url_for("message_api.person_box")}}',
                    data: {
                        postID: myownid
                    },
                    dataType: 'json',
                    success: function (data) {
                        var myimg = "/static/avatar/" + data.my_avatar + "?timestamp=" + new Date().getTime()
                        $(".box_photo").attr("src", myimg);
                        $("#fb").empty();
                        $("#fb").append("<b style='float:left;font-size: 18px;width: 36px;text-align: center;'>" + data.postnum + "</b>")
                        $("#gz").empty();
                        $("#gz").append("<b style='float:left;font-size: 18px;width: 36px;text-align: center;'>" + data.followednum + "</b>")
                        $("#fs").empty();
                        $("#fs").append("<b style='float:left;font-size: 18px;width: 36px;text-align: center;'>" + data.followernum + "</b>")
                    }
                });

                var thisdiv = document.getElementById("M_poster_" + myownid);
                p = getElementLeft(thisdiv);
                q = getElementTop(thisdiv);
                document.getElementById("box").style.display = "block";
                $("#box").css("left", p + 20);
                $("#box").css("top", q + 20);

            });

            //收起个人信息
            $("div#my_own_post").on("mouseleave", ".person", function () {
                document.getElementById("box").style.display = "none";
            });

            //展开评论区
            $("div#my_own_post").on("click", ".to_comment", function () {
                parentid = $(this).parent().parent().attr('id');
                myownid = parentid.substring(2);
                $("#M_comment_area_" + myownid).empty();
                $("#M_comment_pagination_" + myownid).empty();
                open_comment_myown(myownid);
                $("#M_post_comment_" + myownid).fadeToggle();
            });

            //收起评论区
            $("div#my_own_post").on("click", ".to_withdraw", function () {
                parentid = $(this).parent().parent().parent().attr('id');
                myownid = parentid.substring(2);
                $("#M_post_comment_" + myownid).fadeOut();
                $("#M_comment_pagination_" + myownid).fadeOut();
            });

            //发布评论
            $("div#my_own_post").on("click", ".to_release", function () {
                parentid = $(this).parent().parent().parent().attr('id').toString();
                myownid = parentid.substring(2);
                if ($("#M_comment_input" + myownid).val().length == 0) {
                    alert("评论内容不可为空");
                }
                else {
                    mycomment = $("#M_comment_input" + myownid).val();
                    $.ajax({
                        type: 'POST',
                        url: '{{url_for("message_api.to_comment")}}',
                        data: {
                            input_comment: mycomment,
                            input_post: parseInt(myownid),
                        },
                        dataType: 'json',
                        success: function (data) {
                            alert("评论成功");
                            $("#M_comment_input" + parentid).val('');
                            $("#M_comment_" + parentid).html("评论" + data);
                            open_comment_myown(myownid);
                        }
                    })
                }
            });

            //点赞
            $("div#my_own_post").on("click", ".to_upvote", function () {
                parentid = $(this).parent().parent().attr('id');
                myownid = parentid.substring(2);
                $.ajax({
                    type: 'GET',
                    url: '{{url_for("message_api.to_upvote")}}',
                    data: {
                        input_post: parseInt(myownid),
                    },
                    dataType: 'json',
                    success: function (data) {
                        $("#M_upvote_" + myownid).html("点赞" + data);
                    }
                })
            });

            //打开回复模态框
            $("div#my_own_post").on("click", ".to_reply", function () {
                parentid = $(this).parent().parent().parent().parent().attr('id');
                commentid = $(this).attr('id');
                $("#myreply_myown").val(commentid);
            });

            //回复发布
            $("div#reply_myown_modal").on("click", ".fbbutton", function () {
                thisid = $(this).val();
                posttext = document.getElementById('inputreply_myown').value;
                $.ajax({
                    type: 'POST',
                    url: '{{url_for("message_api.to_reply")}}',
                    data: {
                        get_id: parseInt(thisid),
                        get_text: posttext
                    },
                    dataType: 'json',
                    success: function (data) {
                        alert("回复成功");
                        $('#M_reply_' + thisid).empty();
                        my_reply_myown(thisid);
                    }
                });
            })

        </script>

        <!-- 功能模块 -->
        <script>
            var postcomment, postcommentfollow, postcommentmyown, postfollow, followindex;
            function onImgError(dom) {
                dom.style.display = "none"
            }
            //文章数据显示
            function post_comment(mydata) {
                $('#all_post').empty();
                for (var i = mydata.po_id.length - 1; i >= 0; i--) {
                    postfollow = mydata.po_user[i];

                    followindex = if_follow(postfollow);

                    if (parseInt(mydata.po_ifphoto[i]) >= 1) {
                        if (mydata.po_ifretrant[i] == 0) {
                            if (followindex == 0) {
                                $('#all_post').append("<div class='module span12' style='width:100%;height:auto;float:left;margin-left:0;background-color:white;border:0' id='" + mydata.po_id[i] + "'>" +
                                    "<div style='width:8%;float:left;margin-top:10;'><img class='my_photo' src='/static/avatar/" + mydata.avatar[i] + "?timestamp=" + new Date().getTime() + "'></div>" +
                                    "<div style='width:92%;float:right;margin-top:10;'><button class='to_follow'><b>+关注</b></button><span class='person' id='poster_" + mydata.po_id[i] + "'>" + mydata.po_user[i] + "</span><h10 style='font-size:10px;color:gray;float:left;width:90%'>" + mydata.po_time[i] + "</h10>" +
                                    "<h5><strong style='font-size:12px;float:left;width:100%;margin-top:5px'>" + mydata.po_text[i] + "</strong></h5></div>" +
                                    "<div style='float:left;margin-left:70px;margin-top:0;' id='img" + mydata.po_id[i] + "'></div></div>" +

                                    "<div class='post_function'><button class='to_retrant' data-toggle='modal' data-target='#all_message_modal' id='retrant_" + mydata.po_id[i] + "'><b>转发" + mydata.po_retrant[i] + "</b></button><div class='line'></div><button class='to_comment' id='comment_" + mydata.po_id[i] + "'><b>评论" + mydata.po_comment[i] + "</b></button><div class='line'></div><button class='to_upvote' id='upvote_" + mydata.po_id[i] + "'><b>点赞" + mydata.po_upvote[i] + "</b></button></div>" +
                                    "<div class='post_comment' id='post_comment_" + mydata.po_id[i] + "'>" +

                                    "<div style='width:100%;float:left'><img class='comment_avatar' src='/static/avatar/" + mydata.current_user + "?timestamp=" + new Date().getTime() + "'><input type='text' class='comment_input' id='comment_input" + mydata.po_id[i] + "'></input><button class='to_release'><b>发布</b></button><button class='to_withdraw'><b>收起</b></button></div>" +
                                    "<div id='comment_area_" + mydata.po_id[i] + "'></div>" +
                                    "<div id='comment_pagination_" + mydata.po_id[i] + "' class='pagination' style='float:right;margin-top: 0'></div></div></div>");
                            }

                            else if (followindex == 1) {
                                $('#all_post').append("<div class='module span12' style='width:100%;height:auto;float:left;margin-left:0;background-color:white;border:0' id='" + mydata.po_id[i] + "'>" +
                                    "<div style='width:8%;float:left;margin-top:10;'><img class='my_photo' src='/static/avatar/" + mydata.avatar[i] + "?timestamp=" + new Date().getTime() + "'></div>" +
                                    "<div style='width:92%;float:right;margin-top:10;'><button class='no_follow'><b>取消关注</b></button><span class='person' id='poster_" + mydata.po_id[i] + "'>" + mydata.po_user[i] + "</span><h10 style='font-size:10px;color:gray;float:left;width:90%'>" + mydata.po_time[i] + "</h10>" +
                                    "<h5><strong style='font-size:12px;float:left;width:100%;margin-top:5px'>" + mydata.po_text[i] + "</strong></h5></div>" +
                                    "<div style='float:left;margin-left:70px;margin-top:0;' id='img" + mydata.po_id[i] + "'></div></div>" +

                                    "<div class='post_function'><button class='to_retrant' data-toggle='modal' data-target='#all_message_modal' id='retrant_" + mydata.po_id[i] + "'><b>转发" + mydata.po_retrant[i] + "</b></button><div class='line'></div><button class='to_comment' class='to_comment' id='comment_" + mydata.po_id[i] + "'><b>评论" + mydata.po_comment[i] + "</b></button><div class='line'></div><button class='to_upvote' id='upvote_" + mydata.po_id[i] + "'><b>点赞" + mydata.po_upvote[i] + "</b></button></div>" +

                                    "<div class='post_comment' id='post_comment_" + mydata.po_id[i] + "'>" +
                                    "<div style='width:100%;float:left'><img class='comment_avatar' src='/static/avatar/" + mydata.current_user + "?timestamp=" + new Date().getTime() + "'><input type='text' class='comment_input' id='comment_input" + mydata.po_id[i] + "'></input><button class='to_release'><b>发布</b></button><button class='to_withdraw'><b>收起</b></button></div>" +
                                    "<div id='comment_area_" + mydata.po_id[i] + "'></div>" +
                                    "<div id='comment_pagination_" + mydata.po_id[i] + "' class='pagination' style='float:right;margin-top: 0'></div></div></div>");

                            }

                            else {
                                $('#all_post').append("<div class='module span12' style='width:100%;height:auto;float:left;margin-left:0;background-color:white;border:0' id='" + mydata.po_id[i] + "'>" +
                                    "<div style='width:8%;float:left;margin-top:10;'><img class='my_photo' src='/static/avatar/" + mydata.avatar[i] + "?timestamp=" + new Date().getTime() + "'></div>" +
                                    "<div style='width:92%;float:right;margin-top:10;'><span class='person' id='poster_" + mydata.po_id[i] + "'>" + mydata.po_user[i] + "</span><h10 style='font-size:10px;color:gray;float:left;width:100%'>" + mydata.po_time[i] + "</h10>" +
                                    "<h5><strong style='font-size:12px;float:left;width:100%;margin-top:5px'>" + mydata.po_text[i] + "</strong></h5>" +
                                    "<div style='float:left;margin-left:0;margin-top:0;' id='img" + mydata.po_id[i] + "'></div></div>" +

                                    "<div class='post_function'><button class='to_retrant' id='retrant_" + mydata.po_id[i] + "'><b>转发" + mydata.po_retrant[i] + "</b></button><div class='line'></div><button class='to_comment' id='comment_" + mydata.po_id[i] + "'><b>评论" + mydata.po_comment[i] + "</b></button><div class='line'></div><button class='to_upvote' id='upvote_" + mydata.po_id[i] + "'><b>点赞" + mydata.po_upvote[i] + "</b></button></div>" +
                                    "<div class='post_comment' id='post_comment_" + mydata.po_id[i] + "'>" +
                                    "<div style='width:100%;float:left'><img class='comment_avatar' src='/static/avatar/" + mydata.current_user + "?timestamp=" + new Date().getTime() + "'><input type='text' class='comment_input' id='comment_input" + mydata.po_id[i] + "'></input><button class='to_release'><b>发布</b></button><button class='to_withdraw'><b>收起</b></button></div>" +
                                    "<div id='comment_area_" + mydata.po_id[i] + "'></div>" +
                                    "<div id='comment_pagination_" + mydata.po_id[i] + "' class='pagination' style='float:right;margin-top: 0'></div></div></div>");
                            }
                        }
                        else {
                            if (followindex == 0) {
                                $('#all_post').append("<div class='module span12' style='width:100%;height:auto;float:left;margin-left:0;background-color:white;border:0' id='" + mydata.po_id[i] + "'>" +
                                    "<div style='width:8%;float:left;margin-top:10;'><img class='my_photo' src='/static/avatar/" + mydata.avatar[i] + "?timestamp=" + new Date().getTime() + "'></div>" +
                                    "<div style='width:92%;float:right;margin-top:10;'><button class='to_follow'><b>+关注</b></button><span class='person' id='poster_" + mydata.po_id[i] + "'>" + mydata.po_user[i] + "</span><h10 style='font-size:12px;color:gray;float:left;width:90%'>" + mydata.po_time[i] + "</h10>" +
                                    "<h5><strong style='font-size:12px;float:left;width:100%;margin-top:5px'>" + mydata.po_text[i] + "</strong></h5></div>" +
                                    "<div style='float:left;margin-left:0;margin-top:0;' id='img" + mydata.po_id[i] + "'></div></div>" +

                                    "<div style='width:100%;background-color: #FFFDEE;'><h5 style='float:left;width:100%;margin-left:0;margin-top:5px;background-color: #FFFDEE;'><strong style='font-size:15px;float:left;width:92%;margin-left:8%;margin-top:5px;background-color: #FFFDEE;'>" + "@" + mydata.po_retrant_poster[i] + "</strong>" +
                                    "<strong style='font-size:12px;float:left;width:92%;margin-left:8%;margin-top:5px;margin-bottom:5px;background-color: #FFFDEE;'>" + mydata.po_retrant_text[i] + "</strong></h5></div>" +

                                    "<div class='post_function'><button class='to_retrant' data-toggle='modal' data-target='#all_message_modal' id='retrant_" + mydata.po_id[i] + "'><b>转发" + mydata.po_retrant[i] + "</b></button><div class='line'></div><button class='to_comment' id='comment_" + mydata.po_id[i] + "'><b>评论" + mydata.po_comment[i] + "</b></button><div class='line'></div><button class='to_upvote' id='upvote_" + mydata.po_id[i] + "'><b>点赞" + mydata.po_upvote[i] + "</b></button></div>" +
                                    "<div class='post_comment' id='post_comment_" + mydata.po_id[i] + "'>" +
                                    "<div style='width:100%;float:left'><img class='comment_avatar' src='/static/avatar/" + mydata.current_user + "?timestamp=" + new Date().getTime() + "'><input type='text' class='comment_input' id='comment_input" + mydata.po_id[i] + "'></input><button class='to_release'><b>发布</b></button><button class='to_withdraw'><b>收起</b></button></div>" +
                                    "<div id='comment_area_" + mydata.po_id[i] + "'></div>" +
                                    "<div id='comment_pagination_" + mydata.po_id[i] + "' class='pagination' style='float:right;margin-top: 0'></div></div></div>");
                            }

                            else if (followindex == 1) {
                                $('#all_post').append("<div class='module span12' style='width:100%;height:auto;float:left;margin-left:0;background-color:white;border:0' id='" + mydata.po_id[i] + "'>" +
                                    "<div style='width:8%;float:left;margin-top:10;'><img class='my_photo' src='/static/avatar/" + mydata.avatar[i] + "?timestamp=" + new Date().getTime() + "'></div>" +
                                    "<div style='width:92%;float:left;margin-top:10;'><button class='no_follow'><b>取消关注</b></button><span class='person' id='poster_" + mydata.po_id[i] + "'>" + mydata.po_user[i] + "</span><h10 style='font-size:10px;color:gray;float:left;width:90%'>" + mydata.po_time[i] + "</h10>" +
                                    "<h5><strong style='font-size:12px;float:left;width:100%;margin-top:5px'>" + mydata.po_text[i] + "</strong></h5></div>" +
                                    "<div style='float:left;margin-left:0;margin-top:0;' id='img" + mydata.po_id[i] + "'></div></div>" +

                                    "<div style='width:100%;background-color: #FFFDEE;'><h5 style='float:left;width:100%;margin-left:0;margin-top:5px;background-color: #FFFDEE;'><strong style='font-size:15px;float:left;width:92%;margin-left:8%;margin-top:5px;background-color: #FFFDEE;'>" + "@" + mydata.po_retrant_poster[i] + "</strong>" +
                                    "<strong style='font-size:12px;float:left;width:92%;margin-left:8%;margin-top:5px;margin-bottom:5px;background-color: #FFFDEE;'>" + mydata.po_retrant_text[i] + "</strong></h5></div>" +

                                    "<div class='post_function'><button class='to_retrant' data-toggle='modal' data-target='#all_message_modal' id='retrant_" + mydata.po_id[i] + "'><b>转发" + mydata.po_retrant[i] + "</b></button><div class='line'></div><button class='to_comment' id='comment_" + mydata.po_id[i] + "'><b>评论" + mydata.po_comment[i] + "</b></button><div class='line'></div><button class='to_upvote' id='upvote_" + mydata.po_id[i] + "'><b>点赞" + mydata.po_upvote[i] + "</b></button></div>" +
                                    "<div class='post_comment' id='post_comment_" + mydata.po_id[i] + "'>" +
                                    "<div style='width:100%;float:left'><img class='comment_avatar' src='/static/avatar/" + mydata.current_user + "?timestamp=" + new Date().getTime() + "'><input type='text' class='comment_input' id='comment_input" + mydata.po_id[i] + "'></input><button class='to_release'><b>发布</b></button><button class='to_withdraw'><b>收起</b></button></div>" +
                                    "<div id='comment_area_" + mydata.po_id[i] + "'></div>" +
                                    "<div id='comment_pagination_" + mydata.po_id[i] + "' class='pagination' style='float:right;margin-top: 0'></div></div></div>");
                            }

                            else {
                                $('#all_post').append("<div class='module span12' style='width:100%;height:auto;float:left;margin-left:0;background-color:white;border:0' id='" + mydata.po_id[i] + "'>" +
                                    "<div style='width:8%;float:left;margin-top:10;'><img class='my_photo' src='/static/avatar/" + mydata.avatar[i] + "?timestamp=" + new Date().getTime() + "'></div>" +
                                    "<div style='width:92%;float:left;margin-top:10;'><span class='person' id='poster_" + mydata.po_id[i] + "'>" + mydata.po_user[i] + "</span><h10 style='font-size:10px;color:gray;float:left;width:100%'>" + mydata.po_time[i] + "</h10>" +
                                    "<h5><strong style='font-size:12px;float:left;width:100%;margin-top:5px'>" + mydata.po_text[i] + "</strong></h5></div>" +
                                    "<div style='float:left;margin-left:0;margin-top:0;' id='img" + mydata.po_id[i] + "'></div></div>" +

                                    "<div style='width:100%;background-color: #FFFDEE;'><h5 style='float:left;width:100%;margin-left:0;margin-top:5px;background-color: #FFFDEE;'><strong style='font-size:15px;float:left;width:92%;margin-left:8%;margin-top:5px;background-color: #FFFDEE;'>" + "@" + mydata.po_retrant_poster[i] + "</strong>" +
                                    "<strong style='font-size:12px;float:left;width:92%;margin-left:8%;margin-top:5px;margin-bottom:5px;background-color: #FFFDEE;'>" + mydata.po_retrant_text[i] + "</strong></h5></div>" +

                                    "<div class='post_function'><button class='to_retrant' id='retrant_" + mydata.po_id[i] + "'><b>转发" + mydata.po_retrant[i] + "</b></button><div class='line'></div><button class='to_comment' id='comment_" + mydata.po_id[i] + "'><b>评论" + mydata.po_comment[i] + "</b></button><div class='line'></div><button class='to_upvote' id='upvote_" + mydata.po_id[i] + "'><b>点赞" + mydata.po_upvote[i] + "</b></button></div>" +
                                    "<div class='post_comment' id='post_comment_" + mydata.po_id[i] + "'>" +
                                    "<div style='width:100%;float:left'><img class='comment_avatar' src='/static/avatar/" + mydata.current_user + "?timestamp=" + new Date().getTime() + "'><input type='text' class='comment_input' id='comment_input" + mydata.po_id[i] + "'></input><button class='to_release'><b>发布</b></button><button class='to_withdraw'><b>收起</b></button></div>" +
                                    "<div id='comment_area_" + mydata.po_id[i] + "'></div>" +
                                    "<div id='comment_pagination_" + mydata.po_id[i] + "' class='pagination' style='float:right;margin-top: 0'></div></div></div>");
                            }
                        }
                        $("#img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo1[i] + "'>");
                        $("#img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo2[i] + "'>");
                        $("#img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo3[i] + "'><br>");
                        $("#img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo4[i] + "'>");
                        $("#img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo5[i] + "'>");
                        $("#img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo6[i] + "'><br>");
                        $("#img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo7[i] + "'>");
                        $("#img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo8[i] + "'>");
                        $("#img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo9[i] + "'>");
                    }
                    else {
                        if (mydata.po_ifretrant[i] == 0) {
                            if (followindex == 0) {
                                $('#all_post').append("<div class='module span12' style='width:100%;height:auto;float:left;margin-left:0;background-color:white;border:0' id='" + mydata.po_id[i] + "'>" +
                                    "<div style='width:8%;float:left;margin-top:10;'><img class='my_photo' src='/static/avatar/" + mydata.avatar[i] + "?timestamp=" + new Date().getTime() + "'></div>" +
                                    "<div style='width:92%;float:right;margin-top:10;'><button class='to_follow'><b>+关注</b></button><span class='person' id='poster_" + mydata.po_id[i] + "'>" + mydata.po_user[i] + "</span><h10 style='font-size:10px;color:gray;float:left;width:90%'>" + mydata.po_time[i] + "</h10>" +
                                    "<h5><strong style='font-size:12px;float:left;width:100%;margin-top:5px'>" + mydata.po_text[i] + "</strong></h5></div>" +

                                    "<div class='post_function'><button class='to_retrant' data-toggle='modal' data-target='#all_message_modal' id='retrant_" + mydata.po_id[i] + "'><b>转发" + mydata.po_retrant[i] + "</b></button><div class='line'></div><button class='to_comment' id='comment_" + mydata.po_id[i] + "'><b>评论" + mydata.po_comment[i] + "</b></button><div class='line'></div><button class='to_upvote' id='upvote_" + mydata.po_id[i] + "'><b>点赞" + mydata.po_upvote[i] + "</b></button></div>" +
                                    "<div class='post_comment' id='post_comment_" + mydata.po_id[i] + "'>" +

                                    "<div style='width:100%;float:left'><img class='comment_avatar' src='/static/avatar/" + mydata.current_user + "?timestamp=" + new Date().getTime() + "'><input type='text' class='comment_input' id='comment_input" + mydata.po_id[i] + "'></input><button class='to_release'><b>发布</b></button><button class='to_withdraw'><b>收起</b></button></div>" +
                                    "<div id='comment_area_" + mydata.po_id[i] + "'></div>" +
                                    "<div id='comment_pagination_" + mydata.po_id[i] + "' class='pagination' style='float:right;margin-top: 0'></div></div></div>");
                            }

                            else if (followindex == 1) {
                                $('#all_post').append("<div class='module span12' style='width:100%;height:auto;float:left;margin-left:0;background-color:white;border:0' id='" + mydata.po_id[i] + "'>" +
                                    "<div style='width:8%;float:left;margin-top:10;'><img class='my_photo' src='/static/avatar/" + mydata.avatar[i] + "?timestamp=" + new Date().getTime() + "'></div>" +
                                    "<div style='width:92%;float:right;margin-top:10;'><button class='no_follow'><b>取消关注</b></button><span class='person' id='poster_" + mydata.po_id[i] + "'>" + mydata.po_user[i] + "</span><h10 style='font-size:10px;color:gray;float:left;width:90%'>" + mydata.po_time[i] + "</h10>" +
                                    "<h5><strong style='font-size:12px;float:left;width:100%;margin-top:5px'>" + mydata.po_text[i] + "</strong></h5></div>" +

                                    "<div class='post_function'><button class='to_retrant' data-toggle='modal' data-target='#all_message_modal' id='retrant_" + mydata.po_id[i] + "'><b>转发" + mydata.po_retrant[i] + "</b></button><div class='line'></div><button class='to_comment' class='to_comment' id='comment_" + mydata.po_id[i] + "'><b>评论" + mydata.po_comment[i] + "</b></button><div class='line'></div><button class='to_upvote' id='upvote_" + mydata.po_id[i] + "'><b>点赞" + mydata.po_upvote[i] + "</b></button></div>" +

                                    "<div class='post_comment' id='post_comment_" + mydata.po_id[i] + "'>" +
                                    "<div style='width:100%;float:left'><img class='comment_avatar' src='/static/avatar/" + mydata.current_user + "?timestamp=" + new Date().getTime() + "'><input type='text' class='comment_input' id='comment_input" + mydata.po_id[i] + "'></input><button class='to_release'><b>发布</b></button><button class='to_withdraw'><b>收起</b></button></div>" +
                                    "<div id='comment_area_" + mydata.po_id[i] + "'></div>" +
                                    "<div id='comment_pagination_" + mydata.po_id[i] + "' class='pagination' style='float:right;margin-top: 0'></div></div></div>");

                            }

                            else {
                                $('#all_post').append("<div class='module span12' style='width:100%;height:auto;float:left;margin-left:0;background-color:white;border:0' id='" + mydata.po_id[i] + "'>" +
                                    "<div style='width:8%;float:left;margin-top:10;'><img class='my_photo' src='/static/avatar/" + mydata.avatar[i] + "?timestamp=" + new Date().getTime() + "'></div>" +
                                    "<div style='width:92%;float:right;margin-top:10;'><span class='person' id='poster_" + mydata.po_id[i] + "'>" + mydata.po_user[i] + "</span><h10 style='font-size:10px;color:gray;float:left;width:100%'>" + mydata.po_time[i] + "</h10>" +
                                    "<h5><strong style='font-size:12px;float:left;width:100%;margin-top:5px'>" + mydata.po_text[i] + "</strong></h5></div>" +

                                    "<div class='post_function'><button class='to_retrant' id='retrant_" + mydata.po_id[i] + "'><b>转发" + mydata.po_retrant[i] + "</b></button><div class='line'></div><button class='to_comment' id='comment_" + mydata.po_id[i] + "'><b>评论" + mydata.po_comment[i] + "</b></button><div class='line'></div><button class='to_upvote' id='upvote_" + mydata.po_id[i] + "'><b>点赞" + mydata.po_upvote[i] + "</b></button></div>" +
                                    "<div class='post_comment' id='post_comment_" + mydata.po_id[i] + "'>" +
                                    "<div style='width:100%;float:left'><img class='comment_avatar' src='/static/avatar/" + mydata.current_user + "?timestamp=" + new Date().getTime() + "'><input type='text' class='comment_input' id='comment_input" + mydata.po_id[i] + "'></input><button class='to_release'><b>发布</b></button><button class='to_withdraw'><b>收起</b></button></div>" +
                                    "<div id='comment_area_" + mydata.po_id[i] + "'></div>" +
                                    "<div id='comment_pagination_" + mydata.po_id[i] + "' class='pagination' style='float:right;margin-top: 0'></div></div></div>");
                            }
                        }
                        else {
                            if (followindex == 0) {
                                $('#all_post').append("<div class='module span12' style='width:100%;height:auto;float:left;margin-left:0;background-color:white;border:0' id='" + mydata.po_id[i] + "'>" +
                                    "<div style='width:8%;float:left;margin-top:10;'><img class='my_photo' src='/static/avatar/" + mydata.avatar[i] + "?timestamp=" + new Date().getTime() + "'></div>" +
                                    "<div style='width:92%;float:right;margin-top:10;'><button class='to_follow'><b>+关注</b></button><span class='person' id='poster_" + mydata.po_id[i] + "'>" + mydata.po_user[i] + "</span><h10 style='font-size:12px;color:gray;float:left;width:90%'>" + mydata.po_time[i] + "</h10>" +
                                    "<h5><strong style='font-size:12px;float:left;width:100%;margin-top:5px'>" + mydata.po_text[i] + "</strong></h5></div>" +

                                    "<div style='width:100%;background-color: #FFFDEE;'><h5 style='float:left;width:100%;margin-left:0;margin-top:5px;background-color: #FFFDEE;'><strong style='font-size:15px;float:left;width:92%;margin-left:8%;margin-top:5px;background-color: #FFFDEE;'>" + "@" + mydata.po_retrant_poster[i] + "</strong>" +
                                    "<strong style='font-size:12px;float:left;width:92%;margin-left:8%;margin-top:5px;margin-bottom:5px;background-color: #FFFDEE;'>" + mydata.po_retrant_text[i] + "</strong></h5></div>" +

                                    "<div class='post_function'><button class='to_retrant' data-toggle='modal' data-target='#all_message_modal' id='retrant_" + mydata.po_id[i] + "'><b>转发" + mydata.po_retrant[i] + "</b></button><div class='line'></div><button class='to_comment' id='comment_" + mydata.po_id[i] + "'><b>评论" + mydata.po_comment[i] + "</b></button><div class='line'></div><button class='to_upvote' id='upvote_" + mydata.po_id[i] + "'><b>点赞" + mydata.po_upvote[i] + "</b></button></div>" +
                                    "<div class='post_comment' id='post_comment_" + mydata.po_id[i] + "'>" +
                                    "<div style='width:100%;float:left'><img class='comment_avatar' src='/static/avatar/" + mydata.current_user + "?timestamp=" + new Date().getTime() + "'><input type='text' class='comment_input' id='comment_input" + mydata.po_id[i] + "'></input><button class='to_release'><b>发布</b></button><button class='to_withdraw'><b>收起</b></button></div>" +
                                    "<div id='comment_area_" + mydata.po_id[i] + "'></div>" +
                                    "<div id='comment_pagination_" + mydata.po_id[i] + "' class='pagination' style='float:right;margin-top: 0'></div></div></div>");
                            }

                            else if (followindex == 1) {
                                $('#all_post').append("<div class='module span12' style='width:100%;height:auto;float:left;margin-left:0;background-color:white;border:0' id='" + mydata.po_id[i] + "'>" +
                                    "<div style='width:8%;float:left;margin-top:10;'><img class='my_photo' src='/static/avatar/" + mydata.avatar[i] + "?timestamp=" + new Date().getTime() + "'></div>" +
                                    "<div style='width:92%;float:left;margin-top:10;'><button class='no_follow'><b>取消关注</b></button><span class='person' id='poster_" + mydata.po_id[i] + "'>" + mydata.po_user[i] + "</span><h10 style='font-size:10px;color:gray;float:left;width:90%'>" + mydata.po_time[i] + "</h10>" +
                                    "<h5><strong style='font-size:12px;float:left;width:100%;margin-top:5px'>" + mydata.po_text[i] + "</strong></h5></div>" +

                                    "<div style='width:100%;background-color: #FFFDEE;'><h5 style='float:left;width:100%;margin-left:0;margin-top:5px;background-color: #FFFDEE;'><strong style='font-size:15px;float:left;width:92%;margin-left:8%;margin-top:5px;background-color: #FFFDEE;'>" + "@" + mydata.po_retrant_poster[i] + "</strong>" +
                                    "<strong style='font-size:12px;float:left;width:92%;margin-left:8%;margin-top:5px;margin-bottom:5px;background-color: #FFFDEE;'>" + mydata.po_retrant_text[i] + "</strong></h5></div>" +

                                    "<div class='post_function'><button class='to_retrant' data-toggle='modal' data-target='#all_message_modal' id='retrant_" + mydata.po_id[i] + "'><b>转发" + mydata.po_retrant[i] + "</b></button><div class='line'></div><button class='to_comment' id='comment_" + mydata.po_id[i] + "'><b>评论" + mydata.po_comment[i] + "</b></button><div class='line'></div><button class='to_upvote' id='upvote_" + mydata.po_id[i] + "'><b>点赞" + mydata.po_upvote[i] + "</b></button></div>" +
                                    "<div class='post_comment' id='post_comment_" + mydata.po_id[i] + "'>" +
                                    "<div style='width:100%;float:left'><img class='comment_avatar' src='/static/avatar/" + mydata.current_user + "?timestamp=" + new Date().getTime() + "'><input type='text' class='comment_input' id='comment_input" + mydata.po_id[i] + "'></input><button class='to_release'><b>发布</b></button><button class='to_withdraw'><b>收起</b></button></div>" +
                                    "<div id='comment_area_" + mydata.po_id[i] + "'></div>" +
                                    "<div id='comment_pagination_" + mydata.po_id[i] + "' class='pagination' style='float:right;margin-top: 0'></div></div></div>");
                            }

                            else {
                                $('#all_post').append("<div class='module span12' style='width:100%;height:auto;float:left;margin-left:0;background-color:white;border:0' id='" + mydata.po_id[i] + "'>" +
                                    "<div style='width:8%;float:left;margin-top:10;'><img class='my_photo' src='/static/avatar/" + mydata.avatar[i] + "?timestamp=" + new Date().getTime() + "'></div>" +
                                    "<div style='width:92%;float:left;margin-top:10;'><span class='person' id='poster_" + mydata.po_id[i] + "'>" + mydata.po_user[i] + "</span><h10 style='font-size:10px;color:gray;float:left;width:100%'>" + mydata.po_time[i] + "</h10>" +
                                    "<h5><strong style='font-size:12px;float:left;width:100%;margin-top:5px'>" + mydata.po_text[i] + "</strong></h5></div>" +

                                    "<div style='width:100%;background-color: #FFFDEE;'><h5 style='float:left;width:100%;margin-left:0;margin-top:5px;background-color: #FFFDEE;'><strong style='font-size:15px;float:left;width:92%;margin-left:8%;margin-top:5px;background-color: #FFFDEE;'>" + "@" + mydata.po_retrant_poster[i] + "</strong>" +
                                    "<strong style='font-size:12px;float:left;width:92%;margin-left:8%;margin-top:5px;margin-bottom:5px;background-color: #FFFDEE;'>" + mydata.po_retrant_text[i] + "</strong></h5></div>" +

                                    "<div class='post_function'><button class='to_retrant' id='retrant_" + mydata.po_id[i] + "'><b>转发" + mydata.po_retrant[i] + "</b></button><div class='line'></div><button class='to_comment' id='comment_" + mydata.po_id[i] + "'><b>评论" + mydata.po_comment[i] + "</b></button><div class='line'></div><button class='to_upvote' id='upvote_" + mydata.po_id[i] + "'><b>点赞" + mydata.po_upvote[i] + "</b></button></div>" +
                                    "<div class='post_comment' id='post_comment_" + mydata.po_id[i] + "'>" +
                                    "<div style='width:100%;float:left'><img class='comment_avatar' src='/static/avatar/" + mydata.current_user + "?timestamp=" + new Date().getTime() + "'><input type='text' class='comment_input' id='comment_input" + mydata.po_id[i] + "'></input><button class='to_release'><b>发布</b></button><button class='to_withdraw'><b>收起</b></button></div>" +
                                    "<div id='comment_area_" + mydata.po_id[i] + "'></div>" +
                                    "<div id='comment_pagination_" + mydata.po_id[i] + "' class='pagination' style='float:right;margin-top: 0'></div></div></div>");
                            }
                        }
                    }
                }
            }

            //我的关注文章数据显示
            function post_comment_follow(mydata) {
                $('#follow_post').empty();
                for (var i = mydata.po_id.length - 1; i >= 0; i--) {
                    postfollow = mydata.po_user[i];

                    if (parseInt(mydata.po_ifphoto[i]) >= 1) {
                        if (mydata.po_ifretrant[i] == 0) {
                            $('#follow_post').append("<div class='module span12' style='width:100%;height:auto;float:left;margin-left:0;background-color:white;border:0' id='F_" + mydata.po_id[i] + "'>" +
                                "<div style='width:8%;float:left;margin-top:10;'><img class='my_photo' src='/static/avatar/" + mydata.avatar[i] + "?timestamp=" + new Date().getTime() + "'></div>" +
                                "<div style='width:92%;float:right;margin-top:10;'><button class='no_follow'><b>取消关注</b></button><span class='person' id='F_poster_" + mydata.po_id[i] + "'>" + mydata.po_user[i] + "</span><h10 style='font-size:10px;color:gray;float:left;width:90%'>" + mydata.po_time[i] + "</h10>" +
                                "<h5><strong style='font-size:12px;float:left;width:100%;margin-top:5px'>" + mydata.po_text[i] + "</strong></h5></div>" +
                                "<div style='float:left;margin-left:0;margin-top:0;' id='F_img" + mydata.po_id[i] + "'></div></div>" +

                                "<div class='post_function'><button class='to_retrant' data-toggle='modal' data-target='#all_message_modal' id='F_comment_" + mydata.po_id[i] + "'><b>转发" + mydata.po_retrant[i] + "</b></button><div class='line'></div><button class='to_comment' id='F_comment_" + mydata.po_id[i] + "'><b>评论" + mydata.po_comment[i] + "</b></button><div class='line'></div><button class='to_upvote' id='F_upvote_" + mydata.po_id[i] + "'><b>点赞" + mydata.po_upvote[i] + "</b></button></div>" +
                                "<div class='post_comment' id='F_post_comment_" + mydata.po_id[i] + "'>" +
                                "<div style='width:100%;float:left'><img class='comment_avatar' src='/static/avatar/" + mydata.current_user + "?timestamp=" + new Date().getTime() + "'><input type='text' class='comment_input' id='F_comment_input" + mydata.po_id[i] + "'></input><button class='to_release'><b>发布</b></button><button class='to_withdraw'><b>收起</b></button></div>" +
                                "<div id='F_comment_area_" + mydata.po_id[i] + "'></div>" +
                                "<div id='F_comment_pagination_" + mydata.po_id[i] + "' class='pagination' style='float:right;margin-top: 0'></div></div></div>");
                        }
                        else {
                            $('#follow_post').append("<div class='module span12' style='width:100%;height:auto;float:left;margin-left:0;background-color:white;border:0' id='F_" + mydata.po_id[i] + "'>" +
                                "<div style='width:8%;float:left;margin-top:10;'><img class='my_photo' src='/static/avatar/" + mydata.avatar[i] + "?timestamp=" + new Date().getTime() + "'></div>" +
                                "<div style='width:92%;float:left;margin-top:10;'><button class='no_follow'><b>取消关注</b></button><span class='person' id='F_poster_" + mydata.po_id[i] + "'>" + mydata.po_user[i] + "</span><h10 style='font-size:10px;color:gray;float:left;width:90%'>" + mydata.po_time[i] + "</h10>" +
                                "<h5><strong style='font-size:12px;float:left;width:100%;margin-top:5px'>" + mydata.po_text[i] + "</strong></h5></div>" +
                                "<div style='float:left;margin-left:0;margin-top:0;' id='F_img" + mydata.po_id[i] + "'></div></div>" +

                                "<div style='width:100%;background-color: #FFFDEE;'><h5 style='float:left;width:100%;margin-left:0;margin-top:5px;background-color: #FFFDEE;'><strong style='font-size:15px;float:left;width:92%;margin-left:8%;margin-top:5px;background-color: #FFFDEE;'>" + "@" + mydata.po_retrant_poster[i] + "</strong>" +
                                "<strong style='font-size:12px;float:left;width:92%;margin-left:8%;margin-top:5px;margin-bottom:5px;background-color: #FFFDEE;'>" + mydata.po_retrant_text[i] + "</strong></h5></div>" +

                                "<div class='post_function'><button class='to_retrant' data-toggle='modal' data-target='#all_message_modal' id='F_comment_" + mydata.po_id[i] + "'><b>转发" + mydata.po_retrant[i] + "</b></button><div class='line'></div><button class='to_comment' id='F_comment_" + mydata.po_id[i] + "'><b>评论" + mydata.po_comment[i] + "</b></button><div class='line'></div><button class='to_upvote' id='F_upvote_" + mydata.po_id[i] + "'><b>点赞" + mydata.po_upvote[i] + "</b></button></div>" +
                                "<div class='post_comment' id='F_post_comment_" + mydata.po_id[i] + "'>" +
                                "<div style='width:100%;float:left'><img class='comment_avatar' src='/static/avatar/" + mydata.current_user + "?timestamp=" + new Date().getTime() + "'><input type='text' class='comment_input' id='F_comment_input" + mydata.po_id[i] + "'></input><button class='to_release'><b>发布</b></button><button class='to_withdraw'><b>收起</b></button></div>" +
                                "<div id='F_comment_area_" + mydata.po_id[i] + "'></div>" +
                                "<div id='F_comment_pagination_" + mydata.po_id[i] + "' class='pagination' style='float:right;margin-top: 0'></div></div></div>");
                        }

                        $("#F_img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo1[i] + "'>");
                        $("#F_img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo2[i] + "'>");
                        $("#F_img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo3[i] + "'><br>");
                        $("#F_img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo4[i] + "'>");
                        $("#F_img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo5[i] + "'>");
                        $("#F_img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo6[i] + "'><br>");
                        $("#F_img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo7[i] + "'>");
                        $("#F_img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo8[i] + "'>");
                        $("#F_img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo9[i] + "'>");
                    }
                    else {
                        if (mydata.po_ifretrant[i] == 0) {
                            $('#follow_post').append("<div class='module span12' style='width:100%;height:auto;float:left;margin-left:0;background-color:white;border:0' id='F_" + mydata.po_id[i] + "'>" +
                                "<div style='width:8%;float:left;margin-top:10;'><img class='my_photo' src='/static/avatar/" + mydata.avatar[i] + "?timestamp=" + new Date().getTime() + "'></div>" +
                                "<div style='width:92%;float:right;margin-top:10;'><button class='no_follow'><b>取消关注</b></button><span class='person' id='F_poster_" + mydata.po_id[i] + "'>" + mydata.po_user[i] + "</span><h10 style='font-size:10px;color:gray;float:left;width:90%'>" + mydata.po_time[i] + "</h10>" +
                                "<h5><strong style='font-size:12px;float:left;width:100%;margin-top:5px'>" + mydata.po_text[i] + "</strong></h5></div>" +
                                "<div style='float:left;margin-left:0;margin-top:0;' id='F_img" + mydata.po_id[i] + "'></div></div>" +

                                "<div class='post_function'><button class='to_retrant' data-toggle='modal' data-target='#all_message_modal' id='F_comment_" + mydata.po_id[i] + "'><b>转发" + mydata.po_retrant[i] + "</b></button><div class='line'></div><button class='to_comment' id='F_comment_" + mydata.po_id[i] + "'><b>评论" + mydata.po_comment[i] + "</b></button><div class='line'></div><button class='to_upvote' id='F_upvote_" + mydata.po_id[i] + "'><b>点赞" + mydata.po_upvote[i] + "</b></button></div>" +
                                "<div class='post_comment' id='F_post_comment_" + mydata.po_id[i] + "'>" +
                                "<div style='width:100%;float:left'><img class='comment_avatar' src='/static/avatar/" + mydata.current_user + "?timestamp=" + new Date().getTime() + "'><input type='text' class='comment_input' id='F_comment_input" + mydata.po_id[i] + "'></input><button class='to_release'><b>发布</b></button><button class='to_withdraw'><b>收起</b></button></div>" +
                                "<div id='F_comment_area_" + mydata.po_id[i] + "'></div>" +
                                "<div id='F_comment_pagination_" + mydata.po_id[i] + "' class='pagination' style='float:right;margin-top: 0'></div></div></div>");
                        }
                        else {
                            $('#follow_post').append("<div class='module span12' style='width:100%;height:auto;float:left;margin-left:0;background-color:white;border:0' id='F_" + mydata.po_id[i] + "'>" +
                                "<div style='width:8%;float:left;margin-top:10;'><img class='my_photo' src='/static/avatar/" + mydata.avatar[i] + "?timestamp=" + new Date().getTime() + "'></div>" +
                                "<div style='width:92%;float:left;margin-top:10;'><button class='no_follow'><b>取消关注</b></button><span class='person' id='F_poster_" + mydata.po_id[i] + "'>" + mydata.po_user[i] + "</span><h10 style='font-size:10px;color:gray;float:left;width:90%'>" + mydata.po_time[i] + "</h10>" +
                                "<h5><strong style='font-size:12px;float:left;width:100%;margin-top:5px'>" + mydata.po_text[i] + "</strong></h5></div>" +
                                "<div style='float:left;margin-left:0;margin-top:0;' id='F_img" + mydata.po_id[i] + "'></div></div>" +

                                "<div style='width:100%;background-color: #FFFDEE;'><h5 style='float:left;width:100%;margin-left:0;margin-top:5px;background-color: #FFFDEE;'><strong style='font-size:15px;float:left;width:92%;margin-left:8%;margin-top:5px;background-color: #FFFDEE;'>" + "@" + mydata.po_retrant_poster[i] + "</strong>" +
                                "<strong style='font-size:12px;float:left;width:92%;margin-left:8%;margin-top:5px;margin-bottom:5px;background-color: #FFFDEE;'>" + mydata.po_retrant_text[i] + "</strong></h5></div>" +

                                "<div class='post_function'><button class='to_retrant' data-toggle='modal' data-target='#all_message_modal' id='F_comment_" + mydata.po_id[i] + "'><b>转发" + mydata.po_retrant[i] + "</b></button><div class='line'></div><button class='to_comment' id='F_comment_" + mydata.po_id[i] + "'><b>评论" + mydata.po_comment[i] + "</b></button><div class='line'></div><button class='to_upvote' id='F_upvote_" + mydata.po_id[i] + "'><b>点赞" + mydata.po_upvote[i] + "</b></button></div>" +
                                "<div class='post_comment' id='F_post_comment_" + mydata.po_id[i] + "'>" +
                                "<div style='width:100%;float:left'><img class='comment_avatar' src='/static/avatar/" + mydata.current_user + "?timestamp=" + new Date().getTime() + "'><input type='text' class='comment_input' id='F_comment_input" + mydata.po_id[i] + "'></input><button class='to_release'><b>发布</b></button><button class='to_withdraw'><b>收起</b></button></div>" +
                                "<div id='F_comment_area_" + mydata.po_id[i] + "'></div>" +
                                "<div id='F_comment_pagination_" + mydata.po_id[i] + "' class='pagination' style='float:right;margin-top: 0'></div></div></div>");
                        }
                    }
                }
            }

            //我的文章数据显示
            function post_comment_myown(mydata) {
                $('#my_own_post').empty();
                for (var i = mydata.po_id.length - 1; i >= 0; i--) {

                    if (parseInt(mydata.po_ifphoto[i]) >= 1) {
                        if (mydata.po_ifretrant[i] == 0) {
                            $('#my_own_post').append("<div class='module span12' style='width:100%;height:auto;float:left;margin-left:0;background-color:white;border:0' id='M_" + mydata.po_id[i] + "'>" +
                                "<div style='width:8%;float:left;margin-top:10;'><img class='my_photo' src='/static/avatar/" + mydata.avatar[i] + "?timestamp=" + new Date().getTime() + "'></div>" +
                                "<div style='width:92%;float:right;margin-top:10;'><span class='person' id='M_poster_" + mydata.po_id[i] + "'>" + mydata.po_user[i] + "</span><h10 style='font-size:10px;color:gray;float:left;width:100%'>" + mydata.po_time[i] + "</h10>" +
                                "<h5><strong style='font-size:12px;float:left;width:100%;margin-top:5px'>" + mydata.po_text[i] + "</strong></h5></div>" +
                                "<div style='float:left;margin-left:0;margin-top:0;' id='M_img" + mydata.po_id[i] + "'></div></div>" +

                                "<div class='post_function'><button class='to_retrant'><b>转发" + mydata.po_retrant[i] + "</b></button><div class='line'></div><button class='to_comment' id='M_comment_" + mydata.po_id[i] + "'><b>评论" + mydata.po_comment[i] + "</b></button><div class='line'></div><button class='to_upvote' id='M_upvote_" + mydata.po_id[i] + "'><b>点赞" + mydata.po_upvote[i] + "</b></button></div>" +
                                "<div class='post_comment' id='M_post_comment_" + mydata.po_id[i] + "'>" +
                                "<div style='width:100%;float:left'><img class='comment_avatar' src='/static/avatar/" + mydata.current_user + "?timestamp=" + new Date().getTime() + "'><input type='text' class='comment_input' id='M_comment_input" + mydata.po_id[i] + "'></input><button class='to_release'><b>发布</b></button><button class='to_withdraw'><b>收起</b></button></div>" +
                                "<div id='M_comment_area_" + mydata.po_id[i] + "'></div>" +
                                "<div id='M_comment_pagination_" + mydata.po_id[i] + "' class='pagination' style='float:right;margin-top: 0'></div></div></div>");
                        }
                        else {
                            $('#my_own_post').append("<div class='module span12' style='width:100%;height:auto;float:left;margin-left:0;background-color:white;border:0' id='M_" + mydata.po_id[i] + "'>" +
                                "<div style='width:8%;float:left;margin-top:10;'><img class='my_photo' src='/static/avatar/" + mydata.avatar[i] + "?timestamp=" + new Date().getTime() + "'></div>" +
                                "<div style='width:92%;float:left;margin-top:10;'><span class='person' id='M_poster_" + mydata.po_id[i] + "'>" + mydata.po_user[i] + "</span><h10 style='font-size:10px;color:gray;float:left;width:100%'>" + mydata.po_time[i] + "</h10>" +
                                "<h5><strong style='font-size:12px;float:left;width:100%;margin-top:5px'>" + mydata.po_text[i] + "</strong></h5></div>" +
                                "<div style='float:left;margin-left:0;margin-top:0;' id='M_img" + mydata.po_id[i] + "'></div></div>" +

                                "<div style='width:100%;background-color: #FFFDEE;'><h5 style='float:left;width:100%;margin-left:0;margin-top:5px;background-color: #FFFDEE;'><strong style='font-size:15px;float:left;width:92%;margin-left:8%;margin-top:5px;background-color: #FFFDEE;'>" + "@" + mydata.po_retrant_poster[i] + "</strong>" +
                                "<strong style='font-size:12px;float:left;width:92%;margin-left:8%;margin-top:5px;margin-bottom:5px;background-color: #FFFDEE;'>" + mydata.po_retrant_text[i] + "</strong></h5></div>" +

                                "<div class='post_function'><button class='to_retrant'><b>转发" + mydata.po_retrant[i] + "</b></button><div class='line'></div><button class='to_comment' id='M_comment_" + mydata.po_id[i] + "'><b>评论" + mydata.po_comment[i] + "</b></button><div class='line'></div><button class='to_upvote' id='M_upvote_" + mydata.po_id[i] + "'><b>点赞" + mydata.po_upvote[i] + "</b></button></div>" +
                                "<div class='post_comment' id='M_post_comment_" + mydata.po_id[i] + "'>" +
                                "<div style='width:100%;float:left'><img class='comment_avatar' src='/static/avatar/" + mydata.current_user + "?timestamp=" + new Date().getTime() + "'><input type='text' class='comment_input' id='M_comment_input" + mydata.po_id[i] + "'></input><button class='to_release'><b>发布</b></button><button class='to_withdraw'><b>收起</b></button></div>" +
                                "<div id='M_comment_area_" + mydata.po_id[i] + "'></div>" +
                                "<div id='M_comment_pagination_" + mydata.po_id[i] + "' class='pagination' style='float:right;margin-top: 0'></div></div></div>");
                        }

                        $("#M_img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo1[i] + "'>");
                        $("#M_img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo2[i] + "'>");
                        $("#M_img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo3[i] + "'><br>");
                        $("#M_img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo4[i] + "'>");
                        $("#M_img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo5[i] + "'>");
                        $("#M_img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo6[i] + "'><br>");
                        $("#M_img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo7[i] + "'>");
                        $("#M_img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo8[i] + "'>");
                        $("#M_img" + mydata.po_id[i]).append("<img onerror='onImgError(this)' class='my_profile' src='/static/a_photo/" + mydata.photo9[i] + "'>");
                    }
                    else {
                        if (mydata.po_ifretrant[i] == 0) {
                            $('#my_own_post').append("<div class='module span12' style='width:100%;height:auto;float:left;margin-left:0;background-color:white;border:0' id='M_" + mydata.po_id[i] + "'>" +
                                "<div style='width:8%;float:left;margin-top:10;'><img class='my_photo' src='/static/avatar/" + mydata.avatar[i] + "?timestamp=" + new Date().getTime() + "'></div>" +
                                "<div style='width:92%;float:right;margin-top:10;'><span class='person' id='M_poster_" + mydata.po_id[i] + "'>" + mydata.po_user[i] + "</span><h10 style='font-size:10px;color:gray;float:left;width:100%'>" + mydata.po_time[i] + "</h10>" +
                                "<h5><strong style='font-size:12px;float:left;width:100%;margin-top:5px'>" + mydata.po_text[i] + "</strong></h5></div>" +

                                "<div class='post_function'><button class='to_retrant'><b>转发" + mydata.po_retrant[i] + "</b></button><div class='line'></div><button class='to_comment' id='M_comment_" + mydata.po_id[i] + "'><b>评论" + mydata.po_comment[i] + "</b></button><div class='line'></div><button class='to_upvote' id='M_upvote_" + mydata.po_id[i] + "'><b>点赞" + mydata.po_upvote[i] + "</b></button></div>" +
                                "<div class='post_comment' id='M_post_comment_" + mydata.po_id[i] + "'>" +
                                "<div style='width:100%;float:left'><img class='comment_avatar' src='/static/avatar/" + mydata.current_user + "?timestamp=" + new Date().getTime() + "'><input type='text' class='comment_input' id='M_comment_input" + mydata.po_id[i] + "'></input><button class='to_release'><b>发布</b></button><button class='to_withdraw'><b>收起</b></button></div>" +
                                "<div id='M_comment_area_" + mydata.po_id[i] + "'></div>" +
                                "<div id='M_comment_pagination_" + mydata.po_id[i] + "' class='pagination' style='float:right;margin-top: 0'></div></div></div>");
                        }
                        else {
                            $('#my_own_post').append("<div class='module span12' style='width:100%;height:auto;float:left;margin-left:0;background-color:white;border:0' id='M_" + mydata.po_id[i] + "'>" +
                                "<div style='width:8%;float:left;margin-top:10;'><img class='my_photo' src='/static/avatar/" + mydata.avatar[i] + "?timestamp=" + new Date().getTime() + "'></div>" +
                                "<div style='width:92%;float:left;margin-top:10;'><span class='person' id='M_poster_" + mydata.po_id[i] + "'>" + mydata.po_user[i] + "</span><h10 style='font-size:10px;color:gray;float:left;width:100%'>" + mydata.po_time[i] + "</h10>" +
                                "<h5><strong style='font-size:12px;float:left;width:100%;margin-top:5px'>" + mydata.po_text[i] + "</strong></h5></div>" +

                                "<div style='width:100%;background-color: #FFFDEE;'><h5 style='float:left;width:100%;margin-left:0;margin-top:5px;background-color: #FFFDEE;'><strong style='font-size:15px;float:left;width:92%;margin-left:8%;margin-top:5px;background-color: #FFFDEE;'>" + "@" + mydata.po_retrant_poster[i] + "</strong>" +
                                "<strong style='font-size:12px;float:left;width:92%;margin-left:8%;margin-top:5px;margin-bottom:5px;background-color: #FFFDEE;'>" + mydata.po_retrant_text[i] + "</strong></h5></div>" +

                                "<div class='post_function'><button class='to_retrant'><b>转发" + mydata.po_retrant[i] + "</b></button><div class='line'></div><button class='to_comment' id='M_comment_" + mydata.po_id[i] + "'><b>评论" + mydata.po_comment[i] + "</b></button><div class='line'></div><button class='to_upvote' id='M_upvote_" + mydata.po_id[i] + "'><b>点赞" + mydata.po_upvote[i] + "</b></button></div>" +
                                "<div class='post_comment' id='M_post_comment_" + mydata.po_id[i] + "'>" +
                                "<div style='width:100%;float:left'><img class='comment_avatar' src='/static/avatar/" + mydata.current_user + "?timestamp=" + new Date().getTime() + "'><input type='text' class='comment_input' id='M_comment_input" + mydata.po_id[i] + "'></input><button class='to_release'><b>发布</b></button><button class='to_withdraw'><b>收起</b></button></div>" +
                                "<div id='M_comment_area_" + mydata.po_id[i] + "'></div>" +
                                "<div id='M_comment_pagination_" + mydata.po_id[i] + "' class='pagination' style='float:right;margin-top: 0'></div></div></div>");
                        }
                    }
                }
            }

            var pagecomment, minpage, maxpage, topScroll;
            //展开评论
            function open_comment(id) {
                $.ajax({
                    type: 'GET',
                    url: '{{ url_for("message_api.comment_all") }}',
                    data: {
                        post: id
                    },
                    dataType: 'json',
                    success: function (data) {
                        console.log(data);
                        pagecomment = data;
                        var max_entries = data.co_page;
                        $("#comment_pagination_" + id).pagination(max_entries, {
                            num_edge_entries: 1, //边缘页数
                            num_display_entries: 2, //主体页数
                            callback: comment_callback,
                            items_per_page: 1, //每页显示1项
                            prev_text: "<<",
                            next_text: ">>"
                        });
                    }
                });
            }

            //我的关注展开评论
            function open_comment_follow(id) {
                $.ajax({
                    type: 'GET',
                    url: '{{ url_for("message_api.comment_all") }}',
                    data: {
                        post: id
                    },
                    dataType: 'json',
                    success: function (data) {
                        console.log(data);
                        pagecomment = data;
                        var max_entries = data.co_page;
                        $("#F_comment_pagination_" + id).pagination(max_entries, {
                            num_edge_entries: 1, //边缘页数
                            num_display_entries: 2, //主体页数
                            callback: follow_comment_callback,
                            items_per_page: 1, //每页显示1项
                            prev_text: "<<",
                            next_text: ">>"
                        });
                    }
                });
            }

            //我的动态展开评论
            function open_comment_myown(id) {
                $.ajax({
                    type: 'GET',
                    url: '{{ url_for("message_api.comment_all") }}',
                    data: {
                        post: id
                    },
                    dataType: 'json',
                    success: function (data) {
                        console.log(data);
                        pagecomment = data;
                        var max_entries = data.co_page;
                        $("#M_comment_pagination_" + id).pagination(max_entries, {
                            num_edge_entries: 1, //边缘页数
                            num_display_entries: 2, //主体页数
                            callback: myown_comment_callback,
                            items_per_page: 1, //每页显示1项
                            prev_text: "<<",
                            next_text: ">>"
                        });
                    }
                });
            }

            //评论分页
            function comment_callback(page_index) {
                minpage = 5 * page_index;
                maxpage = 5 * (page_index + 1);

                $('#comment_area_' + pagecomment.co_post).empty();

                if (pagecomment.co_id.length - maxpage > 0) {
                    for (var k = pagecomment.co_id.length - minpage - 1; k >= pagecomment.co_id.length - maxpage; k--) {
                        (function (j) {
                            $('#comment_area_' + pagecomment.co_post).append("<div style='width:100%;height:auto;float:left;margin-left:0;margin-top:10px;'><img class='comment_avatar' src='/static/avatar/" + pagecomment.avatar[j] + "?timestamp=" + new Date().getTime() + "'><div style='float:left;margin-left:10px;margin-top:5px'><strong style='font-size:17px'>" + pagecomment.co_commenter[j] + ": </strong><h10 style='font-size:17px'>" + pagecomment.co_text[j] + "</h10></div><button class='to_reply' data-toggle='modal' data-target='#reply_modal' id='" + pagecomment.co_id[j] + "'><b>回复</b></buttom></div><div class='reply_area' id='reply_" + pagecomment.co_id[j] + "'></div>");
                            my_reply(pagecomment.co_id[j])
                        })(k)
                    }
                }
                else {
                    for (var k = pagecomment.co_id.length - minpage - 1; k >= 0; k--) {
                        (function (j) {
                            $('#comment_area_' + pagecomment.co_post).append("<div style='width:100%;height:auto;float:left;margin-left:0;margin-top:10px;'><img class='comment_avatar' src='/static/avatar/" + pagecomment.avatar[j] + "?timestamp=" + new Date().getTime() + "'><div style='float:left;margin-left:10px;margin-top:5px'><strong style='font-size:17px'>" + pagecomment.co_commenter[j] + ": </strong><h10 style='font-size:17px'>" + pagecomment.co_text[j] + "</h10></div><button class='to_reply' data-toggle='modal' data-target='#reply_modal' id='" + pagecomment.co_id[j] + "'><b>回复</b></buttom></div><div class='reply_area' id='reply_" + pagecomment.co_id[j] + "'></div>");
                            my_reply(pagecomment.co_id[j])
                        })(k)
                    }
                }

                topScroll = document.body.scrollTop;//滚动的距离,距离顶部的距离
                $('body,html').animate({scrollTop: topScroll}, 500)
            }

            //我的关注评论分页
            function follow_comment_callback(page_index) {
                minpage = 5 * page_index;
                maxpage = 5 * (page_index + 1);

                $('#F_comment_area_' + pagecomment.co_post).empty();

                if (pagecomment.co_id.length - maxpage > 0) {
                    for (var k = pagecomment.co_id.length - minpage - 1; k >= pagecomment.co_id.length - maxpage; k--) {
                        (function (j) {
                            $('#F_comment_area_' + pagecomment.co_post).append("<div style='width:100%;height:auto;float:left;margin-left:0;margin-top:10px;'><img class='comment_avatar' src='/static/avatar/" + pagecomment.avatar[j] + "?timestamp=" + new Date().getTime() + "'><div style='float:left;margin-left:10px;margin-top:5px'><strong style='font-size:17px'>" + pagecomment.co_commenter[j] + ": </strong><h10 style='font-size:17px'>" + pagecomment.co_text[j] + "</h10></div><button class='to_reply' data-toggle='modal' data-target='#reply_follow_modal' id='" + pagecomment.co_id[j] + "'><b>回复</b></buttom></div><div class='reply_area' id='F_reply_" + pagecomment.co_id[j] + "'></div>");
                            my_reply_follow(pagecomment.co_id[j])
                        })(k)
                    }
                }
                else {
                    for (var k = pagecomment.co_id.length - minpage - 1; k >= 0; k--) {
                        (function (j) {
                            $('#F_comment_area_' + pagecomment.co_post).append("<div style='width:100%;height:auto;float:left;margin-left:0;margin-top:10px;'><img class='comment_avatar' src='/static/avatar/" + pagecomment.avatar[j] + "?timestamp=" + new Date().getTime() + "'><div style='float:left;margin-left:10px;margin-top:5px'><strong style='font-size:17px'>" + pagecomment.co_commenter[j] + ": </strong><h10 style='font-size:17px'>" + pagecomment.co_text[j] + "</h10></div><button class='to_reply' data-toggle='modal' data-target='#reply_follow_modal' id='" + pagecomment.co_id[j] + "'><b>回复</b></buttom></div><div class='reply_area' id='F_reply_" + pagecomment.co_id[j] + "'></div>");
                            my_reply_follow(pagecomment.co_id[j])
                        })(k)
                    }
                }

                topScroll = document.body.scrollTop;//滚动的距离,距离顶部的距离
                console.log(topScroll);
                $('body,html').animate({scrollTop: topScroll}, 500)
            }

            //我的动态评论分页
            function myown_comment_callback(page_index) {
                minpage = 5 * page_index;
                maxpage = 5 * (page_index + 1);

                $('#M_comment_area_' + pagecomment.co_post).empty();

                if (pagecomment.co_id.length - maxpage > 0) {
                    for (var k = pagecomment.co_id.length - minpage - 1; k >= pagecomment.co_id.length - maxpage; k--) {
                        (function (j) {
                            $('#M_comment_area_' + pagecomment.co_post).append("<div style='width:100%;height:auto;float:left;margin-left:0;margin-top:10px;'><img class='comment_avatar' src='/static/avatar/" + pagecomment.avatar[j] + "?timestamp=" + new Date().getTime() + "'><div style='float:left;margin-left:10px;margin-top:5px'><strong style='font-size:17px'>" + pagecomment.co_commenter[j] + ": </strong><h10 style='font-size:17px'>" + pagecomment.co_text[j] + "</h10></div><button class='to_reply' data-toggle='modal' data-target='#reply_myown_modal' id='" + pagecomment.co_id[j] + "'><b>回复</b></buttom></div><div class='reply_area' id='M_reply_" + pagecomment.co_id[j] + "'></div>");
                            my_reply_myown(pagecomment.co_id[j])
                        })(k)
                    }
                }
                else {
                    for (var k = pagecomment.co_id.length - minpage - 1; k >= 0; k--) {
                        (function (j) {
                            $('#M_comment_area_' + pagecomment.co_post).append("<div style='width:100%;height:auto;float:left;margin-left:0;margin-top:10px;'><img class='comment_avatar' src='/static/avatar/" + pagecomment.avatar[j] + "?timestamp=" + new Date().getTime() + "'><div style='float:left;margin-left:10px;margin-top:5px'><strong style='font-size:17px'>" + pagecomment.co_commenter[j] + ": </strong><h10 style='font-size:17px'>" + pagecomment.co_text[j] + "</h10></div><button class='to_reply' data-toggle='modal' data-target='#reply_myown_modal' id='" + pagecomment.co_id[j] + "'><b>回复</b></buttom></div><div class='reply_area' id='M_reply_" + pagecomment.co_id[j] + "'></div>");
                            my_reply_myown(pagecomment.co_id[j])
                        })(k)
                    }
                }

                topScroll = document.body.scrollTop;//滚动的距离,距离顶部的距离
                console.log(topScroll);
                $('body,html').animate({scrollTop: topScroll}, 500)
            }

            //是否关注判断
            function if_follow(thisdata) {
                var myindex;
                $.ajax({
                    type: 'GET',
                    url: '{{ url_for("message_api.query_follow") }}',
                    data: {
                        myposter: thisdata
                    },
                    async: false,
                    dataType: 'json',
                    success: function (data) {
                        console.log(data);
                        if (data == 1) {
                            myindex = 1;
                        }
                        else if (data == 2) {
                            myindex = 2;
                        }
                        else {
                            myindex = 0;
                        }
                    }
                });
                return myindex;
            }

            //评论回复查询
            function my_reply(id) {
                $.ajax({
                    type: 'GET',
                    url: '{{ url_for("message_api.query_reply") }}',
                    data: {
                        mycomment: id
                    },
                    async: false,
                    dataType: 'json',
                    success: function (data) {
                        console.log(data);
                        for (var m = data.re_id.length - 1; m >= 0; m--) {
                            $('#reply_' + id).append("<div style='width:100%;float:left;margin-left:53px;margin-top:5px'><strong style='font-size:17px'>" + data.replier[m] + "回复" + data.replied[m] + ":  </strong><h10 style='font-size:17px'>" + data.re_text[m] + "</h10></div>")
                        }
                    }
                });
            }

            //我的关注评论回复查询
            function my_reply_follow(id) {
                $.ajax({
                    type: 'GET',
                    url: '{{ url_for("message_api.query_reply") }}',
                    data: {
                        mycomment: id
                    },
                    async: false,
                    dataType: 'json',
                    success: function (data) {
                        console.log(data);
                        for (var m = data.re_id.length - 1; m >= 0; m--) {
                            $('#F_reply_' + id).append("<div style='width:100%;float:left;margin-left:53px;margin-top:5px'><strong style='font-size:17px'>" + data.replier[m] + "回复" + data.replied[m] + ":  </strong><h10 style='font-size:17px'>" + data.re_text[m] + "</h10></div>")
                        }
                    }
                });
            }

            //我的动态评论回复查询
            function my_reply_myown(id) {
                $.ajax({
                    type: 'GET',
                    url: '{{ url_for("message_api.query_reply") }}',
                    data: {
                        mycomment: id
                    },
                    async: false,
                    dataType: 'json',
                    success: function (data) {
                        console.log(data);
                        for (var m = data.re_id.length - 1; m >= 0; m--) {
                            $('#M_reply_' + id).append("<div style='width:100%;float:left;margin-left:53px;margin-top:5px'><strong style='font-size:17px'>" + data.replier[m] + "回复" + data.replied[m] + ":  </strong><h10 style='font-size:17px'>" + data.re_text[m] + "</h10></div>")
                        }
                    }
                });
            }

            //获取left
            function getElementLeft(element) {
                var actualLeft = element.offsetLeft;
                var current = element.offsetParent;
                while (current !== null) {
                    actualLeft += current.offsetLeft;
                    current = current.offsetParent;
                }
                return actualLeft;
            }

            //获取top
            function getElementTop(element) {
                var actualTop = element.offsetTop;
                var current = element.offsetParent;
                while (current !== null) {
                    actualTop += current.offsetTop;
                    current = current.offsetParent;
                }
                return actualTop;
            }

            //获取client——left right top bottom
            function getBoundingClientRect(element) {
                var scrollTop = document.documentElement.scrollTop;
                var scrollLeft = document.documentElement.scrollLeft;
                if (element.getBoundingClientRect) {
                    if (typeof arguments.callee.offset != "number") {
                        var temp = document.createElement("div");
                        temp.style.cssText = "position:absolute;left:0;top:0;";
                        document.body.appendChild(temp);
                        arguments.callee.offset = -temp.getBoundingClientRect().top - scrollTop;
                        document.body.removeChild(temp);
                        temp = null;
                    }
                    var rect = element.getBoundingClientRect();
                    var offset = arguments.callee.offset;

                    return {
                        left: rect.left + offset,
                        right: rect.right + offset,
                        top: rect.top + offset,
                        bottom: rect.bottom + offset
                    };
                } else {
                    var actualLeft = getElementLeft(element);
                    var actualTop = getElementTop(element);
                    return {
                        left: actualLeft - scrollLeft,
                        right: actualLeft + element.offsetWidth - scrollLeft,
                        top: actualTop - scrollTop,
                        bottom: actualTop + element.offsetHeight - scrollTop
                    }
                }
            }

            //发送私信
            function send_personal_message() {
                receiver = $("#reciver").val();
                message_text = document.getElementById('message_content').value;
                var username_list = new Array()

                username_list.push(receiver);

                $.ajax({
                    type: 'GET',
                    url: '{{ url_for("message_api.is_username") }}',
                    data: {
                        "username": receiver
                    },
                    dataType: 'json',
                    success: function (data) {
                        if (data.exit == 'true') {
                            $.ajax({
                                type: 'POST',
                                url: '{{ url_for("message_api.send_message") }}',
                                data: {
                                    "username_list": username_list,
                                    "message_text": message_text
                                },
                                dataType: 'json',
                                success: function (data) {
                                    console.log(data)
                                    alert('发送成功！')
                                    $("#send_personal_message_modal").modal('hide')
                                    get_my_message_count()
                                    refresh()
                                }
                            })
                        }
                        else {
                            alert('不存在此用户！')
                        }
                    }
                })
            }

            //面板切换
            function all_message_show() {
                $.ajax({
                    type: 'GET',
                    url: '{{ url_for("message_api.request_page") }}',
                    dataType: 'json',
                    success: function (data) {
                        console.log(data);
                        var num_entries = data.page_num;
                        $("#my_pagination").pagination(num_entries, {
                            num_edge_entries: 1, //边缘页数
                            num_display_entries: 2, //主体页数
                            callback: pageselectCallback,
                            items_per_page: 1, //每页显示1项
                            prev_text: "前一页",
                            next_text: "后一页"
                        });
                    }
                });
                function pageselectCallback(page_index) {
                    $.ajax({
                        type: 'GET',
                        url: '{{ url_for("message_api.message_all") }}',
                        data: {
                            "page_num": page_index
                        },
                        async: false,
                        dataType: 'json',//希望服务器返回json格式的数据
                        success: function (data) {
                            postcomment = data;
                            post_comment(postcomment);
                        }
                    })
                }
            }

            //我的关注面板切换
            function follow_message_show() {
                $.ajax({
                    type: 'GET',
                    url: '{{ url_for("message_api.request_follow_page") }}',
                    dataType: 'json',
                    success: function (data) {
                        console.log(data);
                        var num_follow_entries = data.page_num;
                        $("#my_follow_pagination").pagination(num_follow_entries, {
                            num_edge_entries: 1, //边缘页数
                            num_display_entries: 2, //主体页数
                            callback: pagefollowCallback,
                            items_per_page: 1, //每页显示1项
                            prev_text: "前一页",
                            next_text: "后一页"
                        });
                    }
                });
                function pagefollowCallback(page_index) {
                    $.ajax({
                        type: 'GET',
                        url: '{{ url_for("message_api.message_follow") }}',
                        data: {
                            "page_num": page_index
                        },
                        dataType: 'json',//希望服务器返回json格式的数据
                        success: function (data) {
                            console.log(data);
                            postcommentfollow = data;
                            post_comment_follow(postcommentfollow);
                        }
                    })
                }
            }

            //我的动态面板切换
            function myown_message_show() {
                $.ajax({
                    type: 'GET',
                    url: '{{ url_for("message_api.request_myown_page") }}',
                    dataType: 'json',
                    success: function (data) {
                        console.log(data);
                        var num_myown_entries = data.page_num;
                        $("#my_own_pagination").pagination(num_myown_entries, {
                            num_edge_entries: 1, //边缘页数
                            num_display_entries: 2, //主体页数
                            callback: pagemyownCallback,
                            items_per_page: 1, //每页显示1项
                            prev_text: "前一页",
                            next_text: "后一页"
                        });
                    }
                });
                function pagemyownCallback(page_index) {
                    $.ajax({
                        type: 'GET',
                        url: '{{ url_for("message_api.message_myown") }}',
                        data: {
                            "page_num": page_index
                        },
                        dataType: 'json',//希望服务器返回json格式的数据
                        success: function (data) {
                            console.log(data);
                            postcommentmyown = data;
                            post_comment_myown(postcommentmyown);
                        }
                    });
                }
            }
            {#        全局变量用于存储当前用户所有消息#}
            data_message = {};
            //消息私信面板切换
            function accept_message_show() {
                $.ajax({
                    type: 'GET',
                    url: '{{ url_for("message_api.request_page") }}',
                    dataType: 'json',
                    success: function (data) {
                        data_message = data;
                        console.log(data_message);
                        creat_table_for_accept_message(data);
                    }
                });
            }
            //消息私信呈现
            function creat_table_for_accept_message(data) {
                if ($('#table_message').hasClass('dataTable')) {
                    dttable = $('#table_message').dataTable();
                    dttable.fnClearTable(); //清空一下table
                    dttable.fnDestroy(); //还原初始化了的datatable
                    $('#table_message_tbody').empty();
                    for (i = data.info_list.length - 1; i >= 0; i--) {
                        if (data.state_list[i] == 'N') {
                            $('#table_message_tbody').append(
                                "<tr class=\"task\"  id=\"" + i + "\" onclick=tr_click(this.id)>" +
                                "<td class=\"cell-icon\"><i class=\"icon-checker high\"></td>" +
                                "<td class=\"cell-title\">" + data.sender_list[i] + data.info_list[i] + "<br/>" + data.text_list[i].substr(0, 10) + "</td>" +
                                "<td class=\"cell-status hidden-phone hidden-tablet\">未读</td>" +
                                "<td class=\"cell-text align-right\">" + data.time_list[i] + "</td>" +
                                "</tr>"
                            )
                        }
                        else if (data.state_list[i] == 'Y') {
                            $('#table_message_tbody').append(
                                "<tr class=\"task resolved\" id=\"" + i + "\" onclick=tr_click(this.id)>" +
                                "<td class=\"cell-icon\"><i class=\"icon-checker high\"></td>" +
                                "<td class=\"cell-title\">" + data.sender_list[i] + data.info_list[i] + "<br/>" + data.text_list[i].substr(0, 10) + "</td>" +
                                "<td class=\"cell-status hidden-phone hidden-tablet\">已读</td>" +
                                "<td class=\"cell-text align-right\">" + data.time_list[i] + "</td>" +
                                "</tr>"
                            )
                        }
                    }

                    var table = $('#table_message').DataTable({
                        "lengthChange": false,
                        "pageLength": 5,
                        "searching": false,
                        "language": {
                            "emptyTable": "没有数据",
                            "loadingRecords": "加载中…",
                            "processing": "查询中…",
                            "search": "检索:",
                            "lengthMenu": "每页 _MENU_ 条",
                            "zeroRecords": "没有数据",
                            "paginate": {
                                "first": "第一页",
                                "last": "最后一页",
                                "next": "",
                                "previous": ""
                            },
                            "info": "第 _PAGE_ 页 / 总 _PAGES_ 页",
                            "infoEmpty": "没有数据",
                            "infoFiltered": "(过滤总件数 _MAX_ 条)",

                        },
                    });
                }
                else {
                    $('#table_message_tbody').empty();
                    for (i = data.info_list.length - 1; i >= 0; i--) {
                        if (data.state_list[i] == 'N') {
                            $('#table_message_tbody').append(
                                "<tr class=\"task\"  id=\"" + i + "\" onclick=tr_click(this.id)>" +
                                "<td class=\"cell-icon\"><i class=\"icon-checker high\"></td>" +
                                "<td class=\"cell-title\">" + data.sender_list[i] + data.info_list[i] + "<br/>" + data.text_list[i].substr(0, 10) + "</td>" +
                                "<td class=\"cell-status hidden-phone hidden-tablet\">未读</td>" +
                                "<td class=\"cell-text align-right\">" + data.time_list[i] + "</td>" +
                                "</tr>"
                            )
                        }
                        else if (data.state_list[i] == 'Y') {
                            $('#table_message_tbody').append(
                                "<tr class=\"task resolved\" id=\"" + i + "\" onclick=tr_click(this.id)>" +
                                "<td class=\"cell-icon\"><i class=\"icon-checker high\"></td>" +
                                "<td class=\"cell-title\">" + data.sender_list[i] + data.info_list[i] + "<br/>" + data.text_list[i].substr(0, 10) + "</td>" +
                                "<td class=\"cell-status hidden-phone hidden-tablet\">已读</td>" +
                                "<td class=\"cell-text align-right\">" + data.time_list[i] + "</td>" +
                                "</tr>"
                            )
                        }
                    }
                    var table = $('#table_message').DataTable({
                        "lengthChange": false,
                        "pageLength": 5,
                        "searching": false,
                        "language": {
                            "emptyTable": "没有数据",
                            "loadingRecords": "加载中…",
                            "processing": "查询中…",
                            "search": "检索:",
                            "lengthMenu": "每页 _MENU_ 条",
                            "zeroRecords": "没有数据",
                            "paginate": {
                                "first": "第一页",
                                "last": "最后一页",
                                "next": "",
                                "previous": ""
                            },
                            "info": "第 _PAGE_ 页 / 总 _PAGES_ 页",
                            "infoEmpty": "没有数据",
                            "infoFiltered": "(过滤总件数 _MAX_ 条)",

                        },
                    });
                }


            }
            //阅读消息
            function tr_click(position) {
                if (data_message.state_list[position] == "N") {
                    var info_id = data_message.id_list[position]
                    $.ajax({
                        type: 'GET',
                        url: '{{ url_for("message_api.read_message") }}',
                        data: {
                            "info_id": info_id
                        },
                        dataType: 'json',
                        success: function (data) {
                            accept_message_show()
                            get_my_message_count()
                        }
                    });
                }
                more_info(position)
            }
            //消息过长显示模态框
            function more_info(position) {
                $("#div_more_message").empty()
                html = '<div class="alert alert-block alert-success" ><h5>' + data_message.sender_list[position] + data_message.info_list[position] + '&nbsp&nbsp&nbsp&nbsp时间：' + data_message.time_list[position] + '</h5>' + data_message.text_list[position] + '</div>'
                $("#div_more_message").append(html)

                $('#more_info_modal').modal('show')
            }
            //刷新消息列表
            function refresh() {
                get_my_message_count();
                accept_message_show()
            }
        </script>

        <!-- 分页模块 -->
        <script>

            //首次访问
            $(function () {
                accept_message_show();
                //判断是否是管理员,群发消息权限,填充user_list
                $.ajax({
                    type: 'GET',
                    url: '{{ url_for("message_api.get_role") }}',
                    dataType: 'json',
                    success: function (data) {
                        if (data.role == 1) {
                            $("#send_message_div").append(
                                "<div class=\"pull-right\">" +
                                "<a data-toggle=\"modal\"" +
                                "data-target=\"#send_admin_message_modal\"" +
                                " class=\"btn btn-primary\">群发消息（管理员）</a>" +
                                "</div>"
                            )
                            $.ajax({
                                type: 'GET',
                                url: '{{ url_for("message_api.get_user_list") }}',
                                dataType: 'json',
                                success: function (data) {
                                    console.log(data);
                                    for (i = 0; i < data.user_list.length; i++) {
                                        str = "<tr ><td><input type='checkbox' class='user_table'  id='" + data.user_list[i] + "' ></td><td>" + data.user_list[i] + "</td></tr>"
                                        $("#user_tbody").append(str)
                                    }
                                }
                            })
                        }

                    }
                });
            });
            var send_list = new Array()

            //群发消息
            function send_admin_message() {
                {#群发选中事件#}
                $('.user_table').each(function () {
                    if ($(this).is(':checked')) {
                        send_list.push($(this).attr('id'))
                    }
                })
                if (send_list.length == 0) {
                    alert('请选择接收用户！')
                }
                else {
                    console.log(document.getElementById('admin_message_content').value)
                    $.ajax({
                        type: 'POST',
                        url: '{{ url_for("message_api.send_message") }}',
                        data: {
                            "username_list": send_list,
                            "message_text": document.getElementById('admin_message_content').value
                        },
                        dataType: 'json',
                        success: function (data) {
                            alert('发送成功！')
                            $("#send_admin_message_modal").modal('hide')
                            get_my_message_count()
                            refresh()
                        }
                    })
                }
            }
            $(document).ready(function () {
                $.fn.dataTable.ext.errMode = 'none';
            });

        </script>

    </div>

{% endblock %}