{% extends "stock_base.html" %}
{% block current_user %}
    {{ current_user.username }}
{% endblock %}
{% block body %}
    <div class="span9">
        <div class="content">
            <div class="btn-controls">
                <!--市场分析-->
                <div class="btn-box-row row-fluid">
                    <div class="module span12">
                        <div class="module-head">
                            <a href="#postable" aria-expanded="false" data-toggle="collapse">市场分析</a>
                        </div>
                        <div class="modal-body">
                            <div id="postable" style="margin: auto;width:95%">
                                <ul id="myTab" class="nav nav-tabs">
                                    <li class="disabled">
                                        <a href="javascript:return false;" data-toggle="tab" disabled='true'>视图：</a>
                                    </li>
                                    <li class="active"><a href="#chart" data-toggle="tab" onclick="CreateChart()">图表</a>
                                    </li>
                                    <li><a href="#table" data-toggle="tab" onclick="RequestTable()">数据</a></li>
                                </ul>
                                <div id="mychoice" style="width:18%;height:300px;float:left;overflow-y :auto">
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:black"
                                             id="i_tot_oper_rev"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="tot_oper_rev" checked="checked"
                                                          id="first_check">总营业收入</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="i_net_profit_is"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="net_profit_is">净利润总和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="i_wgsd_net_inc"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="wgsd_net_inc">股东利润和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="i_tot_assets"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="tot_assets">总资产总和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="i_tot_liab"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="tot_liab">总负债总和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="i_net_assets"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="net_assets">净资产总和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="i_wgsd_com_eq"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="wgsd_com_eq">股东权益和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="i_operatecashflow_ttm2"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="operatecashflow_ttm2">经营性现金</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="i_investcashflow_ttm2"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="investcashflow_ttm2">投资性现金</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="i_financecashflow_ttm2"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="financecashflow_ttm2">融资性现金</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="i_cashflow_ttm2"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="cashflow_ttm2">总现金流</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="i_free_cash_flow"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="free_cash_flow">自由现金流</label>
                                        </div>
                                    </div>
                                </div>
                                <div id="choice" class="tab-content">
                                    <div class="tab-pane fade in active" id="chart">
                                        <div id="mychart" style="width:100%;height:250px;float:right"></div>
                                    </div>
                                    <div class="tab-pane fade" id="table">
                                        <div id="mytable" style="width:100%;height:250px;float:right"></div>
                                    </div>
                                </div>
                                <div style="float:right;width:80%;height:40px;margin-top:10px;border-radius:8px;background-color:#dcdcdc">
                                    <div style="float: left;margin-left:0;margin-top:10px">
                                        <a style="width:20px;margin-left:5px;color: #0c0c0c;">起始时间:</a><input size="10"
                                                                                                              type="text"
                                                                                                              value="2007-12-31"
                                                                                                              id="endtime"
                                                                                                              readonly
                                                                                                              class="form_datetime">
                                        <a style="width:20px;margin-left:5px;color: #0c0c0c">结束时间:</a><input size="10"
                                                                                                             type="text"
                                                                                                             value="2016-12-31"
                                                                                                             id="starttime"
                                                                                                             readonly
                                                                                                             class="form_datetime">
                                        <a style="width:20px;margin-left:5px;color: #0c0c0c">单位:</a>
                                        <select style="width:50px;height:26px;font-size: 10px;" id="unit">
                                            <option value="0" style="font-size: 10px;">亿</option>
                                            <option value="1" style="font-size: 10px;">万亿</option>
                                        </select>
                                    </div>
                                </div>
                                <!--面板切换-->
                                <script>
                                    $("#mydropdown").on("click", "[data-stopPropagation]", function (e) {
                                        e.stopPropagation();
                                    })
                                </script>

                                <!--复选框操作-->
                                <script>
                                    var Chosenindexes = new Array();
                                    Chosenindexes = ['tot_oper_rev'];
                                    Chosenindexes['tot_oper_rev'] = "#000000";

                                    $(document).ready(function () {

                                    });
                                    $("div#mychoice :checkbox").change(function () {
                                        indexname = $(this).val();
                                        if ($(this).is(':checked') == true) {
                                            colorname = NewColor();
                                            console.log(this);
                                            Chosenindexes.push(indexname);
                                            Chosenindexes[indexname] = colorname;
                                            $("#i_" + indexname).css("background-color", colorname);
                                            console.log(Chosenindexes);
                                        }
                                        else {
                                            delete Chosenindexes[indexname]
                                            $("#i_" + indexname).css("background-color", "white");
                                            console.log(Chosenindexes);
                                        }
                                        $("div#unselected").empty();
                                        $("div#selected").empty();
                                        $("input[type=checkbox]").each(function () {//each()方法遍历所有的复选框
                                            if ($(this).is(':checked') == true) {//这里就可以判断当前是否被选择了
                                                var tempspan = $("<span class=\"label label-default\" data-stopPropagation=\"true\"id =\"" + indexname + "\">" + dict[indexname] + "</span>")
                                                tempspan.appendTo($("div#unselected"));
                                                $("div#unselected").append(" ");
                                            }
                                        })
                                        CreateChart();
                                        CreateTable();
                                        set_time();
                                    });
                                </script>

                                <!--搜索事件-->
                                <script>
                                    function selectline(linename) {
                                        for (var line in option.series) {
                                            l = parseInt(line);
                                            if (option.series[l].name == linename) {
                                                tempcolor = NewColor();
                                                option.series[l].lineStyle.normal.color = tempcolor;
                                                option.series[l].itemStyle.normal.color = tempcolor;
                                                $("span#" + linename).css('color', tempcolor);
                                                selectedindexes.push(l);
                                                selectedindexname.push(option.series[l].name);
                                                option.legend.data = selectedindexname;
                                                myChart.setOption(option);
                                            }
                                        }
                                    }
                                    function unselectline(linename) {
                                        for (var line in option.series) {
                                            l = parseInt(line);
                                            if (option.series[l].name == linename) {
                                                option.series[l].lineStyle.normal.color = '#C4D2DB';
                                                option.series[l].itemStyle.normal.color = '#C4D2DB';
                                                $("span#" + linename).css('color', 'white');
                                                selectedindexes.splice(selectedindexes.indexOf(l), 1);
                                                selectedindexname.splice(selectedindexname.indexOf(option.series[l].name), 1);
                                                option.legend.data = selectedindexname;
                                                myChart.setOption(option);

                                            }
                                        }

                                    }
                                </script>

                                <!--随机生成颜色-->
                                <script>
                                    function NewColor() {
                                        var colorElements = "0,1,2,3,4,5,6,7,8,9,a,b,c,d,e,f";
                                        var colorArray = colorElements.split(",");
                                        var color = "#";
                                        for (var i = 0; i < 6; i++) {
                                            color += colorArray[Math.floor(Math.random() * 16)];
                                        }
                                        return color;
                                    }
                                </script>

                                <!--时间控制框-->
                                <script>
                                    var starttime = "20071231";
                                    var endtime = "20161231";
                                    $(".form_datetime").datetimepicker({
                                        format: 'yyyy-mm-dd ',
                                        startView: 4,
                                        minView: 4,
                                        maxView: 4,
                                        autoclose: true,
                                        pickerPosition: 'top-right'
                                    });
                                    $('#starttime').datetimepicker('setStartDate', '2007-12-31');
                                    $('#starttime').datetimepicker('setEndDate', '2016-12-31');
                                    $('#endtime').datetimepicker('setStartDate', '2007-12-31');
                                    $('#endtime').datetimepicker('setEndDate', '2016-12-31');
                                    $('#starttime')
                                        .datetimepicker()
                                        .on('changeDate', function (ev) {
                                            starts = ev.date.Format("yyyy年Q4");
                                            option.dataZoom[0].startValue = starts;
                                            myChart.setOption(option);
                                            RequestTable();
                                        });
                                    $('#endtime')
                                        .datetimepicker()
                                        .on('changeDate', function (ev) {
                                            ends = ev.date.Format("yyyy年Q4");
                                            option.dataZoom[0].endValue = ends;
                                            myChart.setOption(option);
                                            RequestTable();
                                        });
                                    Date.prototype.Format = function (fmt) { //author: meizz
                                        var o = {
                                            "M+": this.getMonth() + 1, //月份
                                            "d+": this.getDate(), //日
                                            "h+": this.getHours(), //小时
                                            "m+": this.getMinutes(), //分
                                            "s+": this.getSeconds(), //秒
                                            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
                                            "S": this.getMilliseconds() //毫秒
                                        };
                                        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
                                        for (var k in o)
                                            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
                                        return fmt;
                                    }
                                    function dateformat(olddate) {
                                        newdate = []
                                        for (i = 0; i < olddate.length; i++) {
                                            var str = olddate[i];
                                            var reg = /1231/g;
                                            str = str.replace(reg, '年Q4');
                                            newdate.push(str)
                                        }
                                        return newdate
                                    }
                                    function datefor(olddate) {
                                        newdate = []
                                        for (i = 0; i < olddate.length; i++) {
                                            var str = olddate[i];
                                            var reg = /年Q4/g;
                                            str = str.replace(reg, '1231');
                                            newdate.push(str)
                                        }
                                        return newdate
                                    }
                                </script>

                                <!--单位转换-->
                                <script>
                                    denominator = 1
                                    $("select#unit").change(function () {
                                        flag = $(this).val();
                                        if (flag == "0") {
                                            denominator = 1;
                                            CreateChart();
                                            CreateTable();
                                            set_time();
                                        }
                                        if (flag == "1") {
                                            denominator = 10000;
                                            CreateChart();
                                            CreateTable();
                                            set_time();
                                        }
                                    });
                                    function numfilter(oldnum) {
                                        newnum = []
                                        for (i = 0; i < oldnum.length; i++) {
                                            temp = oldnum[i] / denominator;
                                            newnum.push(temp.toFixed(2))
                                        }
                                        return newnum;
                                    }
                                </script>

                                <!--建图-->
                                <script>
                                    var myChart = echarts.init(document.getElementById('mychart'));
                                    var market_results;
                                    var dict = {
                                        'tot_oper_rev': '总营业收入',
                                        'net_profit_is': '净利润总和',
                                        'wgsd_net_inc': '归属股东利润总和',
                                        'tot_assets': '总资产总和',
                                        'tot_liab': '总负债总和',
                                        'net_assets': '净资产总和',
                                        'wgsd_com_eq': '股东权益总和',
                                        'operatecashflow_ttm2': '经营性现金流总和',
                                        'investcashflow_ttm2': '投资性现金流总和',
                                        'financecashflow_ttm2': '融资性现金流总和',
                                        'cashflow_ttm2': '总现金流总和',
                                        'free_cash_flow': '自由现金流估计',
                                    };
                                    $.ajax({
                                        type: 'GET',
                                        url: '{{ url_for("restfulapi.market_value") }}',
                                        data: {
                                            starttime: '20071231',
                                            endtime: '20161231',
                                            indexes: ['tot_oper_rev', 'net_profit_is', 'wgsd_net_inc', 'tot_assets', 'tot_liab', 'net_assets', 'wgsd_com_eq', 'operatecashflow_ttm2', 'investcashflow_ttm2', 'financecashflow_ttm2', 'cashflow_ttm2', 'free_cash_flow']
                                        },
                                        dataType: 'json',
                                        success: function (data) {
                                            market_results = data;
                                            CreateChart();
                                        }
                                    });
                                    function CreateChart() {
                                        dataSeries = [];
                                        for (var i = 0; i < market_results.indexes.length; i++) {
                                            if (Chosenindexes.hasOwnProperty(market_results.indexes[i])) {
                                                temp = {
                                                    name: market_results.indexes[i],
                                                    type: 'line',
                                                    lineStyle: {normal: {width: 2}},
                                                    itemStyle: {normal: {color: Chosenindexes[market_results.indexes[i]]}},
                                                    symbolSize: 8,
                                                    smooth: true,
                                                    data: numfilter(eval("market_results." + market_results.indexes[i]))
                                                };
                                                dataSeries.push(temp);
                                            }
                                        }
                                        option = {
                                            title: {
                                                text: '财务指标分析图',
                                                left: '45%'
                                            },
                                            tooltip: {
                                                trigger: 'item',
                                                formatter: function (params) {
                                                    return dict[params.seriesName] + "<br/> 时间：" + params.name + "<br/> 数据：" + params.data;
                                                }
                                            },
                                            legend: {
                                                data: [],
                                                orient: 'vertical',
                                                left: '85%',
                                                top: '10%',
                                                formatter: function (name) {
                                                    return dict[name];
                                                }
                                            },
                                            grid: {
                                                left: '5%',
                                                top: '10%',
                                                containLabel: true
                                            },
                                            toolbox: {
                                                feature: {
                                                    magicType: {
                                                        type: ['line', 'bar']
                                                    }
                                                }
                                            },
                                            xAxis: {
                                                type: 'category',
                                                boundaryGap: false,
                                                axisTick: {
                                                    show: false
                                                },
                                                data: dateformat(market_results.the_year),
                                                Interval: 5
                                            },
                                            yAxis: {
                                                type: 'value',
                                                axisTick: {
                                                    show: false
                                                },
                                            },
                                            dataZoom: [
                                                {
                                                    type: 'slider',
                                                    xAxisIndex: [0],
                                                    startValue: "2016年Q4",
                                                    endValue: "2007年Q4",
                                                    filterMode: 'filter',
                                                }
                                            ],
                                            series: dataSeries
                                        };
                                        myChart.setOption(option, true);
                                        myChart.on('datazoom', function (params) {
                                            option.xAxis.interval = 10 * (params.end - params.start) / 100;
                                            var ends = (2016 - Math.ceil(params.start / 100 * 9)) + '-12-31'
                                            if (Math.ceil(1 - params.end / 100)) {
                                                var starts = (2016 - Math.ceil(params.end / 100 * 9)) + '-12-31'
                                            }
                                            else {
                                                var starts = '2007-12-31'
                                            }
                                            set_timepicker(starts, ends)
                                        });
                                        function set_timepicker(start, end) {
                                            document.getElementById('endtime').value = start
                                            document.getElementById('starttime').value = end
                                        }
                                    }
                                    function set_time() {
                                        document.getElementById('endtime').value = "2007-12-31"
                                        document.getElementById('starttime').value = "2016-12-31"
                                    }
                                </script>

                                <!--建表-->
                                <script>
                                    var market_results_t;
                                    var invest_results_t;
                                    function RequestTable() {
                                        var opt = myChart.getOption();
                                        var dz = opt.dataZoom[0];
                                        $.ajax({
                                            type: 'GET',
                                            url: '{{url_for("restfulapi.market_value")}}',
                                            data: {
                                                starttime: opt.xAxis[0].data[dz.endValue],
                                                endtime: opt.xAxis[0].data[dz.startValue],
                                                indexes: ['tot_oper_rev', 'net_profit_is', 'wgsd_net_inc', 'tot_assets', 'tot_liab', 'net_assets', 'wgsd_com_eq', 'operatecashflow_ttm2', 'investcashflow_ttm2', 'financecashflow_ttm2', 'cashflow_ttm2', 'free_cash_flow']
                                            },
                                            dataType: 'json',//希望服务器返回json格式的数据
                                            success: function (data) {
                                                console.log(data)
                                                market_results_t = data;
                                                invest_results_t = data;
                                                CreateTable();
                                            }
                                        })
                                    }
                                    function CreateTable() {
                                        $("#mytable").empty();
                                        var table = $("<table id=\"temptable\" style=\"text-align:center\" class=\"row-border hover order-column\" cellspacing=\"0\" width=\"100%\"  >");
                                        table.appendTo($("#mytable"));
                                        th = $("<thead></thead>");
                                        th.appendTo(table);
                                        var tr = $("<tr></tr>");
                                        tr.appendTo(th);
                                        var td = $("<td id=\"subject\">" + "项目" + "</td>");
                                        td.appendTo(tr);
                                        theyear = dateformat(market_results_t.the_year)
                                        for (var j = 0; j < theyear.length; j++) {
                                            var td = $("<td>" + theyear[j] + "</td>");
                                            td.appendTo(tr);
                                        }
                                        tb = $("<tbody></tbody>");
                                        tb.appendTo(table);
                                        $("#mytable").append("</table>");
                                        var mydatatb = $('#temptable').DataTable({
                                            "info": false,
                                            "processing": true,
                                            "scrollX": true,
                                            "searching": true,
                                            "fixedColumns": { //固定列的配置项
                                                "leftColumns": 1//固定左边第一列
                                            },
                                            "language": {
                                                "emptyTable": "没有数据",
                                                "loadingRecords": "加载中…",
                                                "processing": "查询中…",
                                                "search": "检索:",
                                                "lengthMenu": "每页 _MENU_ 条",
                                                "zeroRecords": "没有数据",
                                                "paginate": {
                                                    "first": "第一页",
                                                    "last": "最后一页",
                                                    "next": "",
                                                    "previous": ""
                                                },
                                                "info": "第 _PAGE_ 页 / 总 _PAGES_ 页",
                                                "infoEmpty": "没有数据",
                                                "infoFiltered": "(过滤总件数 _MAX_ 条)"
                                            }
                                        });
                                        setTimeout("$(\"#subject\").trigger(\"click\")", 100);
                                        for (var i = 0; i < market_results_t.indexes.length; i++) {
                                            if (Chosenindexes.hasOwnProperty(market_results_t.indexes[i])) {
                                                var rowNode = mydatatb
                                                    .row.add([dict[market_results_t.indexes[i]]].concat(numfilter(eval("market_results_t." + market_results_t.indexes[i]))))
                                                    .draw()
                                                    .node();
                                                $(rowNode)
                                                    .attr('id', market_results_t.indexes[i]);
                                            }
                                        }
                                        for (var key in Chosenindexes) {
                                            $('tr#' + key).css('color', Chosenindexes[key])
                                        }
                                    }
                                </script>
                            </div>
                        </div>
                    </div>
                </div>

                <!--行业状况-->
                <div class="btn-box-row row-fluid">
                    <div class="module span12" style="background-color: transparent">
                        <div class="module-head">行业状况</div>
                        <div class="row-fluid">

                            <div class="btn-box small span3">
                                <div id="one" style="width:100%;height:200px;background-color: white">
                                    <script>
                                        var myChart11 = echarts.init(document.getElementById('one'));
                                        var dact = {
                                            '10': '能源',
                                            '15': '材料',
                                            '20': '工业',
                                            '25': '可选消费',
                                            '30': '日常消费',
                                            '35': '医疗保健',
                                            '40': '金融',
                                            '45': '信息技术',
                                            '55': '公用事业',
                                            '60': '房地产',
                                        };
                                        $.ajax({
                                            type: 'GET',
                                            url: '{{ url_for("restfulapi.market_one") }}',
                                            data: {
                                                time: '20161231',
                                                indexes: ['tot_oper_rev'],
                                            },
                                            dataType: 'json',
                                            success: function (data) {
                                                dataSeries = [];
                                                for (var i = 0; i < data.my_code.length; i++) {
                                                    temp = {
                                                        name: dact[data.my_code[i]],
                                                        value: data.my_num[i].toFixed(2)
                                                    };
                                                    dataSeries.push(temp);
                                                }
                                                option = {
                                                    title: {
                                                        text: '营业总收入',
                                                        left: '25%'
                                                    },
                                                    tooltip: {
                                                        trigger: 'item',
                                                    },
                                                    series: [
                                                        {
                                                            type: 'pie',
                                                            radius: ['50%', '70%'],
                                                            avoidLabelOverlap: false,
                                                            label: {
                                                                normal: {
                                                                    show: false,
                                                                    position: 'center'
                                                                },
                                                                emphasis: {
                                                                    show: true,
                                                                    textStyle: {
                                                                        fontSize: '30',
                                                                        fontWeight: 'bold'
                                                                    }
                                                                }
                                                            },
                                                            labelLine: {
                                                                normal: {
                                                                    show: false
                                                                }
                                                            },
                                                            data: dataSeries
                                                        }
                                                    ]
                                                };
                                                myChart11.setOption(option, true);
                                            }
                                        });
                                    </script>
                                </div>
                            </div>
                            <div class="btn-box small span3">
                                <div id="two" style="width:100%;height:200px;background-color: white">
                                    <script>
                                        var myChart12 = echarts.init(document.getElementById('two'));
                                        var dact = {
                                            '10': '能源',
                                            '15': '材料',
                                            '20': '工业',
                                            '25': '可选消费',
                                            '30': '日常消费',
                                            '35': '医疗保健',
                                            '40': '金融',
                                            '45': '信息技术',
                                            '55': '公用事业',
                                            '60': '房地产',
                                        };
                                        $.ajax({
                                            type: 'GET',
                                            url: '{{ url_for("restfulapi.market_one") }}',
                                            data: {
                                                time: '20161231',
                                                indexes: ['tot_assets'],
                                            },
                                            dataType: 'json',
                                            success: function (data) {
                                                dataSeries = [];
                                                for (var i = 0; i < data.my_code.length; i++) {
                                                    temp = {
                                                        name: dact[data.my_code[i]],
                                                        value: data.my_num[i].toFixed(2)
                                                    };
                                                    dataSeries.push(temp);
                                                }
                                                option = {
                                                    title: {
                                                        text: '总资产',
                                                        left: '33%'
                                                    },
                                                    tooltip: {
                                                        trigger: 'item',
                                                    },
                                                    series: [
                                                        {
                                                            type: 'pie',
                                                            radius: ['50%', '70%'],
                                                            avoidLabelOverlap: false,
                                                            label: {
                                                                normal: {
                                                                    show: false,
                                                                    position: 'center'
                                                                },
                                                                emphasis: {
                                                                    show: true,
                                                                    textStyle: {
                                                                        fontSize: '30',
                                                                        fontWeight: 'bold'
                                                                    }
                                                                }
                                                            },
                                                            labelLine: {
                                                                normal: {
                                                                    show: false
                                                                }
                                                            },
                                                            data: dataSeries
                                                        }
                                                    ]
                                                };
                                                myChart12.setOption(option, true);
                                            }
                                        });
                                    </script>
                                </div>
                            </div>
                            <div class="btn-box small span3">
                                <div id="three" style="width:100%;height:200px;background-color: white">
                                    <script>
                                        var myChart13 = echarts.init(document.getElementById('three'));
                                        var dact = {
                                            '10': '能源',
                                            '15': '材料',
                                            '20': '工业',
                                            '25': '可选消费',
                                            '30': '日常消费',
                                            '35': '医疗保健',
                                            '40': '金融',
                                            '45': '信息技术',
                                            '55': '公用事业',
                                            '60': '房地产',
                                        };
                                        $.ajax({
                                            type: 'GET',
                                            url: '{{ url_for("restfulapi.market_one") }}',
                                            data: {
                                                time: '20161231',
                                                indexes: ['tot_liab'],
                                            },
                                            dataType: 'json',
                                            success: function (data) {
                                                dataSeries = [];
                                                for (var i = 0; i < data.my_code.length; i++) {
                                                    temp = {
                                                        name: dact[data.my_code[i]],
                                                        value: data.my_num[i].toFixed(2)
                                                    };
                                                    dataSeries.push(temp);
                                                }
                                                option = {
                                                    title: {
                                                        text: '总负债',
                                                        left: '33%'
                                                    },
                                                    tooltip: {
                                                        trigger: 'item',
                                                    },
                                                    series: [
                                                        {
                                                            type: 'pie',
                                                            radius: ['50%', '70%'],
                                                            avoidLabelOverlap: false,
                                                            label: {
                                                                normal: {
                                                                    show: false,
                                                                    position: 'center'
                                                                },
                                                                emphasis: {
                                                                    show: true,
                                                                    textStyle: {
                                                                        fontSize: '30',
                                                                        fontWeight: 'bold'
                                                                    }
                                                                }
                                                            },
                                                            labelLine: {
                                                                normal: {
                                                                    show: false
                                                                }
                                                            },
                                                            data: dataSeries
                                                        }
                                                    ]
                                                };
                                                myChart13.setOption(option, true);
                                            }
                                        });
                                    </script>
                                </div>
                            </div>
                            <div class="btn-box small span3">
                                <div id="four" style="width:100%;height:200px;background-color: white">
                                    <script>
                                        var myChart14 = echarts.init(document.getElementById('four'));
                                        var dact = {
                                            '10': '能源',
                                            '15': '材料',
                                            '20': '工业',
                                            '25': '可选消费',
                                            '30': '日常消费',
                                            '35': '医疗保健',
                                            '40': '金融',
                                            '45': '信息技术',
                                            '55': '公用事业',
                                            '60': '房地产',
                                        };
                                        $.ajax({
                                            type: 'GET',
                                            url: '{{ url_for("restfulapi.market_one") }}',
                                            data: {
                                                time: '20161231',
                                                indexes: ['wgsd_com_eq'],
                                            },
                                            dataType: 'json',
                                            success: function (data) {
                                                dataSeries = [];
                                                for (var i = 0; i < data.my_code.length; i++) {
                                                    temp = {
                                                        name: dact[data.my_code[i]],
                                                        value: data.my_num[i].toFixed(2)
                                                    };
                                                    dataSeries.push(temp);
                                                }
                                                option = {
                                                    title: {
                                                        text: '股东权益',
                                                        left: '30%'
                                                    },
                                                    tooltip: {
                                                        trigger: 'item',
                                                    },
                                                    series: [
                                                        {
                                                            type: 'pie',
                                                            radius: ['50%', '70%'],
                                                            avoidLabelOverlap: false,
                                                            label: {
                                                                normal: {
                                                                    show: false,
                                                                    position: 'center'
                                                                },
                                                                emphasis: {
                                                                    show: true,
                                                                    textStyle: {
                                                                        fontSize: '30',
                                                                        fontWeight: 'bold'
                                                                    }
                                                                }
                                                            },
                                                            labelLine: {
                                                                normal: {
                                                                    show: false
                                                                }
                                                            },
                                                            data: dataSeries
                                                        }
                                                    ]
                                                };
                                                myChart14.setOption(option, true);
                                            }
                                        });
                                    </script>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!--部门-->
                <div class="btn-box-row row-fluid">
                    <div class="module span12">
                        <div class="module-head">
                            <a href="#postgroup1" aria - expanded="false" data - toggle="collapse"> 部门 </a>
                        </div>
                        <div class="modal-body">
                            <div id="postgroup1" style="margin: auto;width:95%;height:auto">
                                <div class="form-search" id="form1">
                                    <div style="height:50px" class="input-group">
                                        <input id="stockcode1" list="itemlist1" name="stockcode" type="text"
                                               style="margin-top:0;margin-left:10px;height: 30px">
                                        <ul class="dropdown-menu dropdown-menu-right" role="menu"></ul>
                                        <datalist id="itemlist1">
                                            <option value="10">能源</option>
                                            <option value="15">材料</option>
                                            <option value="20">工业</option>
                                            <option value="25">可选消费</option>
                                            <option value="30">日常消费</option>
                                            <option value="35">医疗保健</option>
                                            <option value="40">金融</option>
                                            <option value="45">信息技术</option>
                                            <option value="50">电信服务</option>
                                            <option value="55">公共事业</option>
                                            <option value="60">房地产</option>
                                        </datalist>
                                        <button id="submit1" type="submit" class="btn btn-default"
                                                style="margin-top:0;margin-left:20px;width:150px;height: 30px"
                                                data-toggle="tooltip"
                                                data-placement="right">搜索
                                        </button>
                                    </div>
                                </div>
                                <ul id="myTab1" class="nav nav-tabs">
                                    <li class="disabled">
                                        <a href="javascript:return false;" data-toggle="tab" disabled='true'>视图：</a>
                                    </li>
                                    <li class="active"><a href="#chart1" data-toggle="tab">图表</a>
                                    </li>
                                    <li><a href="#table1" data-toggle="tab" onclick="RequestTable1()">数据</a></li>
                                </ul>
                                <div id="mychoice1" style="width:18%;height:300px;float:left;overflow-y :auto">
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:black"
                                             id="a_tot_oper_rev"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="tot_oper_rev" checked="checked"
                                                          id="thefirst1">总营业收入</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="a_net_profit_is"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="net_profit_is">净利润总和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="a_wgsd_net_inc"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="wgsd_net_inc">股东利润和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="a_tot_assets"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="tot_assets">总资产总和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="a_tot_liab"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="tot_liab">总负债总和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="a_net_assets"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="net_assets">净资产总和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="a_wgsd_com_eq"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="wgsd_com_eq">股东权益和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="a_operatecashflow_ttm2"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="operatecashflow_ttm2">经营性现金</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="a_investcashflow_ttm2"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="investcashflow_ttm2">投资性现金</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="a_financecashflow_ttm2"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="financecashflow_ttm2">融资性现金</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="a_cashflow_ttm2"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="cashflow_ttm2">总现金流</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="a_free_cash_flow"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="free_cash_flow">自由现金流</label>
                                        </div>
                                    </div>
                                </div>
                                <div id="choice1" class="tab-content">
                                    <div class="tab-pane fade in active" id="chart1">
                                        <div id="mychart1" style="width:100%;height:250px;float:right"></div>
                                    </div>
                                    <div class="tab-pane fade" id="table1">
                                        <div id="mytable1" style="width:100%;height:250px;float:right"></div>
                                    </div>
                                </div>
                                <div style="float:right;width:80%;height:40px;margin-top:10px;border-radius:8px;background-color:#dcdcdc">
                                    <div style="float: left;margin-left:0;margin-top:10px">
                                        <a style="width:20px;margin-left:5px;color: #0c0c0c;">起始时间:</a><input size="10"
                                                                                                              type="text"
                                                                                                              value="1991-12-31"
                                                                                                              id="endtime1"
                                                                                                              readonly
                                                                                                              class="form_datetime">
                                        <a style="width:20px;margin-left:5px;color: #0c0c0c">结束时间:</a><input size="10"
                                                                                                             type="text"
                                                                                                             value="2016-12-31"
                                                                                                             id="starttime1"
                                                                                                             readonly
                                                                                                             class="form_datetime">
                                        <a style="width:20px;margin-left:5px;color: #0c0c0c">单位:</a>
                                        <select style="width:50px;height:26px;font-size: 10px;" id="unit1">
                                            <option value="0" style="font-size: 10px;">亿</option>
                                            <option value="1" style="font-size: 10px;">千亿</option>
                                        </select>
                                    </div>
                                </div>

                                <script>
                                    $("#submit1").click(function () {
                                        thiscode1 = $("#stockcode1").val();
                                        Chosenindexes1 = ['tot_oper_rev'];
                                        Chosenindexes1['tot_oper_rev'] = "#000000";
                                        requestChart1();
                                        $("div#mychoice1 :checkbox").each(function () {//each()方法遍历所有的复选框
                                            a = $(this).val();
                                            if ($(this).is(':checked') == true) {//这里就可以判断当前是否被选择了
                                                if (a != 'tot_oper_rev') {
                                                    $(this).removeAttr("checked");
                                                    $("#a_" + a).css("background-color", "white");
                                                }
                                            }
                                        });
                                        $("#thefirst1").prop("checked",true);
                                        $("#a_tot_oper_rev").css("background-color", "#000000");
                                    });
                                </script>
                                <!--建图-->
                                <script>
                                    var myChart1 = echarts.init(document.getElementById('mychart1'));
                                    var market_results1;
                                    var thiscode1 = '10';
                                    var dict = {
                                        'tot_oper_rev': '总营业收入',
                                        'net_profit_is': '净利润总和',
                                        'wgsd_net_inc': '归属股东利润总和',
                                        'tot_assets': '总资产总和',
                                        'tot_liab': '总负债总和',
                                        'net_assets': '净资产总和',
                                        'wgsd_com_eq': '股东权益总和',
                                        'operatecashflow_ttm2': '经营性现金流总和',
                                        'investcashflow_ttm2': '投资性现金流总和',
                                        'financecashflow_ttm2': '融资性现金流总和',
                                        'cashflow_ttm2': '总现金流总和',
                                        'free_cash_flow': '自由现金流估计',
                                        'net_profit_rate': '平均净利润率',
                                        'tot_assets_turnover': '平均总资产周转率',
                                        'equ_multi': '平均权益乘数',
                                        'roe_tot': '平均净资产收益率',
                                        'roe_holder': '平均净资产收益率（股东）'
                                    };
                                    $.ajax({
                                        type: 'GET',
                                        url: '{{ url_for("restfulapi.market_status1") }}',
                                        data: {
                                            code: thiscode1,
                                            starttime: '19911231',
                                            endtime: '20161231',
                                            indexes: ['tot_oper_rev'],
                                        },
                                        dataType: 'json',
                                        success: function (data) {
                                            dataSeries = [];
                                            temp = {
                                                name: data.indexes,
                                                type: 'line',
                                                lineStyle: {normal: {width: 2}},
                                                itemStyle: {normal: {color: '#000000'}},
                                                symbolSize: 8,
                                                smooth: true,
                                                data: numfilter1(eval("data." + data.indexes))
                                            };
                                            dataSeries.push(temp);
                                            option = {
                                                title: {
                                                    text: '财务指标分析图',
                                                    left: '45%'
                                                },
                                                tooltip: {
                                                    trigger: 'item',
                                                    formatter: function (params) {
                                                        return dict[params.seriesName] + "<br/> 时间：" + params.name + "<br/> 数据：" + params.data;
                                                    }
                                                },
                                                legend: {
                                                    data: [],
                                                    orient: 'vertical',
                                                    left: '85%',
                                                    top: '10%',
                                                    formatter: function (name) {
                                                        return dict[name];
                                                    }
                                                },
                                                grid: {
                                                    left: '5%',
                                                    top: '10%',
                                                    containLabel: true
                                                },
                                                toolbox: {
                                                    feature: {
                                                        magicType: {
                                                            type: ['line', 'bar']
                                                        }
                                                    }
                                                },
                                                xAxis: {
                                                    type: 'category',
                                                    boundaryGap: false,
                                                    axisTick: {
                                                        show: false
                                                    },
                                                    data: dateformat(data.the_year),
                                                    Interval: 5
                                                },
                                                yAxis: {
                                                    type: 'value',
                                                    axisTick: {
                                                        show: false
                                                    },
                                                },
                                                dataZoom: [
                                                    {
                                                        type: 'slider',
                                                        xAxisIndex: [0],
                                                        startValue: "2016年Q4",
                                                        endValue: "1991年Q4",
                                                        filterMode: 'filter',
                                                    }
                                                ],
                                                series: dataSeries
                                            };
                                            myChart1.setOption(option, true);
                                            myChart1.on('datazoom', function (params) {
                                                option.xAxis.interval = 10 * (params.end - params.start) / 100;
                                                var ends = (2016 - Math.ceil(params.start / 100 * 25)) + '-12-31'
                                                if (Math.ceil(1 - params.end / 100)) {
                                                    var starts = (1991 + Math.ceil((1 - params.end / 100) * 25) - 1) + '-12-31'
                                                }
                                                else {
                                                    var starts = '1991-12-31'
                                                }
                                                set_timepicker1(starts, ends)
                                            });
                                            function set_timepicker1(start, end) {
                                                document.getElementById('endtime1').value = start
                                                document.getElementById('starttime1').value = end
                                            }
                                        }
                                    });
                                    function requestChart1() {
                                        $.ajax({
                                            type: 'GET',
                                            url: '{{ url_for("restfulapi.market_status1") }}',
                                            data: {
                                                code: thiscode1,
                                                starttime: '19911231',
                                                endtime: '20161231',
                                                indexes: ['tot_oper_rev'],
                                            },
                                            dataType: 'json',
                                            success: function (data) {
                                                dataSeries = [];
                                                temp = {
                                                    name: data.indexes,
                                                    type: 'line',
                                                    lineStyle: {normal: {width: 2}},
                                                    itemStyle: {normal: {color: '#000000'}},
                                                    symbolSize: 8,
                                                    smooth: true,
                                                    data: numfilter1(eval("data." + data.indexes))
                                                };
                                                dataSeries.push(temp);
                                                option = {
                                                    title: {
                                                        text: '财务指标分析图',
                                                        left: '45%'
                                                    },
                                                    tooltip: {
                                                        trigger: 'item',
                                                        formatter: function (params) {
                                                            return dict[params.seriesName] + "<br/> 时间：" + params.name + "<br/> 数据：" + params.data;
                                                        }
                                                    },
                                                    legend: {
                                                        data: [],
                                                        orient: 'vertical',
                                                        left: '85%',
                                                        top: '10%',
                                                        formatter: function (name) {
                                                            return dict[name];
                                                        }
                                                    },
                                                    grid: {
                                                        left: '5%',
                                                        top: '10%',
                                                        containLabel: true
                                                    },
                                                    toolbox: {
                                                        feature: {
                                                            magicType: {
                                                                type: ['line', 'bar']
                                                            }
                                                        }
                                                    },
                                                    xAxis: {
                                                        type: 'category',
                                                        boundaryGap: false,
                                                        axisTick: {
                                                            show: false
                                                        },
                                                        data: dateformat(data.the_year),
                                                        Interval: 5
                                                    },
                                                    yAxis: {
                                                        type: 'value',
                                                        axisTick: {
                                                            show: false
                                                        },
                                                    },
                                                    dataZoom: [
                                                        {
                                                            type: 'slider',
                                                            xAxisIndex: [0],
                                                            startValue: "2016年Q4",
                                                            endValue: "1991年Q4",
                                                            filterMode: 'filter',
                                                        }
                                                    ],
                                                    series: dataSeries
                                                };
                                                myChart1.setOption(option, true);
                                                myChart1.on('datazoom', function (params) {
                                                    option.xAxis.interval = 10 * (params.end - params.start) / 100;
                                                    var ends = (2016 - Math.ceil(params.start / 100 * 25)) + '-12-31'
                                                    if (Math.ceil(1 - params.end / 100)) {
                                                        var starts = (1991 + Math.ceil((1 - params.end / 100) * 25) - 1) + '-12-31'
                                                    }
                                                    else {
                                                        var starts = '1991-12-31'
                                                    }
                                                    set_timepicker1(starts, ends)
                                                });
                                                function set_timepicker1(start, end) {
                                                    document.getElementById('endtime1').value = start
                                                    document.getElementById('starttime1').value = end
                                                }
                                            }
                                        });
                                    }
                                    function RequestChart1() {
                                        $.ajax({
                                            type: 'GET',
                                            url: '{{ url_for("restfulapi.market_status1") }}',
                                            data: {
                                                code: thiscode1,
                                                starttime: '19911231',
                                                endtime: '20161231',
                                                indexes: Chosenindexes1,
                                            },
                                            dataType: 'json',
                                            success: function (data) {
                                                market_results1 = data;
                                                CreateChart1();
                                            }
                                        });
                                    }
                                    function CreateChart1() {
                                        dataSeries = [];
                                        for (var i = 0; i < market_results1.indexes.length; i++) {
                                            temp = {
                                                name: market_results1.indexes[i],
                                                type: 'line',
                                                lineStyle: {normal: {width: 2}},
                                                itemStyle: {normal: {color: Chosenindexes1[market_results1.indexes[i]]}},
                                                symbolSize: 8,
                                                smooth: true,
                                                data: numfilter1(eval("market_results1." + market_results1.indexes[i]))
                                            };
                                            dataSeries.push(temp);
                                        }
                                        option = {
                                            title: {
                                                text: '财务指标分析图',
                                                left: '45%'
                                            },
                                            tooltip: {
                                                trigger: 'item',
                                                formatter: function (params) {
                                                    return dict[params.seriesName] + "<br/> 时间：" + params.name + "<br/> 数据：" + params.data;
                                                }
                                            },
                                            legend: {
                                                data: [],
                                                orient: 'vertical',
                                                left: '85%',
                                                top: '10%',
                                                formatter: function (name) {
                                                    return dict[name];
                                                }
                                            },
                                            grid: {
                                                left: '5%',
                                                top: '10%',
                                                containLabel: true
                                            },
                                            toolbox: {
                                                feature: {
                                                    magicType: {
                                                        type: ['line', 'bar']
                                                    }
                                                }
                                            },
                                            xAxis: {
                                                type: 'category',
                                                boundaryGap: false,
                                                axisTick: {
                                                    show: false
                                                },
                                                data: dateformat(market_results1.the_year),
                                                Interval: 5
                                            },
                                            yAxis: {
                                                type: 'value',
                                                axisTick: {
                                                    show: false
                                                },
                                            },
                                            dataZoom: [
                                                {
                                                    type: 'slider',
                                                    xAxisIndex: [0],
                                                    startValue: "2016年Q4",
                                                    endValue: "1991年Q4",
                                                    filterMode: 'filter',
                                                }
                                            ],
                                            series: dataSeries
                                        };
                                        myChart1.setOption(option, true);
                                        myChart1.on('datazoom', function (params) {
                                            option.xAxis.interval = 10 * (params.end - params.start) / 100;
                                            var ends = (2016 - Math.ceil(params.start / 100 * 25)) + '-12-31'
                                            if (Math.ceil(1 - params.end / 100)) {
                                                var starts = (1991 + Math.ceil((1 - params.end / 100) * 25) - 1) + '-12-31'
                                            }
                                            else {
                                                var starts = '1991-12-31'
                                            }
                                            set_timepicker1(starts, ends)
                                        });
                                        function set_timepicker1(start, end) {
                                            document.getElementById('endtime1').value = start
                                            document.getElementById('starttime1').value = end
                                        }
                                    }
                                    function set_time1() {
                                        document.getElementById('endtime1').value = "1991-12-31"
                                        document.getElementById('starttime1').value = "2016-12-31"
                                    }
                                </script>
                                <!--建表-->
                                <script>
                                    var market_results_t1;
                                    var invest_results_t1;
                                    function RequestTable1() {
                                        var opt = myChart1.getOption();
                                        var dz = opt.dataZoom[0];
                                        $.ajax({
                                            type: 'GET',
                                            url: '{{url_for("restfulapi.market_status1")}}',
                                            data: {
                                                code: thiscode1,
                                                starttime: opt.xAxis[0].data[dz.endValue],
                                                endtime: opt.xAxis[0].data[dz.startValue],
                                                indexes: Chosenindexes1
                                            },
                                            dataType: 'json',//希望服务器返回json格式的数据
                                            success: function (data) {
                                                console.log(data)
                                                market_results_t1 = data;
                                                invest_results_t1 = data;
                                                CreateTable1();
                                            }
                                        })
                                    }
                                    function CreateTable1() {
                                        $("#mytable1").empty();
                                        var table = $("<table id=\"temptable1\" style=\"text-align:center\" class=\"row-border hover order-column\" cellspacing=\"0\" width=\"100%\"  >");
                                        table.appendTo($("#mytable1"));
                                        th = $("<thead></thead>");
                                        th.appendTo(table);
                                        var tr = $("<tr></tr>");
                                        tr.appendTo(th);
                                        var td = $("<td id=\"subject\">" + "项目" + "</td>");
                                        td.appendTo(tr);
                                        theyear = dateformat(market_results_t1.the_year)
                                        for (var j = 0; j < theyear.length; j++) {
                                            var td = $("<td>" + theyear[j] + "</td>");
                                            td.appendTo(tr);
                                        }
                                        tb = $("<tbody></tbody>");
                                        tb.appendTo(table);
                                        $("#mytable1").append("</table>");
                                        var mydatatb = $('#temptable1').DataTable({
                                            "info": false,
                                            "processing": true,
                                            "scrollX": true,
                                            "searching": true,
                                            "fixedColumns": { //固定列的配置项
                                                "leftColumns": 1//固定左边第一列
                                            },
                                            "language": {
                                                "emptyTable": "没有数据",
                                                "loadingRecords": "加载中…",
                                                "processing": "查询中…",
                                                "search": "检索:",
                                                "lengthMenu": "每页 _MENU_ 条",
                                                "zeroRecords": "没有数据",
                                                "paginate": {
                                                    "first": "第一页",
                                                    "last": "最后一页",
                                                    "next": "",
                                                    "previous": ""
                                                },
                                                "info": "第 _PAGE_ 页 / 总 _PAGES_ 页",
                                                "infoEmpty": "没有数据",
                                                "infoFiltered": "(过滤总件数 _MAX_ 条)"
                                            }
                                        });
                                        setTimeout("$(\"#subject\").trigger(\"click\")", 100);
                                        for (var i = 0; i < market_results_t1.indexes.length; i++) {
                                            var rowNode = mydatatb
                                                .row.add([dict[market_results_t1.indexes[i]]].concat(numfilter1(eval("market_results_t1." + market_results_t1.indexes[i]))))
                                                .draw()
                                                .node();
                                            $(rowNode)
                                                .attr('id', market_results_t1.indexes[i]);
                                        }
                                        for (var key in Chosenindexes1) {
                                            $('tr#' + key).css('color', Chosenindexes1[key])
                                        }
                                    }
                                </script>
                                <!--复选框操作-->
                                <script>
                                    var Chosenindexes1 = new Array();
                                    Chosenindexes1 = ['tot_oper_rev'];
                                    Chosenindexes1['tot_oper_rev'] = "#000000";
                                    $("div#mychoice1 :checkbox").change(function () {
                                        indexname1 = $(this).val();
                                        if ($(this).is(':checked') == true) {
                                            colorname1 = NewColor();
                                            console.log(this);
                                            Chosenindexes1.push(indexname1);
                                            Chosenindexes1[indexname1] = colorname1;
                                            $("#a_" + indexname1).css("background-color", colorname1);
                                            console.log(Chosenindexes1);
                                        }
                                        else {
                                            Chosenindexes1.remove(indexname1);
                                            console.log(Chosenindexes1);
                                            $("#a_" + indexname1).css("background-color", "white");
                                        }
                                        RequestChart1();
                                        RequestTable1()
                                        set_time1();
                                    });
                                </script>
                                <!--时间控制框-->
                                <script>
                                    var starttime1 = "19911231";
                                    var endtime1 = "20161231";
                                    $(".form_datetime").datetimepicker({
                                        format: 'yyyy-mm-dd ',
                                        startView: 4,
                                        minView: 4,
                                        maxView: 4,
                                        autoclose: true,
                                        pickerPosition: 'top-right'
                                    });
                                    $('#starttime1').datetimepicker('setStartDate', '1991-12-31');
                                    $('#starttime1').datetimepicker('setEndDate', '2016-12-31');
                                    $('#endtime1').datetimepicker('setStartDate', '1991-12-31');
                                    $('#endtime1').datetimepicker('setEndDate', '2016-12-31');
                                    $('#starttime1')
                                        .datetimepicker()
                                        .on('changeDate', function (ev) {
                                            starts = ev.date.Format("yyyy年Q4");
                                            option.dataZoom[0].startValue = starts;
                                            myChart1.setOption(option);
                                            RequestTable1();
                                        });
                                    $('#endtime1')
                                        .datetimepicker()
                                        .on('changeDate', function (ev) {
                                            ends = ev.date.Format("yyyy年Q4");
                                            option.dataZoom[0].endValue = ends;
                                            myChart1.setOption(option);
                                            RequestTable1();
                                        });
                                    Date.prototype.Format = function (fmt) { //author: meizz
                                        var o = {
                                            "M+": this.getMonth() + 1, //月份
                                            "d+": this.getDate(), //日
                                            "h+": this.getHours(), //小时
                                            "m+": this.getMinutes(), //分
                                            "s+": this.getSeconds(), //秒
                                            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
                                            "S": this.getMilliseconds() //毫秒
                                        };
                                        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
                                        for (var k in o)
                                            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
                                        return fmt;
                                    }
                                    function dateformat(olddate) {
                                        newdate = []
                                        for (i = 0; i < olddate.length; i++) {
                                            var str = olddate[i];
                                            var reg = /1231/g;
                                            str = str.replace(reg, '年Q4');
                                            newdate.push(str)
                                        }
                                        return newdate
                                    }
                                </script>
                                <!--单位转换-->
                                <script>
                                    denominator1 = 1
                                    $("select#unit1").change(function () {
                                        flag = $(this).val();
                                        if (flag == "0") {
                                            denominator1 = 1;
                                            RequestChart1();
                                            CreateTable1();
                                            set_time1();
                                        }
                                        if (flag == "1") {
                                            denominator1 = 1000;
                                            RequestChart1();
                                            CreateTable1();
                                            set_time1();
                                        }
                                    });
                                    function numfilter1(oldnum) {
                                        newnum = []
                                        for (i = 0; i < oldnum.length; i++) {
                                            temp = oldnum[i] / denominator1;
                                            newnum.push(temp.toFixed(2))
                                        }
                                        return newnum;
                                    }
                                </script>
                                <!--面板切换-->
                                <script>
                                    $("#mydropdown").on("click", "[data-stopPropagation]", function (e) {
                                        e.stopPropagation();
                                    })
                                </script>
                                <!--随机生成颜色-->
                                <script>
                                    function NewColor() {
                                        var colorElements = "0,1,2,3,4,5,6,7,8,9,a,b,c,d,e,f";
                                        var colorArray = colorElements.split(",");
                                        var color = "#";
                                        for (var i = 0; i < 6; i++) {
                                            color += colorArray[Math.floor(Math.random() * 16)];
                                        }
                                        return color;
                                    }
                                </script>
                                <!--删除函数-->
                                <script>
                                    Array.prototype.indexOf = function (val) {
                                        for (var i = 0; i < this.length; i++) {
                                            if (this[i] == val) return i;
                                        }
                                        return -1;
                                    };
                                    Array.prototype.remove = function (val) {
                                        var index = this.indexOf(val);
                                        if (index > -1) {
                                            this.splice(index, 1);
                                        }
                                    };
                                </script>
                            </div>
                        </div>
                    </div>
                </div>

                <!--行业组-->
                <div class="btn-box-row row-fluid">
                    <div class="module span12">
                        <div class="module-head">
                            <a href="#postgroup2" aria - expanded="false" data - toggle="collapse"> 行业组 </a>
                        </div>
                        <div class="modal-body">
                            <div id="postgroup2" style="margin: auto;width:95%;height:auto">
                                <div class="form-search" id="form2">
                                    <div style="height:50px" class="input-group">
                                        <input id="stockcode2" list="itemlist2" name="stockcode" type="text"
                                               style="margin-top:0;margin-left:10px;height: 30px">
                                        <ul class="dropdown-menu dropdown-menu-right" role="menu"></ul>
                                        <datalist id="itemlist2">
                                            <option value="1010">能源Ⅱ</option>
                                            <option value="1510">材料Ⅱ</option>
                                            <option value="2010">资本货物</option>
                                            <option value="2020">商业和专业服务</option>
                                            <option value="2030">运输</option>
                                            <option value="2510">汽车与汽车零部件</option>
                                            <option value="2520">耐用消费品与服装</option>
                                            <option value="2530">消费者服务Ⅱ</option>
                                            <option value="2540">媒体Ⅱ</option>
                                            <option value="2550">零售业</option>
                                            <option value="3010">食品与主要用品零售Ⅱ</option>
                                            <option value="3020">食品、饮料与烟草</option>
                                            <option value="3030">家庭与个人用品</option>
                                            <option value="3510">医疗保健设备与服务</option>
                                            <option value="3520">制药、生物科技与生命科学</option>
                                            <option value="4010">银行</option>
                                            <option value="4020">多元金融</option>
                                            <option value="4030">保险Ⅱ</option>
                                            <option value="4510">软件与服务</option>
                                            <option value="4520">技术硬件与设备</option>
                                            <option value="4530">半导体与半导体生产设备</option>
                                            <option value="5010">电信服务Ⅱ</option>
                                            <option value="5510">公用事业Ⅱ</option>
                                            <option value="6010">房地产Ⅱ</option>
                                        </datalist>
                                        <button id="submit2" type="submit" class="btn btn-default"
                                                style="margin-top:0;margin-left:20px;width:150px;height: 30px"
                                                data-toggle="tooltip"
                                                data-placement="right">搜索
                                        </button>
                                    </div>
                                </div>
                                <ul id="myTab2" class="nav nav-tabs">
                                    <li class="disabled">
                                        <a href="javascript:return false;" data-toggle="tab" disabled='true'>视图：</a>
                                    </li>
                                    <li class="active"><a href="#chart2" data-toggle="tab">图表</a>
                                    </li>
                                    <li><a href="#table2" data-toggle="tab" onclick="RequestTable2()">数据</a></li>
                                </ul>
                                <div id="mychoice2" style="width:18%;height:300px;float:left;overflow-y :auto">
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:black"
                                             id="b_tot_oper_rev"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="tot_oper_rev"
                                                          checked="checked" id="thefirst2">总营业收入</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="b_net_profit_is"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="net_profit_is">净利润总和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="b_wgsd_net_inc"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="wgsd_net_inc">股东利润和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="b_tot_assets"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="tot_assets">总资产总和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="b_tot_liab"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="tot_liab">总负债总和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="b_net_assets"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="net_assets">净资产总和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="b_wgsd_com_eq"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="wgsd_com_eq">股东权益和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="b_operatecashflow_ttm2"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="operatecashflow_ttm2">经营性现金</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="b_investcashflow_ttm2"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="investcashflow_ttm2">投资性现金</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="b_financecashflow_ttm2"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="financecashflow_ttm2">融资性现金</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="b_cashflow_ttm2"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="cashflow_ttm2">总现金流</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="b_free_cash_flow"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="free_cash_flow">自由现金流</label>
                                        </div>
                                    </div>
                                </div>
                                <div id="choice2" class="tab-content">
                                    <div class="tab-pane fade in active" id="chart2">
                                        <div id="mychart2" style="width:100%;height:250px;float:right"></div>
                                    </div>
                                    <div class="tab-pane fade" id="table2">
                                        <div id="mytable2" style="width:100%;height:250px;float:right"></div>
                                    </div>
                                </div>
                                <div style="float:right;width:80%;height:40px;margin-top:10px;border-radius:8px;background-color:#dcdcdc">
                                    <div style="float: left;margin-left:0;margin-top:10px">
                                        <a style="width:20px;margin-left:5px;color: #0c0c0c;">起始时间:</a><input size="10"
                                                                                                              type="text"
                                                                                                              value="1991-12-31"
                                                                                                              id="endtime2"
                                                                                                              readonly
                                                                                                              class="form_datetime">
                                        <a style="width:20px;margin-left:5px;color: #0c0c0c">结束时间:</a><input size="10"
                                                                                                             type="text"
                                                                                                             value="2016-12-31"
                                                                                                             id="starttime2"
                                                                                                             readonly
                                                                                                             class="form_datetime">
                                        <a style="width:20px;margin-left:5px;color: #0c0c0c">单位:</a>
                                        <select style="width:50px;height:26px;font-size: 10px;" id="unit2">
                                            <option value="0" style="font-size: 10px;">亿</option>
                                            <option value="1" style="font-size: 10px;">千亿</option>
                                        </select>
                                    </div>
                                </div>

                                <script>
                                    $("#submit2").click(function () {
                                        thiscode2 = $("#stockcode2").val();
                                        Chosenindexes2 = ['tot_oper_rev'];
                                        Chosenindexes2['tot_oper_rev'] = "#000000";
                                        requestChart2();
                                        $("div#mychoice2 :checkbox").each(function () {//each()方法遍历所有的复选框
                                            if ($(this).is(':checked') == true) {//这里就可以判断当前是否被选择了
                                                b = $(this).val();
                                                $(this).removeAttr("checked");
                                                $("#b_" + b).css("background-color", "white");
                                            }
                                        });
                                        $("#thefirst2").prop("checked",true);
                                        $("#b_tot_oper_rev").css("background-color", "#000000");
                                    });
                                </script>
                                <!--建图-->
                                <script>
                                    var myChart2 = echarts.init(document.getElementById('mychart2'));
                                    var market_results2;
                                    var thiscode2 = '1010';
                                    var dict = {
                                        'tot_oper_rev': '总营业收入',
                                        'net_profit_is': '净利润总和',
                                        'wgsd_net_inc': '归属股东利润总和',
                                        'tot_assets': '总资产总和',
                                        'tot_liab': '总负债总和',
                                        'net_assets': '净资产总和',
                                        'wgsd_com_eq': '股东权益总和',
                                        'operatecashflow_ttm2': '经营性现金流总和',
                                        'investcashflow_ttm2': '投资性现金流总和',
                                        'financecashflow_ttm2': '融资性现金流总和',
                                        'cashflow_ttm2': '总现金流总和',
                                        'free_cash_flow': '自由现金流估计',
                                        'net_profit_rate': '平均净利润率',
                                        'tot_assets_turnover': '平均总资产周转率',
                                        'equ_multi': '平均权益乘数',
                                        'roe_tot': '平均净资产收益率',
                                        'roe_holder': '平均净资产收益率（股东）'
                                    };
                                    $.ajax({
                                        type: 'GET',
                                        url: '{{ url_for("restfulapi.market_status2") }}',
                                        data: {
                                            code: thiscode2,
                                            starttime: '19911231',
                                            endtime: '20161231',
                                            indexes: ['tot_oper_rev'],
                                        },
                                        dataType: 'json',
                                        success: function (data) {
                                            dataSeries = [];
                                            temp = {
                                                name: data.indexes,
                                                type: 'line',
                                                lineStyle: {normal: {width: 2}},
                                                itemStyle: {normal: {color: '#000000'}},
                                                symbolSize: 8,
                                                smooth: true,
                                                data: numfilter2(eval("data." + data.indexes))
                                            };
                                            dataSeries.push(temp);
                                            option = {
                                                title: {
                                                    text: '财务指标分析图',
                                                    left: '45%'
                                                },
                                                tooltip: {
                                                    trigger: 'item',
                                                    formatter: function (params) {
                                                        return dict[params.seriesName] + "<br/> 时间：" + params.name + "<br/> 数据：" + params.data;
                                                    }
                                                },
                                                legend: {
                                                    data: [],
                                                    orient: 'vertical',
                                                    left: '85%',
                                                    top: '10%',
                                                    formatter: function (name) {
                                                        return dict[name];
                                                    }
                                                },
                                                grid: {
                                                    left: '5%',
                                                    top: '10%',
                                                    containLabel: true
                                                },
                                                toolbox: {
                                                    feature: {
                                                        magicType: {
                                                            type: ['line', 'bar']
                                                        }
                                                    }
                                                },
                                                xAxis: {
                                                    type: 'category',
                                                    boundaryGap: false,
                                                    axisTick: {
                                                        show: false
                                                    },
                                                    data: dateformat(data.the_year),
                                                    Interval: 5
                                                },
                                                yAxis: {
                                                    type: 'value',
                                                    axisTick: {
                                                        show: false
                                                    },
                                                },
                                                dataZoom: [
                                                    {
                                                        type: 'slider',
                                                        xAxisIndex: [0],
                                                        startValue: "2016年Q4",
                                                        endValue: "1991年Q4",
                                                        filterMode: 'filter',
                                                    }
                                                ],
                                                series: dataSeries
                                            };
                                            myChart2.setOption(option, true);
                                            myChart2.on('datazoom', function (params) {
                                                option.xAxis.interval = 10 * (params.end - params.start) / 100;
                                                var ends = (2016 - Math.ceil(params.start / 100 * 25)) + '-12-31'
                                                if (Math.ceil(1 - params.end / 100)) {
                                                    var starts = (1991 + Math.ceil((1 - params.end / 100) * 25) - 1) + '-12-31'
                                                }
                                                else {
                                                    var starts = '1991-12-31'
                                                }
                                                set_timepicker2(starts, ends)
                                            });
                                            function set_timepicker2(start, end) {
                                                document.getElementById('endtime2').value = start
                                                document.getElementById('starttime2').value = end
                                            }
                                        }
                                    });
                                    function requestChart2() {
                                        $.ajax({
                                            type: 'GET',
                                            url: '{{ url_for("restfulapi.market_status2") }}',
                                            data: {
                                                code: thiscode2,
                                                starttime: '19911231',
                                                endtime: '20161231',
                                                indexes: ['tot_oper_rev'],
                                            },
                                            dataType: 'json',
                                            success: function (data) {
                                                dataSeries = [];
                                                temp = {
                                                    name: data.indexes,
                                                    type: 'line',
                                                    lineStyle: {normal: {width: 2}},
                                                    itemStyle: {normal: {color: '#000000'}},
                                                    symbolSize: 8,
                                                    smooth: true,
                                                    data: numfilter2(eval("data." + data.indexes))
                                                };
                                                dataSeries.push(temp);
                                                option = {
                                                    title: {
                                                        text: '财务指标分析图',
                                                        left: '45%'
                                                    },
                                                    tooltip: {
                                                        trigger: 'item',
                                                        formatter: function (params) {
                                                            return dict[params.seriesName] + "<br/> 时间：" + params.name + "<br/> 数据：" + params.data;
                                                        }
                                                    },
                                                    legend: {
                                                        data: [],
                                                        orient: 'vertical',
                                                        left: '85%',
                                                        top: '10%',
                                                        formatter: function (name) {
                                                            return dict[name];
                                                        }
                                                    },
                                                    grid: {
                                                        left: '5%',
                                                        top: '10%',
                                                        containLabel: true
                                                    },
                                                    toolbox: {
                                                        feature: {
                                                            magicType: {
                                                                type: ['line', 'bar']
                                                            }
                                                        }
                                                    },
                                                    xAxis: {
                                                        type: 'category',
                                                        boundaryGap: false,
                                                        axisTick: {
                                                            show: false
                                                        },
                                                        data: dateformat(data.the_year),
                                                        Interval: 5
                                                    },
                                                    yAxis: {
                                                        type: 'value',
                                                        axisTick: {
                                                            show: false
                                                        },
                                                    },
                                                    dataZoom: [
                                                        {
                                                            type: 'slider',
                                                            xAxisIndex: [0],
                                                            startValue: "2016年Q4",
                                                            endValue: "1991年Q4",
                                                            filterMode: 'filter',
                                                        }
                                                    ],
                                                    series: dataSeries
                                                };
                                                myChart2.setOption(option, true);
                                                myChart2.on('datazoom', function (params) {
                                                    option.xAxis.interval = 10 * (params.end - params.start) / 100;
                                                    var ends = (2016 - Math.ceil(params.start / 100 * 25)) + '-12-31'
                                                    if (Math.ceil(1 - params.end / 100)) {
                                                        var starts = (1991 + Math.ceil((1 - params.end / 100) * 25) - 1) + '-12-31'
                                                    }
                                                    else {
                                                        var starts = '1991-12-31'
                                                    }
                                                    set_timepicker2(starts, ends)
                                                });
                                                function set_timepicker2(start, end) {
                                                    document.getElementById('endtime2').value = start
                                                    document.getElementById('starttime2').value = end
                                                }
                                            }
                                        });
                                    }
                                    function RequestChart2() {
                                        $.ajax({
                                            type: 'GET',
                                            url: '{{ url_for("restfulapi.market_status2") }}',
                                            data: {
                                                code: thiscode2,
                                                starttime: '19911231',
                                                endtime: '20161231',
                                                indexes: Chosenindexes2,
                                            },
                                            dataType: 'json',
                                            success: function (data) {
                                                market_results2 = data;
                                                CreateChart2();
                                            }
                                        });
                                    }
                                    function CreateChart2() {
                                        dataSeries = [];
                                        for (var i = 0; i < market_results2.indexes.length; i++) {
                                            temp = {
                                                name: market_results2.indexes[i],
                                                type: 'line',
                                                lineStyle: {normal: {width: 2}},
                                                itemStyle: {normal: {color: Chosenindexes2[market_results2.indexes[i]]}},
                                                symbolSize: 8,
                                                smooth: true,
                                                data: numfilter2(eval("market_results2." + market_results2.indexes[i]))
                                            };
                                            dataSeries.push(temp);
                                        }
                                        option = {
                                            title: {
                                                text: '财务指标分析图',
                                                left: '45%'
                                            },
                                            tooltip: {
                                                trigger: 'item',
                                                formatter: function (params) {
                                                    return dict[params.seriesName] + "<br/> 时间：" + params.name + "<br/> 数据：" + params.data;
                                                }
                                            },
                                            legend: {
                                                data: [],
                                                orient: 'vertical',
                                                left: '85%',
                                                top: '10%',
                                                formatter: function (name) {
                                                    return dict[name];
                                                }
                                            },
                                            grid: {
                                                left: '5%',
                                                top: '10%',
                                                containLabel: true
                                            },
                                            toolbox: {
                                                feature: {
                                                    magicType: {
                                                        type: ['line', 'bar']
                                                    }
                                                }
                                            },
                                            xAxis: {
                                                type: 'category',
                                                boundaryGap: false,
                                                axisTick: {
                                                    show: false
                                                },
                                                data: dateformat(market_results2.the_year),
                                                Interval: 5
                                            },
                                            yAxis: {
                                                type: 'value',
                                                axisTick: {
                                                    show: false
                                                },
                                            },
                                            dataZoom: [
                                                {
                                                    type: 'slider',
                                                    xAxisIndex: [0],
                                                    startValue: "2016年Q4",
                                                    endValue: "1991年Q4",
                                                    filterMode: 'filter',
                                                }
                                            ],
                                            series: dataSeries
                                        };
                                        myChart2.setOption(option, true);
                                        myChart2.on('datazoom', function (params) {
                                            option.xAxis.interval = 10 * (params.end - params.start) / 100;
                                            var ends = (2016 - Math.ceil(params.start / 100 * 25)) + '-12-31'
                                            if (Math.ceil(1 - params.end / 100)) {
                                                var starts = (1991 + Math.ceil((1 - params.end / 100) * 25) - 1) + '-12-31'
                                            }
                                            else {
                                                var starts = '1991-12-31'
                                            }
                                            set_timepicker2(starts, ends)
                                        });
                                        function set_timepicker2(start, end) {
                                            document.getElementById('endtime2').value = start
                                            document.getElementById('starttime2').value = end
                                        }
                                    }
                                    function set_time2() {
                                        document.getElementById('endtime2').value = "1991-12-31"
                                        document.getElementById('starttime2').value = "2016-12-31"
                                    }
                                </script>
                                <!--建表-->
                                <script>
                                    var market_results_t2;
                                    var invest_results_t2;
                                    function RequestTable2() {
                                        var opt = myChart2.getOption();
                                        var dz = opt.dataZoom[0];
                                        $.ajax({
                                            type: 'GET',
                                            url: '{{url_for("restfulapi.market_status2")}}',
                                            data: {
                                                code: thiscode2,
                                                starttime: opt.xAxis[0].data[dz.endValue],
                                                endtime: opt.xAxis[0].data[dz.startValue],
                                                indexes: Chosenindexes2
                                            },
                                            dataType: 'json',//希望服务器返回json格式的数据
                                            success: function (data) {
                                                console.log(data);
                                                market_results_t2 = data;
                                                invest_results_t2 = data;
                                                CreateTable2();
                                            }
                                        })
                                    }
                                    function CreateTable2() {
                                        $("#mytable2").empty();
                                        var table = $("<table id=\"temptable2\" style=\"text-align:center\" class=\"row-border hover order-column\" cellspacing=\"0\" width=\"100%\"  >");
                                        table.appendTo($("#mytable2"));
                                        th = $("<thead></thead>");
                                        th.appendTo(table);
                                        var tr = $("<tr></tr>");
                                        tr.appendTo(th);
                                        var td = $("<td id=\"subject\">" + "项目" + "</td>");
                                        td.appendTo(tr);
                                        theyear = dateformat(market_results_t2.the_year);
                                        for (var j = 0; j < theyear.length; j++) {
                                            var td = $("<td>" + theyear[j] + "</td>");
                                            td.appendTo(tr);
                                        }
                                        tb = $("<tbody></tbody>");
                                        tb.appendTo(table);
                                        $("#mytable2").append("</table>");
                                        var mydatatb = $('#temptable2').DataTable({
                                            "info": false,
                                            "processing": true,
                                            "scrollX": true,
                                            "searching": true,
                                            "fixedColumns": { //固定列的配置项
                                                "leftColumns": 1//固定左边第一列
                                            },
                                            "language": {
                                                "emptyTable": "没有数据",
                                                "loadingRecords": "加载中…",
                                                "processing": "查询中…",
                                                "search": "检索:",
                                                "lengthMenu": "每页 _MENU_ 条",
                                                "zeroRecords": "没有数据",
                                                "paginate": {
                                                    "first": "第一页",
                                                    "last": "最后一页",
                                                    "next": "",
                                                    "previous": ""
                                                },
                                                "info": "第 _PAGE_ 页 / 总 _PAGES_ 页",
                                                "infoEmpty": "没有数据",
                                                "infoFiltered": "(过滤总件数 _MAX_ 条)"
                                            }
                                        });
                                        setTimeout("$(\"#subject\").trigger(\"click\")", 100);
                                        for (var i = 0; i < market_results_t2.indexes.length; i++) {
                                            var rowNode = mydatatb
                                                .row.add([dict[market_results_t2.indexes[i]]].concat(numfilter2(eval("market_results_t2." + market_results_t2.indexes[i]))))
                                                .draw()
                                                .node();
                                            $(rowNode)
                                                .attr('id', market_results_t2.indexes[i]);
                                        }
                                        for (var key in Chosenindexes2) {
                                            $('tr#' + key).css('color', Chosenindexes2[key])
                                        }
                                    }
                                </script>
                                <!--复选框操作-->
                                <script>
                                    var Chosenindexes2 = new Array();
                                    Chosenindexes2 = ['tot_oper_rev'];
                                    Chosenindexes2['tot_oper_rev'] = "#000000";
                                    $("div#mychoice2 :checkbox").change(function () {
                                        indexname2 = $(this).val();
                                        if ($(this).is(':checked') == true) {
                                            colorname2 = NewColor();
                                            console.log(this);
                                            Chosenindexes2.push(indexname2);
                                            Chosenindexes2[indexname2] = colorname2;
                                            $("#b_" + indexname2).css("background-color", colorname2);
                                            console.log(Chosenindexes2);
                                        }
                                        else {
                                            Chosenindexes2.remove(indexname2);
                                            console.log(Chosenindexes2);
                                            $("#b_" + indexname2).css("background-color", "white");
                                        }
                                        RequestChart2();
                                        RequestTable2();
                                        set_time2();
                                    });
                                </script>
                                <!--时间控制框-->
                                <script>
                                    var starttime2 = "19911231";
                                    var endtime2 = "20161231";
                                    $(".form_datetime").datetimepicker({
                                        format: 'yyyy-mm-dd ',
                                        startView: 4,
                                        minView: 4,
                                        maxView: 4,
                                        autoclose: true,
                                        pickerPosition: 'top-right'
                                    });
                                    $('#starttime2').datetimepicker('setStartDate', '1991-12-31');
                                    $('#starttime2').datetimepicker('setEndDate', '2016-12-31');
                                    $('#endtime2').datetimepicker('setStartDate', '1991-12-31');
                                    $('#endtime2').datetimepicker('setEndDate', '2016-12-31');
                                    $('#starttime2')
                                        .datetimepicker()
                                        .on('changeDate', function (ev) {
                                            starts = ev.date.Format("yyyy年Q4");
                                            option.dataZoom[0].startValue = starts;
                                            myChart2.setOption(option);
                                            RequestTable2();
                                        });
                                    $('#endtime2')
                                        .datetimepicker()
                                        .on('changeDate', function (ev) {
                                            ends = ev.date.Format("yyyy年Q4");
                                            option.dataZoom[0].endValue = ends;
                                            myChart2.setOption(option);
                                            RequestTable2();
                                        });
                                    Date.prototype.Format = function (fmt) { //author: meizz
                                        var o = {
                                            "M+": this.getMonth() + 1, //月份
                                            "d+": this.getDate(), //日
                                            "h+": this.getHours(), //小时
                                            "m+": this.getMinutes(), //分
                                            "s+": this.getSeconds(), //秒
                                            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
                                            "S": this.getMilliseconds() //毫秒
                                        };
                                        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
                                        for (var k in o)
                                            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
                                        return fmt;
                                    }
                                    function dateformat(olddate) {
                                        newdate = []
                                        for (i = 0; i < olddate.length; i++) {
                                            var str = olddate[i];
                                            var reg = /1231/g;
                                            str = str.replace(reg, '年Q4');
                                            newdate.push(str)
                                        }
                                        return newdate
                                    }
                                </script>
                                <!--单位转换-->
                                <script>
                                    denominator2 = 1
                                    $("select#unit2").change(function () {
                                        flag = $(this).val();
                                        if (flag == "0") {
                                            denominator2 = 1;
                                            RequestChart2();
                                            CreateTable2();
                                            set_time2();
                                        }
                                        if (flag == "1") {
                                            denominator2 = 1000;
                                            RequestChart2();
                                            CreateTable2();
                                            set_time2();
                                        }
                                    });
                                    function numfilter2(oldnum) {
                                        newnum = []
                                        for (i = 0; i < oldnum.length; i++) {
                                            temp = oldnum[i] / denominator2;
                                            newnum.push(temp.toFixed(2))
                                        }
                                        return newnum;
                                    }
                                </script>
                                <!--面板切换-->
                                <script>
                                    $("#mydropdown").on("click", "[data-stopPropagation]", function (e) {
                                        e.stopPropagation();
                                    })
                                </script>
                                <!--随机生成颜色-->
                                <script>
                                    function NewColor() {
                                        var colorElements = "0,1,2,3,4,5,6,7,8,9,a,b,c,d,e,f";
                                        var colorArray = colorElements.split(",");
                                        var color = "#";
                                        for (var i = 0; i < 6; i++) {
                                            color += colorArray[Math.floor(Math.random() * 16)];
                                        }
                                        return color;
                                    }
                                </script>
                                <!--删除函数-->
                                <script>
                                    Array.prototype.indexOf = function (val) {
                                        for (var i = 0; i < this.length; i++) {
                                            if (this[i] == val) return i;
                                        }
                                        return -1;
                                    };
                                    Array.prototype.remove = function (val) {
                                        var index = this.indexOf(val);
                                        if (index > -1) {
                                            this.splice(index, 1);
                                        }
                                    };
                                </script>
                            </div>
                        </div>
                    </div>
                </div>

                <!--行业-->
                <div class="btn-box-row row-fluid">
                    <div class="module span12">
                        <div class="module-head">
                            <a href="#postgroup3" aria - expanded="false" data - toggle="collapse"> 行业 </a>
                        </div>
                        <div class="modal-body">
                            <div id="postgroup3" style="margin: auto;width:95%;height:auto">
                                <div class="form-search" id="form3">
                                    <div style="height:50px" class="input-group">
                                        <input id="stockcode3" list="itemlist3" name="stockcode" type="text"
                                               style="margin-top:0;margin-left:10px;height: 30px">
                                        <ul class="dropdown-menu dropdown-menu-right" role="menu"></ul>
                                        <datalist id="itemlist3">
                                            <option value="101010">能源设备与服务</option>
                                            <option value="101020">石油、天然气与供消费用燃料</option>
                                            <option value="151010">化工</option>
                                            <option value="151020">建材Ⅲ</option>
                                            <option value="151030">容器与包装</option>
                                            <option value="151040">金属、非金属与采矿</option>
                                            <option value="151050">纸与林木产品</option>
                                            <option value="201010">航空航天与国防Ⅲ</option>
                                            <option value="201020">建筑产品Ⅲ</option>
                                            <option value="201030">建筑与工程Ⅲ</option>
                                            <option value="201040">电气设备</option>
                                            <option value="201050">综合类Ⅲ</option>
                                            <option value="201060">机械</option>
                                            <option value="201070">贸易公司与工业品经销商Ⅲ</option>
                                            <option value="202010">商业服务与用品</option>
                                            <option value="202020">专业服务</option>
                                            <option value="203010">航空货运与物流Ⅲ</option>
                                            <option value="203020">航空Ⅲ</option>
                                            <option value="203030">海运Ⅲ</option>
                                            <option value="203040">公路与铁路运输</option>
                                            <option value="203050">交通基础设施</option>
                                            <option value="251010">汽车零配件</option>
                                            <option value="251020">汽车</option>
                                            <option value="252010">家庭耐用消费品</option>
                                            <option value="252020">休闲设备与用品</option>
                                            <option value="252030">纺织品、服装与奢侈品</option>
                                            <option value="253010">酒店、餐馆与休闲Ⅲ</option>
                                            <option value="253020">综合消费者服务Ⅲ</option>
                                            <option value="254010">媒体Ⅲ</option>
                                            <option value="255010">消费品经销商Ⅲ</option>
                                            <option value="255020">互联网与售货目录零售</option>
                                            <option value="255030">多元化零售</option>
                                            <option value="255040">专营零售</option>
                                            <option value="301010">食品与主要用品零售Ⅲ</option>
                                            <option value="302010">饮料</option>
                                            <option value="302020">食品</option>
                                            <option value="303010">家庭用品Ⅲ</option>
                                            <option value="303020">个人用品Ⅲ</option>
                                            <option value="351010">医疗保健设备与用品</option>
                                            <option value="351020">医疗保健提供商与服务</option>
                                            <option value="351030">医疗保健技术Ⅲ</option>
                                            <option value="352010">生物科技Ⅲ</option>
                                            <option value="352020">制药</option>
                                            <option value="352030">生命科学工具和服务Ⅲ</option>
                                            <option value="401010">商业银行</option>
                                            <option value="402010">多元金融服务</option>
                                            <option value="402030">资本市场</option>
                                            <option value="403010">保险Ⅲ</option>
                                            <option value="451010">互联网软件与服务Ⅲ</option>
                                            <option value="451020">信息技术服务</option>
                                            <option value="451030">软件</option>
                                            <option value="452010">通信设备Ⅲ</option>
                                            <option value="452020">电脑与外围设备</option>
                                            <option value="452030">电子设备、仪器和元件</option>
                                            <option value="453010">半导体产品与半导体设备</option>
                                            <option value="501010">多元电信服务</option>
                                            <option value="501020">无线电信业务Ⅲ</option>
                                            <option value="551010">电力Ⅲ</option>
                                            <option value="551020">燃气Ⅲ</option>
                                            <option value="551030">复合型公用事业Ⅲ</option>
                                            <option value="551040">水务Ⅲ</option>
                                            <option value="551050">独立电力生产商与能源贸易商Ⅲ</option>
                                            <option value="601020">房地产管理和开发</option>
                                        </datalist>
                                        <button id="submit3" type="submit" class="btn btn-default"
                                                style="margin-top:0;margin-left:20px;width:150px;height: 30px"
                                                data-toggle="tooltip"
                                                data-placement="right">搜索
                                        </button>
                                    </div>
                                </div>
                                <ul id="myTab3" class="nav nav-tabs">
                                    <li class="disabled">
                                        <a href="javascript:return false;" data-toggle="tab" disabled='true'>视图：</a>
                                    </li>
                                    <li class="active"><a href="#chart3" data-toggle="tab">图表</a>
                                    </li>
                                    <li><a href="#table3" data-toggle="tab" onclick="RequestTable3()">数据</a></li>
                                </ul>
                                <div id="mychoice3" style="width:18%;height:300px;float:left;overflow-y :auto">
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:black"
                                             id="c_tot_oper_rev"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="tot_oper_rev"
                                                          checked="checked" id="thefirst3">总营业收入</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="c_net_profit_is"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="net_profit_is">净利润总和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="c_wgsd_net_inc"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="wgsd_net_inc">股东利润和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="c_tot_assets"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="tot_assets">总资产总和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="c_tot_liab"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="tot_liab">总负债总和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="c_net_assets"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="net_assets">净资产总和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="c_wgsd_com_eq"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="wgsd_com_eq">股东权益和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="c_operatecashflow_ttm2"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="operatecashflow_ttm2">经营性现金</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="c_investcashflow_ttm2"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="investcashflow_ttm2">投资性现金</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="c_financecashflow_ttm2"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="financecashflow_ttm2">融资性现金</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="c_cashflow_ttm2"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="cashflow_ttm2">总现金流</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="c_free_cash_flow"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="free_cash_flow">自由现金流</label>
                                        </div>
                                    </div>
                                </div>
                                <div id="choice3" class="tab-content">
                                    <div class="tab-pane fade in active" id="chart3">
                                        <div id="mychart3" style="width:100%;height:250px;float:right"></div>
                                    </div>
                                    <div class="tab-pane fade" id="table3">
                                        <div id="mytable3" style="width:100%;height:250px;float:right"></div>
                                    </div>
                                </div>
                                <div style="float:right;width:80%;height:40px;margin-top:10px;border-radius:8px;background-color:#dcdcdc">
                                    <div style="float: left;margin-left:0;margin-top:10px">
                                        <a style="width:20px;margin-left:5px;color: #0c0c0c;">起始时间:</a><input size="10"
                                                                                                              type="text"
                                                                                                              value="1991-12-31"
                                                                                                              id="endtime3"
                                                                                                              readonly
                                                                                                              class="form_datetime">
                                        <a style="width:20px;margin-left:5px;color: #0c0c0c">结束时间:</a><input size="10"
                                                                                                             type="text"
                                                                                                             value="2016-12-31"
                                                                                                             id="starttime3"
                                                                                                             readonly
                                                                                                             class="form_datetime">
                                        <a style="width:20px;margin-left:5px;color: #0c0c0c">单位:</a>
                                        <select style="width:50px;height:26px;font-size: 10px;" id="unit3">
                                            <option value="0" style="font-size: 10px;">亿</option>
                                            <option value="1" style="font-size: 10px;">千亿</option>
                                        </select>
                                    </div>
                                </div>

                                <script>
                                    $("#submit3").click(function () {
                                        thiscode3 = $("#stockcode3").val();
                                        Chosenindexes3 = ['tot_oper_rev'];
                                        Chosenindexes3['tot_oper_rev'] = "#000000";
                                        requestChart3();
                                        $("div#mychoice3 :checkbox").each(function () {//each()方法遍历所有的复选框
                                            if ($(this).is(':checked') == true) {//这里就可以判断当前是否被选择了
                                                c = $(this).val();
                                                $(this).removeAttr("checked");
                                                $("#c_" + c).css("background-color", "white");
                                            }
                                        });
                                        $("#thefirst3").prop("checked",true);
                                        $("#c_tot_oper_rev").css("background-color", "#000000");
                                    });
                                </script>
                                <!--建图-->
                                <script>
                                    var myChart3 = echarts.init(document.getElementById('mychart3'));
                                    var market_results3;
                                    var thiscode3 = '101010';
                                    var dict = {
                                        'tot_oper_rev': '总营业收入',
                                        'net_profit_is': '净利润总和',
                                        'wgsd_net_inc': '归属股东利润总和',
                                        'tot_assets': '总资产总和',
                                        'tot_liab': '总负债总和',
                                        'net_assets': '净资产总和',
                                        'wgsd_com_eq': '股东权益总和',
                                        'operatecashflow_ttm2': '经营性现金流总和',
                                        'investcashflow_ttm2': '投资性现金流总和',
                                        'financecashflow_ttm2': '融资性现金流总和',
                                        'cashflow_ttm2': '总现金流总和',
                                        'free_cash_flow': '自由现金流估计',
                                        'net_profit_rate': '平均净利润率',
                                        'tot_assets_turnover': '平均总资产周转率',
                                        'equ_multi': '平均权益乘数',
                                        'roe_tot': '平均净资产收益率',
                                        'roe_holder': '平均净资产收益率（股东）'
                                    };
                                    $.ajax({
                                        type: 'GET',
                                        url: '{{ url_for("restfulapi.market_status3") }}',
                                        data: {
                                            code: thiscode3,
                                            starttime: '19911231',
                                            endtime: '20161231',
                                            indexes: ['tot_oper_rev'],
                                        },
                                        dataType: 'json',
                                        success: function (data) {
                                            dataSeries = [];
                                            temp = {
                                                name: data.indexes,
                                                type: 'line',
                                                lineStyle: {normal: {width: 2}},
                                                itemStyle: {normal: {color: '#000000'}},
                                                symbolSize: 8,
                                                smooth: true,
                                                data: numfilter3(eval("data." + data.indexes))
                                            };
                                            dataSeries.push(temp);
                                            option = {
                                                title: {
                                                    text: '财务指标分析图',
                                                    left: '45%'
                                                },
                                                tooltip: {
                                                    trigger: 'item',
                                                    formatter: function (params) {
                                                        return dict[params.seriesName] + "<br/> 时间：" + params.name + "<br/> 数据：" + params.data;
                                                    }
                                                },
                                                legend: {
                                                    data: [],
                                                    orient: 'vertical',
                                                    left: '85%',
                                                    top: '10%',
                                                    formatter: function (name) {
                                                        return dict[name];
                                                    }
                                                },
                                                grid: {
                                                    left: '5%',
                                                    top: '10%',
                                                    containLabel: true
                                                },
                                                toolbox: {
                                                    feature: {
                                                        magicType: {
                                                            type: ['line', 'bar']
                                                        }
                                                    }
                                                },
                                                xAxis: {
                                                    type: 'category',
                                                    boundaryGap: false,
                                                    axisTick: {
                                                        show: false
                                                    },
                                                    data: dateformat(data.the_year),
                                                    Interval: 5
                                                },
                                                yAxis: {
                                                    type: 'value',
                                                    axisTick: {
                                                        show: false
                                                    },
                                                },
                                                dataZoom: [
                                                    {
                                                        type: 'slider',
                                                        xAxisIndex: [0],
                                                        startValue: "2016年Q4",
                                                        endValue: "1991年Q4",
                                                        filterMode: 'filter',
                                                    }
                                                ],
                                                series: dataSeries
                                            };
                                            myChart3.setOption(option, true);
                                            myChart3.on('datazoom', function (params) {
                                                option.xAxis.interval = 10 * (params.end - params.start) / 100;
                                                var ends = (2016 - Math.ceil(params.start / 100 * 25)) + '-12-31'
                                                if (Math.ceil(1 - params.end / 100)) {
                                                    var starts = (1991 + Math.ceil((1 - params.end / 100) * 25) - 1) + '-12-31'
                                                }
                                                else {
                                                    var starts = '1991-12-31'
                                                }
                                                set_timepicker3(starts, ends)
                                            });
                                            function set_timepicker3(start, end) {
                                                document.getElementById('endtime3').value = start
                                                document.getElementById('starttime3').value = end
                                            }
                                        }
                                    });
                                    function requestChart3() {
                                        $.ajax({
                                            type: 'GET',
                                            url: '{{ url_for("restfulapi.market_status3") }}',
                                            data: {
                                                code: thiscode3,
                                                starttime: '19911231',
                                                endtime: '20161231',
                                                indexes: ['tot_oper_rev'],
                                            },
                                            dataType: 'json',
                                            success: function (data) {
                                                dataSeries = [];
                                                temp = {
                                                    name: data.indexes,
                                                    type: 'line',
                                                    lineStyle: {normal: {width: 2}},
                                                    itemStyle: {normal: {color: '#000000'}},
                                                    symbolSize: 8,
                                                    smooth: true,
                                                    data: numfilter3(eval("data." + data.indexes))
                                                };
                                                dataSeries.push(temp);
                                                option = {
                                                    title: {
                                                        text: '财务指标分析图',
                                                        left: '45%'
                                                    },
                                                    tooltip: {
                                                        trigger: 'item',
                                                        formatter: function (params) {
                                                            return dict[params.seriesName] + "<br/> 时间：" + params.name + "<br/> 数据：" + params.data;
                                                        }
                                                    },
                                                    legend: {
                                                        data: [],
                                                        orient: 'vertical',
                                                        left: '85%',
                                                        top: '10%',
                                                        formatter: function (name) {
                                                            return dict[name];
                                                        }
                                                    },
                                                    grid: {
                                                        left: '5%',
                                                        top: '10%',
                                                        containLabel: true
                                                    },
                                                    toolbox: {
                                                        feature: {
                                                            magicType: {
                                                                type: ['line', 'bar']
                                                            }
                                                        }
                                                    },
                                                    xAxis: {
                                                        type: 'category',
                                                        boundaryGap: false,
                                                        axisTick: {
                                                            show: false
                                                        },
                                                        data: dateformat(data.the_year),
                                                        Interval: 5
                                                    },
                                                    yAxis: {
                                                        type: 'value',
                                                        axisTick: {
                                                            show: false
                                                        },
                                                    },
                                                    dataZoom: [
                                                        {
                                                            type: 'slider',
                                                            xAxisIndex: [0],
                                                            startValue: "2016年Q4",
                                                            endValue: "1991年Q4",
                                                            filterMode: 'filter',
                                                        }
                                                    ],
                                                    series: dataSeries
                                                };
                                                myChart3.setOption(option, true);
                                                myChart3.on('datazoom', function (params) {
                                                    option.xAxis.interval = 10 * (params.end - params.start) / 100;
                                                    var ends = (2016 - Math.ceil(params.start / 100 * 25)) + '-12-31'
                                                    if (Math.ceil(1 - params.end / 100)) {
                                                        var starts = (1991 + Math.ceil((1 - params.end / 100) * 25) - 1) + '-12-31'
                                                    }
                                                    else {
                                                        var starts = '1991-12-31'
                                                    }
                                                    set_timepicker3(starts, ends)
                                                });
                                                function set_timepicker3(start, end) {
                                                    document.getElementById('endtime3').value = start
                                                    document.getElementById('starttime3').value = end
                                                }
                                            }
                                        });
                                    }
                                    function RequestChart3() {
                                        $.ajax({
                                            type: 'GET',
                                            url: '{{ url_for("restfulapi.market_status3") }}',
                                            data: {
                                                code: thiscode3,
                                                starttime: '19911231',
                                                endtime: '20161231',
                                                indexes: Chosenindexes3,
                                            },
                                            dataType: 'json',
                                            success: function (data) {
                                                market_results3 = data;
                                                CreateChart3();
                                            }
                                        });
                                    }
                                    function CreateChart3() {
                                        dataSeries = [];
                                        for (var i = 0; i < market_results3.indexes.length; i++) {
                                            temp = {
                                                name: market_results3.indexes[i],
                                                type: 'line',
                                                lineStyle: {normal: {width: 2}},
                                                itemStyle: {normal: {color: Chosenindexes3[market_results3.indexes[i]]}},
                                                symbolSize: 8,
                                                smooth: true,
                                                data: numfilter3(eval("market_results3." + market_results3.indexes[i]))
                                            };
                                            dataSeries.push(temp);
                                        }
                                        option = {
                                            title: {
                                                text: '财务指标分析图',
                                                left: '45%'
                                            },
                                            tooltip: {
                                                trigger: 'item',
                                                formatter: function (params) {
                                                    return dict[params.seriesName] + "<br/> 时间：" + params.name + "<br/> 数据：" + params.data;
                                                }
                                            },
                                            legend: {
                                                data: [],
                                                orient: 'vertical',
                                                left: '85%',
                                                top: '10%',
                                                formatter: function (name) {
                                                    return dict[name];
                                                }
                                            },
                                            grid: {
                                                left: '5%',
                                                top: '10%',
                                                containLabel: true
                                            },
                                            toolbox: {
                                                feature: {
                                                    magicType: {
                                                        type: ['line', 'bar']
                                                    }
                                                }
                                            },
                                            xAxis: {
                                                type: 'category',
                                                boundaryGap: false,
                                                axisTick: {
                                                    show: false
                                                },
                                                data: dateformat(market_results3.the_year),
                                                Interval: 5
                                            },
                                            yAxis: {
                                                type: 'value',
                                                axisTick: {
                                                    show: false
                                                },
                                            },
                                            dataZoom: [
                                                {
                                                    type: 'slider',
                                                    xAxisIndex: [0],
                                                    startValue: "2016年Q4",
                                                    endValue: "1991年Q4",
                                                    filterMode: 'filter',
                                                }
                                            ],
                                            series: dataSeries
                                        };
                                        myChart3.setOption(option, true);
                                        myChart3.on('datazoom', function (params) {
                                            option.xAxis.interval = 10 * (params.end - params.start) / 100;
                                            var ends = (2016 - Math.ceil(params.start / 100 * 25)) + '-12-31'
                                            if (Math.ceil(1 - params.end / 100)) {
                                                var starts = (1991 + Math.ceil((1 - params.end / 100) * 25) - 1) + '-12-31'
                                            }
                                            else {
                                                var starts = '1991-12-31'
                                            }
                                            set_timepicker3(starts, ends)
                                        });
                                        function set_timepicker3(start, end) {
                                            document.getElementById('endtime3').value = start
                                            document.getElementById('starttime3').value = end
                                        }
                                    }
                                    function set_time3() {
                                        document.getElementById('endtime3').value = "1991-12-31"
                                        document.getElementById('starttime3').value = "2016-12-31"
                                    }
                                </script>
                                <!--建表-->
                                <script>
                                    var market_results_t3;
                                    var invest_results_t3;
                                    function RequestTable3() {
                                        var opt = myChart3.getOption();
                                        var dz = opt.dataZoom[0];
                                        $.ajax({
                                            type: 'GET',
                                            url: '{{url_for("restfulapi.market_status3")}}',
                                            data: {
                                                code: thiscode3,
                                                starttime: opt.xAxis[0].data[dz.endValue],
                                                endtime: opt.xAxis[0].data[dz.startValue],
                                                indexes: Chosenindexes3
                                            },
                                            dataType: 'json',//希望服务器返回json格式的数据
                                            success: function (data) {
                                                console.log(data);
                                                market_results_t3 = data;
                                                invest_results_t3 = data;
                                                CreateTable3();
                                            }
                                        })
                                    }
                                    function CreateTable3() {
                                        $("#mytable3").empty();
                                        var table = $("<table id=\"temptable3\" style=\"text-align:center\" class=\"row-border hover order-column\" cellspacing=\"0\" width=\"100%\"  >");
                                        table.appendTo($("#mytable3"));
                                        th = $("<thead></thead>");
                                        th.appendTo(table);
                                        var tr = $("<tr></tr>");
                                        tr.appendTo(th);
                                        var td = $("<td id=\"subject\">" + "项目" + "</td>");
                                        td.appendTo(tr);
                                        theyear = dateformat(market_results_t3.the_year);
                                        for (var j = 0; j < theyear.length; j++) {
                                            var td = $("<td>" + theyear[j] + "</td>");
                                            td.appendTo(tr);
                                        }
                                        tb = $("<tbody></tbody>");
                                        tb.appendTo(table);
                                        $("#mytable3").append("</table>");
                                        var mydatatb = $('#temptable3').DataTable({
                                            "info": false,
                                            "processing": true,
                                            "scrollX": true,
                                            "searching": true,
                                            "fixedColumns": { //固定列的配置项
                                                "leftColumns": 1//固定左边第一列
                                            },
                                            "language": {
                                                "emptyTable": "没有数据",
                                                "loadingRecords": "加载中…",
                                                "processing": "查询中…",
                                                "search": "检索:",
                                                "lengthMenu": "每页 _MENU_ 条",
                                                "zeroRecords": "没有数据",
                                                "paginate": {
                                                    "first": "第一页",
                                                    "last": "最后一页",
                                                    "next": "",
                                                    "previous": ""
                                                },
                                                "info": "第 _PAGE_ 页 / 总 _PAGES_ 页",
                                                "infoEmpty": "没有数据",
                                                "infoFiltered": "(过滤总件数 _MAX_ 条)"
                                            }
                                        });
                                        setTimeout("$(\"#subject\").trigger(\"click\")", 100);
                                        for (var i = 0; i < market_results_t3.indexes.length; i++) {
                                            var rowNode = mydatatb
                                                .row.add([dict[market_results_t3.indexes[i]]].concat(numfilter3(eval("market_results_t3." + market_results_t3.indexes[i]))))
                                                .draw()
                                                .node();
                                            $(rowNode)
                                                .attr('id', market_results_t3.indexes[i]);
                                        }
                                        for (var key in Chosenindexes3) {
                                            $('tr#' + key).css('color', Chosenindexes3[key])
                                        }
                                    }
                                </script>
                                <!--复选框操作-->
                                <script>
                                    var Chosenindexes3 = new Array();
                                    Chosenindexes3 = ['tot_oper_rev'];
                                    Chosenindexes3['tot_oper_rev'] = "#000000";
                                    $("div#mychoice3 :checkbox").change(function () {
                                        indexname3 = $(this).val();
                                        if ($(this).is(':checked') == true) {
                                            colorname3 = NewColor();
                                            console.log(this);
                                            Chosenindexes3.push(indexname3);
                                            Chosenindexes3[indexname3] = colorname3;
                                            $("#c_" + indexname3).css("background-color", colorname3);
                                            console.log(Chosenindexes3);
                                        }
                                        else {
                                            Chosenindexes3.remove(indexname3);
                                            console.log(Chosenindexes3);
                                            $("#c_" + indexname3).css("background-color", "white");
                                        }
                                        RequestChart3();
                                        RequestTable3();
                                        set_time3();
                                    });
                                </script>
                                <!--时间控制框-->
                                <script>
                                    var starttime3 = "19911231";
                                    var endtime3 = "20161231";
                                    $(".form_datetime").datetimepicker({
                                        format: 'yyyy-mm-dd ',
                                        startView: 4,
                                        minView: 4,
                                        maxView: 4,
                                        autoclose: true,
                                        pickerPosition: 'top-right'
                                    });
                                    $('#starttime3').datetimepicker('setStartDate', '1991-12-31');
                                    $('#starttime3').datetimepicker('setEndDate', '2016-12-31');
                                    $('#endtime3').datetimepicker('setStartDate', '1991-12-31');
                                    $('#endtime3').datetimepicker('setEndDate', '2016-12-31');
                                    $('#starttime3')
                                        .datetimepicker()
                                        .on('changeDate', function (ev) {
                                            starts = ev.date.Format("yyyy年Q4");
                                            option.dataZoom[0].startValue = starts;
                                            myChart3.setOption(option);
                                            RequestTable3();
                                        });
                                    $('#endtime3')
                                        .datetimepicker()
                                        .on('changeDate', function (ev) {
                                            ends = ev.date.Format("yyyy年Q4");
                                            option.dataZoom[0].endValue = ends;
                                            myChart3.setOption(option);
                                            RequestTable3();
                                        });
                                    Date.prototype.Format = function (fmt) { //author: meizz
                                        var o = {
                                            "M+": this.getMonth() + 1, //月份
                                            "d+": this.getDate(), //日
                                            "h+": this.getHours(), //小时
                                            "m+": this.getMinutes(), //分
                                            "s+": this.getSeconds(), //秒
                                            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
                                            "S": this.getMilliseconds() //毫秒
                                        };
                                        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
                                        for (var k in o)
                                            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
                                        return fmt;
                                    }
                                    function dateformat(olddate) {
                                        newdate = []
                                        for (i = 0; i < olddate.length; i++) {
                                            var str = olddate[i];
                                            var reg = /1231/g;
                                            str = str.replace(reg, '年Q4');
                                            newdate.push(str)
                                        }
                                        return newdate
                                    }
                                </script>
                                <!--单位转换-->
                                <script>
                                    denominator3 = 1
                                    $("select#unit3").change(function () {
                                        flag = $(this).val();
                                        if (flag == "0") {
                                            denominator3 = 1;
                                            RequestChart3();
                                            CreateTable3();
                                            set_time3();
                                        }
                                        if (flag == "1") {
                                            denominator3 = 1000;
                                            RequestChart3();
                                            CreateTable3();
                                            set_time3();
                                        }
                                    });
                                    function numfilter3(oldnum) {
                                        newnum = []
                                        for (i = 0; i < oldnum.length; i++) {
                                            temp = oldnum[i] / denominator3;
                                            newnum.push(temp.toFixed(2))
                                        }
                                        return newnum;
                                    }
                                </script>
                                <!--面板切换-->
                                <script>
                                    $("#mydropdown").on("click", "[data-stopPropagation]", function (e) {
                                        e.stopPropagation();
                                    })
                                </script>
                                <!--随机生成颜色-->
                                <script>
                                    function NewColor() {
                                        var colorElements = "0,1,2,3,4,5,6,7,8,9,a,b,c,d,e,f";
                                        var colorArray = colorElements.split(",");
                                        var color = "#";
                                        for (var i = 0; i < 6; i++) {
                                            color += colorArray[Math.floor(Math.random() * 16)];
                                        }
                                        return color;
                                    }
                                </script>
                                <!--删除函数-->
                                <script>
                                    Array.prototype.indexOf = function (val) {
                                        for (var i = 0; i < this.length; i++) {
                                            if (this[i] == val) return i;
                                        }
                                        return -1;
                                    };
                                    Array.prototype.remove = function (val) {
                                        var index = this.indexOf(val);
                                        if (index > -1) {
                                            this.splice(index, 1);
                                        }
                                    };
                                </script>
                            </div>
                        </div>
                    </div>
                </div>

                <!--子行业-->
                <div class="btn-box-row row-fluid">
                    <div class="module span12">
                        <div class="module-head">
                            <a href="#postgroup4" aria - expanded="false" data - toggle="collapse"> 子行业 </a>
                        </div>
                        <div class="modal-body">
                            <div id="postgroup4" style="margin: auto;width:95%;height:auto">
                                <div class="form-search" id="form4">
                                    <div style="height:50px" class="input-group">
                                        <input id="stockcode4" list="itemlist4" name="stockcode" type="text"
                                               style="margin-top:0;margin-left:10px;height: 30px">
                                        <ul class="dropdown-menu dropdown-menu-right" role="menu"></ul>
                                        <datalist id="itemlist4">
                                            <option value="10101010">石油天然气钻井</option>
                                            <option value="10101020">石油天然气设备与服务</option>
                                            <option value="10102010">综合性石油天然气</option>
                                            <option value="10102020">石油天然气勘探与生产</option>
                                            <option value="10102030">石油与天然气的炼制和销售</option>
                                            <option value="10102040">石油与天然气的储存和运输</option>
                                            <option value="10102050">煤炭与消费用燃料</option>
                                            <option value="15101010">基础化工</option>
                                            <option value="15101011">化纤</option>
                                            <option value="15101020">多元化工</option>
                                            <option value="15101030">化肥与农用化工</option>
                                            <option value="15101040">工业气体</option>
                                            <option value="15101050">特种化工</option>
                                            <option value="15102010">建材</option>
                                            <option value="15103010">金属与玻璃容器</option>
                                            <option value="15103020">纸包装</option>
                                            <option value="15104010">铝</option>
                                            <option value="15104020">金属非金属</option>
                                            <option value="15104030">黄金</option>
                                            <option value="15104040">贵金属与矿石</option>
                                            <option value="15104045">白银</option>
                                            <option value="15104050">钢铁</option>
                                            <option value="15105010">林木产品</option>
                                            <option value="15105020">纸制品</option>
                                            <option value="20101010">航天航空与国防</option>
                                            <option value="20102010">建筑产品</option>
                                            <option value="20103010">建筑与工程</option>
                                            <option value="20104010">电气部件与设备</option>
                                            <option value="20104020">重型电气设备</option>
                                            <option value="20105010">综合类行业</option>
                                            <option value="20106010">建筑机械与重型卡车</option>
                                            <option value="20106015">农用农业机械</option>
                                            <option value="20106020">工业机械</option>
                                            <option value="20107010">贸易公司与工业品经销商</option>
                                            <option value="20201010">商业印刷</option>
                                            <option value="20201050">环境与设施服务</option>
                                            <option value="20201060">办公服务与用品</option>
                                            <option value="20201070">综合支持服务</option>
                                            <option value="20202020">调查和咨询服务</option>
                                            <option value="20301010">航空货运与物流</option>
                                            <option value="20302010">航空</option>
                                            <option value="20303010">海运</option>
                                            <option value="20304010">铁路运输</option>
                                            <option value="20304020">公路运输</option>
                                            <option value="20305010">机场服务</option>
                                            <option value="20305020">公路与铁路</option>
                                            <option value="20305030">海港与服务</option>
                                            <option value="25101010">汽车零配件</option>
                                            <option value="25101020">轮胎与橡胶</option>
                                            <option value="25102010">汽车制造</option>
                                            <option value="25102020">摩托车制造</option>
                                            <option value="25201010">消费电子产品</option>
                                            <option value="25201020">家庭装饰品</option>
                                            <option value="25201030">住宅建筑</option>
                                            <option value="25201040">家用电器</option>
                                            <option value="25201050">家用器具与特殊消费品</option>
                                            <option value="25202010">休闲用品</option>
                                            <option value="25202020">摄影用品</option>
                                            <option value="25203010">服装、服饰与奢侈品</option>
                                            <option value="25203020">鞋类</option>
                                            <option value="25203030">纺织品</option>
                                            <option value="25301020">酒店、度假村与豪华游轮</option>
                                            <option value="25301030">休闲设施</option>
                                            <option value="25301040">餐馆</option>
                                            <option value="25302010">教育服务</option>
                                            <option value="25401010">广告</option>
                                            <option value="25401020">有线和卫星电视</option>
                                            <option value="25401030">电影与娱乐</option>
                                            <option value="25401040">出版</option>
                                            <option value="25501010">消费品经销商</option>
                                            <option value="25502010">售货目录零售</option>
                                            <option value="25502020">互联网零售</option>
                                            <option value="25503010">百货商店</option>
                                            <option value="25503020">综合货品商店</option>
                                            <option value="25504020">电脑与电子产品零售</option>
                                            <option value="25504040">专卖店</option>
                                            <option value="25504050">汽车零售</option>
                                            <option value="30101010">药品零售</option>
                                            <option value="30101020">食品分销商</option>
                                            <option value="30101030">食品零售</option>
                                            <option value="30101040">大卖场与超市</option>
                                            <option value="30201010">啤酒</option>
                                            <option value="30201020">白酒与葡萄酒</option>
                                            <option value="30201030">软饮料</option>
                                            <option value="30201010">农产品</option>
                                            <option value="30201030">食品加工与肉类</option>
                                            <option value="30301010">家庭用品</option>
                                            <option value="30302010">个人用品</option>
                                            <option value="35101010">医疗保健设备</option>
                                            <option value="35101020">医疗保健用品</option>
                                            <option value="35102015">保健护理服务</option>
                                            <option value="35102020">保健护理设施</option>
                                            <option value="35103010">医疗保健技术</option>
                                            <option value="35201010">生物科技</option>
                                            <option value="35202010">西药</option>
                                            <option value="35202011">中药</option>
                                            <option value="35203010">生命科学工具和服务</option>
                                            <option value="40101010">多元化银行</option>
                                            <option value="40101015">区域性银行</option>
                                            <option value="40201020">其他多元金融服务</option>
                                            <option value="40201030">多领域控股</option>
                                            <option value="40203010">资产管理与托管银行</option>
                                            <option value="40203020">投资银行业与经纪业</option>
                                            <option value="40203030">多元资本市场</option>
                                            <option value="40301020">人寿与健康保险</option>
                                            <option value="40301030">多元化保险</option>
                                            <option value="40301040">财产与意外伤害保险</option>
                                            <option value="45101010">互联网软件与服务</option>
                                            <option value="45102010">信息科技咨询与其它服务</option>
                                            <option value="45102020">数据处理与外包服务</option>
                                            <option value="45103010">应用软件</option>
                                            <option value="45103020">系统软件</option>
                                            <option value="45103030">家庭娱乐软件</option>
                                            <option value="45201020">通信设备</option>
                                            <option value="45202010">电脑硬件</option>
                                            <option value="45202020">电脑存储与外围设备</option>
                                            <option value="45203010">电子元件</option>
                                            <option value="45203015">电子设备和仪器</option>
                                            <option value="45203020">电子制造服务</option>
                                            <option value="45303030">技术产品经销商</option>
                                            <option value="45301010">半导体设备</option>
                                            <option value="45301020">半导体产品</option>
                                            <option value="50101010">非传统电信运营商</option>
                                            <option value="50101020">综合电信服务</option>
                                            <option value="50102010">无线电信业务</option>
                                            <option value="55101010">电力</option>
                                            <option value="55102010">燃气</option>
                                            <option value="55103010">复合型公用事业</option>
                                            <option value="55104010">水务</option>
                                            <option value="55105010">独立电力生产商与能源贸易商</option>
                                            <option value="55105020">新能源发电业者</option>
                                            <option value="60102020">房地产经营公司</option>
                                            <option value="60102030">房地产开发</option>
                                            <option value="60102040">房地产服务</option>
                                        </datalist>
                                        <button id="submit4" type="submit" class="btn btn-default"
                                                style="margin-top:0;margin-left:20px;width:150px;height: 30px"
                                                data-toggle="tooltip"
                                                data-placement="right">搜索
                                        </button>
                                    </div>
                                </div>
                                <ul id="myTab4" class="nav nav-tabs">
                                    <li class="disabled">
                                        <a href="javascript:return false;" data-toggle="tab" disabled='true'>视图：</a>
                                    </li>
                                    <li class="active"><a href="#chart4" data-toggle="tab">图表</a>
                                    </li>
                                    <li><a href="#table4" data-toggle="tab" onclick="RequestTable4()">数据</a></li>
                                </ul>
                                <div id="mychoice4" style="width:18%;height:300px;float:left;overflow-y :auto">
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:black"
                                             id="d_tot_oper_rev"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="tot_oper_rev"
                                                          checked="checked" id="thefirst4">总营业收入</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="d_net_profit_is"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="net_profit_is">净利润总和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="d_wgsd_net_inc"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="wgsd_net_inc">股东利润和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="d_tot_assets"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="tot_assets">总资产总和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="d_tot_liab"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="tot_liab">总负债总和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="d_net_assets"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="net_assets">净资产总和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="d_wgsd_com_eq"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="wgsd_com_eq">股东权益和</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="d_operatecashflow_ttm2"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="operatecashflow_ttm2">经营性现金</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="d_investcashflow_ttm2"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="investcashflow_ttm2">投资性现金</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="d_financecashflow_ttm2"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="financecashflow_ttm2">融资性现金</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="d_cashflow_ttm2"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="cashflow_ttm2">总现金流</label>
                                        </div>
                                    </div>
                                    <div class="thediv"
                                         style="width:100%;height:30px;margin-top:10px;border-radius:20px;">
                                        <div style="width:10px;height:10px;margin-right:5px;float:right;margin-top:15px;background-color:white"
                                             id="d_free_cash_flow"></div>
                                        <div class="checkbox"
                                             style="width:60%;height:20px;float:left;margin-top:10px;margin-left:5px">
                                            <label><input type="checkbox" value="free_cash_flow">自由现金流</label>
                                        </div>
                                    </div>
                                </div>
                                <div id="choice3" class="tab-content">
                                    <div class="tab-pane fade in active" id="chart4">
                                        <div id="mychart4" style="width:100%;height:250px;float:right"></div>
                                    </div>
                                    <div class="tab-pane fade" id="table4">
                                        <div id="mytable4" style="width:100%;height:250px;float:right"></div>
                                    </div>
                                </div>
                                <div style="float:right;width:80%;height:40px;margin-top:10px;border-radius:8px;background-color:#dcdcdc">
                                    <div style="float: left;margin-left:0;margin-top:10px">
                                        <a style="width:20px;margin-left:5px;color: #0c0c0c;">起始时间:</a><input size="10"
                                                                                                              type="text"
                                                                                                              value="1991-12-31"
                                                                                                              id="endtime4"
                                                                                                              readonly
                                                                                                              class="form_datetime">
                                        <a style="width:20px;margin-left:5px;color: #0c0c0c">结束时间:</a><input size="10"
                                                                                                             type="text"
                                                                                                             value="2016-12-31"
                                                                                                             id="starttime4"
                                                                                                             readonly
                                                                                                             class="form_datetime">
                                        <a style="width:20px;margin-left:5px;color: #0c0c0c">单位:</a>
                                        <select style="width:50px;height:26px;font-size: 10px;" id="unit4">
                                            <option value="0" style="font-size: 10px;">亿</option>
                                            <option value="1" style="font-size: 10px;">千亿</option>
                                        </select>
                                    </div>
                                </div>

                                <script>
                                    $("#submit4").click(function () {
                                        thiscode4 = $("#stockcode4").val();
                                        Chosenindexes4 = ['tot_oper_rev'];
                                        Chosenindexes4['tot_oper_rev'] = "#000000";
                                        requestChart4();
                                        $("div#mychoice4 :checkbox").each(function () {//each()方法遍历所有的复选框
                                            if ($(this).is(':checked') == true) {//这里就可以判断当前是否被选择了
                                                d = $(this).val();
                                                $(this).removeAttr("checked");
                                                $("#d_" + d).css("background-color", "white");
                                            }
                                        });
                                        $("#thefirst4").prop("checked",true);
                                        $("#d_tot_oper_rev").css("background-color", "#000000");
                                    });
                                </script>
                                <!--建图-->
                                <script>
                                    var myChart4 = echarts.init(document.getElementById('mychart4'));
                                    var market_results4;
                                    var thiscode4 = '10101010';
                                    var dict = {
                                        'tot_oper_rev': '总营业收入',
                                        'net_profit_is': '净利润总和',
                                        'wgsd_net_inc': '归属股东利润总和',
                                        'tot_assets': '总资产总和',
                                        'tot_liab': '总负债总和',
                                        'net_assets': '净资产总和',
                                        'wgsd_com_eq': '股东权益总和',
                                        'operatecashflow_ttm2': '经营性现金流总和',
                                        'investcashflow_ttm2': '投资性现金流总和',
                                        'financecashflow_ttm2': '融资性现金流总和',
                                        'cashflow_ttm2': '总现金流总和',
                                        'free_cash_flow': '自由现金流估计',
                                        'net_profit_rate': '平均净利润率',
                                        'tot_assets_turnover': '平均总资产周转率',
                                        'equ_multi': '平均权益乘数',
                                        'roe_tot': '平均净资产收益率',
                                        'roe_holder': '平均净资产收益率（股东）'
                                    };
                                    $.ajax({
                                        type: 'GET',
                                        url: '{{ url_for("restfulapi.market_status4") }}',
                                        data: {
                                            code: thiscode4,
                                            starttime: '19911231',
                                            endtime: '20161231',
                                            indexes: ['tot_oper_rev'],
                                        },
                                        dataType: 'json',
                                        success: function (data) {
                                            dataSeries = [];
                                            temp = {
                                                name: data.indexes,
                                                type: 'line',
                                                lineStyle: {normal: {width: 2}},
                                                itemStyle: {normal: {color: '#000000'}},
                                                symbolSize: 8,
                                                smooth: true,
                                                data: numfilter4(eval("data." + data.indexes))
                                            };
                                            dataSeries.push(temp);
                                            option = {
                                                title: {
                                                    text: '财务指标分析图',
                                                    left: '45%'
                                                },
                                                tooltip: {
                                                    trigger: 'item',
                                                    formatter: function (params) {
                                                        return dict[params.seriesName] + "<br/> 时间：" + params.name + "<br/> 数据：" + params.data;
                                                    }
                                                },
                                                legend: {
                                                    data: [],
                                                    orient: 'vertical',
                                                    left: '85%',
                                                    top: '10%',
                                                    formatter: function (name) {
                                                        return dict[name];
                                                    }
                                                },
                                                grid: {
                                                    left: '5%',
                                                    top: '10%',
                                                    containLabel: true
                                                },
                                                toolbox: {
                                                    feature: {
                                                        magicType: {
                                                            type: ['line', 'bar']
                                                        }
                                                    }
                                                },
                                                xAxis: {
                                                    type: 'category',
                                                    boundaryGap: false,
                                                    axisTick: {
                                                        show: false
                                                    },
                                                    data: dateformat(data.the_year),
                                                    Interval: 5
                                                },
                                                yAxis: {
                                                    type: 'value',
                                                    axisTick: {
                                                        show: false
                                                    },
                                                },
                                                dataZoom: [
                                                    {
                                                        type: 'slider',
                                                        xAxisIndex: [0],
                                                        startValue: "2016年Q4",
                                                        endValue: "1991年Q4",
                                                        filterMode: 'filter',
                                                    }
                                                ],
                                                series: dataSeries
                                            };
                                            myChart4.setOption(option, true);
                                            myChart4.on('datazoom', function (params) {
                                                option.xAxis.interval = 10 * (params.end - params.start) / 100;
                                                var ends = (2016 - Math.ceil(params.start / 100 * 25)) + '-12-31'
                                                if (Math.ceil(1 - params.end / 100)) {
                                                    var starts = (1991 + Math.ceil((1 - params.end / 100) * 25) - 1) + '-12-31'
                                                }
                                                else {
                                                    var starts = '1991-12-31'
                                                }
                                                set_timepicker4(starts, ends)
                                            });
                                            function set_timepicker4(start, end) {
                                                document.getElementById('endtime4').value = start
                                                document.getElementById('starttime4').value = end
                                            }
                                        }
                                    });
                                    function requestChart4() {
                                        $.ajax({
                                            type: 'GET',
                                            url: '{{ url_for("restfulapi.market_status4") }}',
                                            data: {
                                                code: thiscode4,
                                                starttime: '19911231',
                                                endtime: '20161231',
                                                indexes: ['tot_oper_rev'],
                                            },
                                            dataType: 'json',
                                            success: function (data) {
                                                dataSeries = [];
                                                temp = {
                                                    name: data.indexes,
                                                    type: 'line',
                                                    lineStyle: {normal: {width: 2}},
                                                    itemStyle: {normal: {color: '#000000'}},
                                                    symbolSize: 8,
                                                    smooth: true,
                                                    data: numfilter4(eval("data." + data.indexes))
                                                };
                                                dataSeries.push(temp);
                                                option = {
                                                    title: {
                                                        text: '财务指标分析图',
                                                        left: '45%'
                                                    },
                                                    tooltip: {
                                                        trigger: 'item',
                                                        formatter: function (params) {
                                                            return dict[params.seriesName] + "<br/> 时间：" + params.name + "<br/> 数据：" + params.data;
                                                        }
                                                    },
                                                    legend: {
                                                        data: [],
                                                        orient: 'vertical',
                                                        left: '85%',
                                                        top: '10%',
                                                        formatter: function (name) {
                                                            return dict[name];
                                                        }
                                                    },
                                                    grid: {
                                                        left: '5%',
                                                        top: '10%',
                                                        containLabel: true
                                                    },
                                                    toolbox: {
                                                        feature: {
                                                            magicType: {
                                                                type: ['line', 'bar']
                                                            }
                                                        }
                                                    },
                                                    xAxis: {
                                                        type: 'category',
                                                        boundaryGap: false,
                                                        axisTick: {
                                                            show: false
                                                        },
                                                        data: dateformat(data.the_year),
                                                        Interval: 5
                                                    },
                                                    yAxis: {
                                                        type: 'value',
                                                        axisTick: {
                                                            show: false
                                                        },
                                                    },
                                                    dataZoom: [
                                                        {
                                                            type: 'slider',
                                                            xAxisIndex: [0],
                                                            startValue: "2016年Q4",
                                                            endValue: "1991年Q4",
                                                            filterMode: 'filter',
                                                        }
                                                    ],
                                                    series: dataSeries
                                                };
                                                myChart4.setOption(option, true);
                                                myChart4.on('datazoom', function (params) {
                                                    option.xAxis.interval = 10 * (params.end - params.start) / 100;
                                                    var ends = (2016 - Math.ceil(params.start / 100 * 25)) + '-12-31'
                                                    if (Math.ceil(1 - params.end / 100)) {
                                                        var starts = (1991 + Math.ceil((1 - params.end / 100) * 25) - 1) + '-12-31'
                                                    }
                                                    else {
                                                        var starts = '1991-12-31'
                                                    }
                                                    set_timepicker4(starts, ends)
                                                });
                                                function set_timepicker4(start, end) {
                                                    document.getElementById('endtime4').value = start
                                                    document.getElementById('starttime4').value = end
                                                }
                                            }
                                        });
                                    }
                                    function RequestChart4() {
                                        $.ajax({
                                            type: 'GET',
                                            url: '{{ url_for("restfulapi.market_status4") }}',
                                            data: {
                                                code: thiscode4,
                                                starttime: '19911231',
                                                endtime: '20161231',
                                                indexes: Chosenindexes4,
                                            },
                                            dataType: 'json',
                                            success: function (data) {
                                                market_results4 = data;
                                                CreateChart4();
                                            }
                                        });
                                    }
                                    function CreateChart4() {
                                        dataSeries = [];
                                        for (var i = 0; i < market_results4.indexes.length; i++) {
                                            temp = {
                                                name: market_results4.indexes[i],
                                                type: 'line',
                                                lineStyle: {normal: {width: 2}},
                                                itemStyle: {normal: {color: Chosenindexes4[market_results4.indexes[i]]}},
                                                symbolSize: 8,
                                                smooth: true,
                                                data: numfilter4(eval("market_results4." + market_results4.indexes[i]))
                                            };
                                            dataSeries.push(temp);
                                        }
                                        option = {
                                            title: {
                                                text: '财务指标分析图',
                                                left: '45%'
                                            },
                                            tooltip: {
                                                trigger: 'item',
                                                formatter: function (params) {
                                                    return dict[params.seriesName] + "<br/> 时间：" + params.name + "<br/> 数据：" + params.data;
                                                }
                                            },
                                            legend: {
                                                data: [],
                                                orient: 'vertical',
                                                left: '85%',
                                                top: '10%',
                                                formatter: function (name) {
                                                    return dict[name];
                                                }
                                            },
                                            grid: {
                                                left: '5%',
                                                top: '10%',
                                                containLabel: true
                                            },
                                            toolbox: {
                                                feature: {
                                                    magicType: {
                                                        type: ['line', 'bar']
                                                    }
                                                }
                                            },
                                            xAxis: {
                                                type: 'category',
                                                boundaryGap: false,
                                                axisTick: {
                                                    show: false
                                                },
                                                data: dateformat(market_results4.the_year),
                                                Interval: 5
                                            },
                                            yAxis: {
                                                type: 'value',
                                                axisTick: {
                                                    show: false
                                                },
                                            },
                                            dataZoom: [
                                                {
                                                    type: 'slider',
                                                    xAxisIndex: [0],
                                                    startValue: "2016年Q4",
                                                    endValue: "1991年Q4",
                                                    filterMode: 'filter',
                                                }
                                            ],
                                            series: dataSeries
                                        };
                                        myChart4.setOption(option, true);
                                        myChart4.on('datazoom', function (params) {
                                            option.xAxis.interval = 10 * (params.end - params.start) / 100;
                                            var ends = (2016 - Math.ceil(params.start / 100 * 25)) + '-12-31'
                                            if (Math.ceil(1 - params.end / 100)) {
                                                var starts = (1991 + Math.ceil((1 - params.end / 100) * 25) - 1) + '-12-31'
                                            }
                                            else {
                                                var starts = '1991-12-31'
                                            }
                                            set_timepicker4(starts, ends)
                                        });
                                        function set_timepicker4(start, end) {
                                            document.getElementById('endtime4').value = start
                                            document.getElementById('starttime4').value = end
                                        }
                                    }
                                    function set_time4() {
                                        document.getElementById('endtime4').value = "1991-12-31"
                                        document.getElementById('starttime4').value = "2016-12-31"
                                    }
                                </script>
                                <!--建表-->
                                <script>
                                    var market_results_t4;
                                    var invest_results_t4;
                                    function RequestTable4() {
                                        var opt = myChart4.getOption();
                                        var dz = opt.dataZoom[0];
                                        $.ajax({
                                            type: 'GET',
                                            url: '{{url_for("restfulapi.market_status4")}}',
                                            data: {
                                                code: thiscode4,
                                                starttime: opt.xAxis[0].data[dz.endValue],
                                                endtime: opt.xAxis[0].data[dz.startValue],
                                                indexes: Chosenindexes4
                                            },
                                            dataType: 'json',//希望服务器返回json格式的数据
                                            success: function (data) {
                                                console.log(data);
                                                market_results_t4 = data;
                                                invest_results_t4 = data;
                                                CreateTable4();
                                            }
                                        })
                                    }
                                    function CreateTable4() {
                                        $("#mytable4").empty();
                                        var table = $("<table id=\"temptable4\" style=\"text-align:center\" class=\"row-border hover order-column\" cellspacing=\"0\" width=\"100%\"  >");
                                        table.appendTo($("#mytable4"));
                                        th = $("<thead></thead>");
                                        th.appendTo(table);
                                        var tr = $("<tr></tr>");
                                        tr.appendTo(th);
                                        var td = $("<td id=\"subject\">" + "项目" + "</td>");
                                        td.appendTo(tr);
                                        theyear = dateformat(market_results_t4.the_year);
                                        for (var j = 0; j < theyear.length; j++) {
                                            var td = $("<td>" + theyear[j] + "</td>");
                                            td.appendTo(tr);
                                        }
                                        tb = $("<tbody></tbody>");
                                        tb.appendTo(table);
                                        $("#mytable4").append("</table>");
                                        var mydatatb = $('#temptable4').DataTable({
                                            "info": false,
                                            "processing": true,
                                            "scrollX": true,
                                            "searching": true,
                                            "fixedColumns": { //固定列的配置项
                                                "leftColumns": 1//固定左边第一列
                                            },
                                            "language": {
                                                "emptyTable": "没有数据",
                                                "loadingRecords": "加载中…",
                                                "processing": "查询中…",
                                                "search": "检索:",
                                                "lengthMenu": "每页 _MENU_ 条",
                                                "zeroRecords": "没有数据",
                                                "paginate": {
                                                    "first": "第一页",
                                                    "last": "最后一页",
                                                    "next": "",
                                                    "previous": ""
                                                },
                                                "info": "第 _PAGE_ 页 / 总 _PAGES_ 页",
                                                "infoEmpty": "没有数据",
                                                "infoFiltered": "(过滤总件数 _MAX_ 条)"
                                            }
                                        });
                                        setTimeout("$(\"#subject\").trigger(\"click\")", 100);
                                        for (var i = 0; i < market_results_t4.indexes.length; i++) {
                                            var rowNode = mydatatb
                                                .row.add([dict[market_results_t4.indexes[i]]].concat(numfilter4(eval("market_results_t4." + market_results_t4.indexes[i]))))
                                                .draw()
                                                .node();
                                            $(rowNode)
                                                .attr('id', market_results_t4.indexes[i]);
                                        }
                                        for (var key in Chosenindexes4) {
                                            $('tr#' + key).css('color', Chosenindexes4[key])
                                        }
                                    }
                                </script>
                                <!--复选框操作-->
                                <script>
                                    var Chosenindexes4 = new Array();
                                    Chosenindexes4 = ['tot_oper_rev'];
                                    Chosenindexes4['tot_oper_rev'] = "#000000";
                                    $("div#mychoice4 :checkbox").change(function () {
                                        indexname4 = $(this).val();
                                        if ($(this).is(':checked') == true) {
                                            colorname4 = NewColor();
                                            console.log(this);
                                            Chosenindexes4.push(indexname4);
                                            Chosenindexes4[indexname4] = colorname4;
                                            $("#d_" + indexname4).css("background-color", colorname4);
                                            console.log(Chosenindexes4);
                                        }
                                        else {
                                            Chosenindexes4.remove(indexname4);
                                            console.log(Chosenindexes4);
                                            $("#d_" + indexname4).css("background-color", "white");
                                        }
                                        RequestChart4();
                                        RequestTable4();
                                        set_time4();
                                    });
                                </script>
                                <!--时间控制框-->
                                <script>
                                    var starttime4 = "19911231";
                                    var endtime4 = "20161231";
                                    $(".form_datetime").datetimepicker({
                                        format: 'yyyy-mm-dd ',
                                        startView: 4,
                                        minView: 4,
                                        maxView: 4,
                                        autoclose: true,
                                        pickerPosition: 'top-right'
                                    });
                                    $('#starttime4').datetimepicker('setStartDate', '1991-12-31');
                                    $('#starttime4').datetimepicker('setEndDate', '2016-12-31');
                                    $('#endtime4').datetimepicker('setStartDate', '1991-12-31');
                                    $('#endtime4').datetimepicker('setEndDate', '2016-12-31');
                                    $('#starttime4')
                                        .datetimepicker()
                                        .on('changeDate', function (ev) {
                                            starts = ev.date.Format("yyyy年Q4");
                                            option.dataZoom[0].startValue = starts;
                                            myChart4.setOption(option);
                                            RequestTable4();
                                        });
                                    $('#endtime4')
                                        .datetimepicker()
                                        .on('changeDate', function (ev) {
                                            ends = ev.date.Format("yyyy年Q4");
                                            option.dataZoom[0].endValue = ends;
                                            myChart4.setOption(option);
                                            RequestTable4();
                                        });
                                    Date.prototype.Format = function (fmt) { //author: meizz
                                        var o = {
                                            "M+": this.getMonth() + 1, //月份
                                            "d+": this.getDate(), //日
                                            "h+": this.getHours(), //小时
                                            "m+": this.getMinutes(), //分
                                            "s+": this.getSeconds(), //秒
                                            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
                                            "S": this.getMilliseconds() //毫秒
                                        };
                                        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
                                        for (var k in o)
                                            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
                                        return fmt;
                                    }
                                    function dateformat(olddate) {
                                        newdate = []
                                        for (i = 0; i < olddate.length; i++) {
                                            var str = olddate[i];
                                            var reg = /1231/g;
                                            str = str.replace(reg, '年Q4');
                                            newdate.push(str)
                                        }
                                        return newdate
                                    }
                                </script>
                                <!--单位转换-->
                                <script>
                                    denominator4 = 1
                                    $("select#unit4").change(function () {
                                        flag = $(this).val();
                                        if (flag == "0") {
                                            denominator4 = 1;
                                            RequestChart4();
                                            CreateTable4();
                                            set_time4();
                                        }
                                        if (flag == "1") {
                                            denominator4 = 1000;
                                            RequestChart4();
                                            CreateTable4();
                                            set_time4();
                                        }
                                    });
                                    function numfilter4(oldnum) {
                                        newnum = []
                                        for (i = 0; i < oldnum.length; i++) {
                                            temp = oldnum[i] / denominator4;
                                            newnum.push(temp.toFixed(2))
                                        }
                                        return newnum;
                                    }
                                </script>
                                <!--面板切换-->
                                <script>
                                    $("#mydropdown").on("click", "[data-stopPropagation]", function (e) {
                                        e.stopPropagation();
                                    })
                                </script>
                                <!--随机生成颜色-->
                                <script>
                                    function NewColor() {
                                        var colorElements = "0,1,2,3,4,5,6,7,8,9,a,b,c,d,e,f";
                                        var colorArray = colorElements.split(",");
                                        var color = "#";
                                        for (var i = 0; i < 6; i++) {
                                            color += colorArray[Math.floor(Math.random() * 16)];
                                        }
                                        return color;
                                    }
                                </script>
                                <!--删除函数-->
                                <script>
                                    Array.prototype.indexOf = function (val) {
                                        for (var i = 0; i < this.length; i++) {
                                            if (this[i] == val) return i;
                                        }
                                        return -1;
                                    };
                                    Array.prototype.remove = function (val) {
                                        var index = this.indexOf(val);
                                        if (index > -1) {
                                            this.splice(index, 1);
                                        }
                                    };
                                </script>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    </div>
{% endblock %}

{% block scripts %}

{% endblock %}
