{% extends "main/homepage_base.html" %}
{% block heading %}用户登录{% endblock %}
{% block form %}
    <form action="{{ url_for('.login') }}" method="POST">
        {{ form.hidden_tag() }}
        <div class="form-group">
            {% if form.username.errors %}
                {% for e in form.username.errors %}
                    <p class="help-block">{{ e }}</p>
                {% endfor %}

            {% endif %}
            <br>
            {{ form.username(class_='form-control input-lg',placeholder="请输入用户名：") }}
            <!--,placeholder="test"添加了好看的输入框提示效果-->
        </div>
        <div class="form-group">
            {% if form.password.errors %}
                {% for e in form.password.errors %}
                    <p class="help-block">{{ e }}</p>
                {% endfor %}
            {% endif %}
            {{ form.password(class_='form-control input-lg',placeholder="请输入密码：") }}
        </div>
        <div class="form-group">
            <font size="3">记住我的登录状态:</font>
            <span>{{ form.remember }}</span>
            <!--换行来排版-->
            {#                        <span><a href="newforgot.html">忘记密码？</a></span>#}
            <!--换行来排版-->       <br>
        </div>
        <input class="btn btn-info btn-lg btn-block" type="submit" value="立即登录">
        <!--换行来排版-->       <br>
    </form>
{% endblock %}

{% block register_number %}
    <form method="POST" action="{{ url_for('.register') }}">
        {{ register_form.hidden_tag() }}
        <div class="form-group">
            {% if register_form.username.errors %}
                {% for e in register_form.username.errors %}
                    <p class="help-block">{{ e }}</p>
                {% endfor %}
            {% endif %}
            <br>
            {{ register_form.username(class_='form-control input-lg',placeholder="请输入用户名：") }}
        </div>
        <div class="form-group">
            {% if register_form.password.errors %}
                {% for e in register_form.password.errors %}
                    <p class="help-block">{{ e }}</p>
                {% endfor %}
            {% endif %}
            {{ register_form.password(class_='form-control input-lg',placeholder="请输入密码：") }}
        </div>
        <div class="form-group">
            {% if register_form.confirm.errors %}
                {% for e in register_form.confirm.errors %}
                    <p class="help-block">{{ e }}</p>
                {% endfor %}
            {% endif %}
            {{ register_form.confirm(class_='form-control input-lg',placeholder="请再次输入密码：") }}
        </div>
        <input class="btn btn-success btn-lg btn-block" type="submit" value="立即注册">
    </form>
{% endblock %}

{% block register_phone %}
    <form>
        <div class="form-group">
            <input type="text" id="phone_number" class='form-control input-lg' placeholder="请输入手机号">
        </div>
        <div class="form-group">
            <input type="text" id="password1" class='form-control input-lg' placeholder="请输入密码">
        </div>
        <div class="form-group">
            <input type="text" id="confirm_password1" class='form-control input-lg' placeholder="确认密码">
        </div>
        <div class="form-group">
            <input type="text" id="Verification_code" class='form-control input-lg' placeholder="手机验证码">
        </div>
        <div class="form-group">
            <button id="get_Verification_code" class="btn btn-success btn-lg btn-block">获取验证码</button>
        </div>
        <div class="form-group">
            <button id="register_phone1" class="btn btn-success btn-lg btn-block">注册</button>
        </div>
    </form>
    <script>
        {#    发送验证码#}
        $("#get_Verification_code").click(function () {
            phone_number = document.getElementById("phone_number").value
            if (phone_number === "") {
                alert('手机号码不能为空')
            }
            else {
                this.disabled = 'disabled';
                setTimeout(function () {
                    btn.disabled = '';
                }, 60000);//1秒后才能点击
                $.ajax({
                    type: 'GET',
                    url: '{{url_for("main.send_Verification_code")}}',
                    data: {
                        'phone_number': phone_number,
                    },
                    dataType: 'json',
                    success: function (data) {
                        console.log(data)
                        if (data.exit == 'flase') {
                            alert('短信已发送')
                        }
                        else {
                            alert('该号码已经注册！')
                        }
                    }
                })
            }
        })
        {# 注册 #}
        $("#register_phone1").click(function () {

            phone_number = document.getElementById("phone_number").value
            password = document.getElementById("password1").value
            confirm_password = document.getElementById("confirm_password1").value
            Verification_code = document.getElementById("Verification_code").value
            if (phone_number === "") {
                alert('手机号码不能为空')
            }
            else {
                if (password == confirm_password) {
                    $.ajax({
                        type: 'GET',
                        url: '{{url_for("main.register_phone")}}',
                        data: {
                            'phone_number': phone_number,
                            'password': password,
                            'confirm_password': confirm_password,
                            'Verification_code': Verification_code,
                        },
                        dataType: 'json',
                        success: function (data) {
                            if (data.msg == 'success') {
                                alert('注册成功！')
                            }
                            else {
                                alert('注册失败！')
                            }

                        }
                    })
                }
                else {
                    alert('两次密码不一致！')
                }
            }
        })
    </script>
{% endblock %}
