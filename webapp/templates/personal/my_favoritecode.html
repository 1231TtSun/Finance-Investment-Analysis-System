{% extends "stock_base.html" %}
{% block current_user %}
    当前用户：{{ current_user.username }}
{% endblock %}

{% block body %}
    {#    this is the body part#}
    <div class="span9">
        <div class="content">
            <div class="btn-controls">
                <div class="btn-box-row row-fluid">
                    <a href="#" class="btn-box big span4"><i class=" icon-random"></i><b>65%</b>
                        <p class="text-muted">
                            我关注的股票</p>
                    </a><a href="#" class="btn-box big span4"><i class="icon-user"></i><b>15</b>
                    <p class="text-muted">
                        New Users</p>
                </a><a href="#" class="btn-box big span4"><i class="icon-money"></i><b>15,152</b>
                    <p class="text-muted">
                        Profit</p>
                </a>
                </div>
                <div class="btn-box-row row-fluid">
                    <div class="span8">
                        <div class="row-fluid">
                            <div class="span12">
                                <a class="btn-box small span4" id="hyfb"><i class="icon-envelope"></i><b>行业分布</b>
                                </a><a id="dqfb" class="btn-box small span4"><i class="icon-group"></i><b>地区分布</b>
                            </a><a id="sssj" class="btn-box small span4"><i class="icon-exchange"></i><b>上市时间分布</b>
                            </a>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <!--/#btn-controls-->
            <div class="module">
                <div id="div_hyfb" style="display:none;" class="fb">
                    <div class="module-head">
                        <h3>
                            行业分布图</h3>
                    </div>
                    <div class="module-body">
                        <div class="chart inline-legend grid">
                            <div id="placeholder2" class="graph" style="height: 500px">
                            </div>
                        </div>
                    </div>
                </div>
                <div id="div_dqfb" style="display:none;" class="fb">
                    <div class="module-head">
                        <h3>
                            地区分布图</h3>
                    </div>
                    <div class="module-body">
                        <div class="chart inline-legend grid">
                            <div id="placeholder2" class="graph" style="height: 500px">
                            </div>
                        </div>
                    </div>
                </div>
                <div id="div_sssj" style="display:none;" class="fb">
                    <div class="module-head">
                        <h3>
                            上市时间分布</h3>
                    </div>
                    <div class="module-body">
                        <div class="chart inline-legend grid">
                            <div id="placeholder2" class="graph" style="height: 500px">
                            </div>
                        </div>
                    </div>
                </div>

                <div id="div_gpdb" class="fb">
                    <div class="module-head">
                        <h3>
                            股票对比</h3>
                    </div>
                    <div class="module-body">
                        <div class="chart inline-legend grid">
                            <div id="placeholder2" class="graph" style="height: 500px">
                                {#                                左侧#}
                                {#                                <div id="checkbox"#}
                                {#                                     style="height:400px;overflow-y :auto;margin-top:2%;width: 20%;float: left">#}
                                {#                                    <legend>对比股票</legend>#}
                                {#                                    <fieldset style='padding:0;' id="code_show">#}
                                {##}
                                {##}
                                {#                                    </fieldset>#}
                                {#                                </div>#}
                                {#                            右侧#}
                                <div id="echart1"
                                     style="width: 100%;height:400px;margin-left:20px;margin-top: 2%;float: left">

                                </div>
                                {#                            底部#}
                                <div id="echartindex1"
                                     style="height:50px;width:100%;margin-top: 20px;float: left">
                                    <div style="height:25px;margin-top: 10px">
                                        <a style="width:50px;margin-left:10px;color: #0c0c0c">起始时间:</a><input
                                            type="text" id="ui3"
                                            style="background-color:white;width: 100px;margin-left: 10px"/>
                                        <a style="width:50px;margin-left:10px;color: #0c0c0c">结束时间:</a><input
                                            type="text" id="ui4"
                                            style="background-color:white;width: 100px;margin-left: 10px"/>
                                        <a style="width:50px;margin-left:10px;color: #0c0c0c">单位:</a>
                                        <select id="unit" style="width:100px">
                                            <option value="100000000">亿</option>
                                            <option value="1000000000">十亿</option>
                                            <option value="10000000">千万</option>
                                            <option value="1">元</option>
                                            {#                <option value="audi">Audi</option>#}
                                        </select>
                                        <a style="width:50px;margin-left:10px;color: #0c0c0c">年份排序:</a>
                                        <select id="yearorder" style="width:100px">
                                            <option value="asc">升序</option>
                                            <option value="desc">降序</option>
                                        </select>
                                        <a style="width:50px;margin-left:10px;color: #0c0c0c">指标选择:</a>
                                        <select id="index_select" style="width:100px">

                                        </select>
                                    </div>

                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            {#            <div class="module">#}
            {#                <div class="module-head">#}
            {#                    <h3>#}
            {#                        我关注的股票</h3>#}
            {#                </div>#}
            {#                <div class="module-body table">#}
            {#                    <table cellpadding="0" cellspacing="0" border="0"#}
            {#                           class="datatable-1 table table-bordered table-striped	 display"#}
            {#                           width="100%">#}
            {#                        <thead>#}
            {#                        <tr>#}
            {#                            <th>#}
            {#                                股票代码#}
            {#                            </th>#}
            {#                            <th>#}
            {#                                股票名称#}
            {#                            </th>#}
            {#                            <th>#}
            {#                                最新价格#}
            {#                            </th>#}
            {#                            <th>#}
            {#                                涨跌幅#}
            {#                            </th>#}
            {#                            <th>#}
            {#                                关注人数#}
            {#                            </th>#}
            {#                        </tr>#}
            {#                        </thead>#}
            {#                        <tbody id="tbody">#}
            {#                        </tbody>#}
            {#                    </table>#}
            {#                </div>#}
            {#            </div>#}
            <!--/.module-->
        </div>
        <!--/.content-->
    </div>
    <!--右侧固定导航栏-->
    <div class="J-global-toolbar">
        <div class="toolbar-wrap J-wrap">
            <div class="toolbar">
                <div class="toolbar-panels J-panel">
                    <div style="visibility: hidden;"
                         class="J-content toolbar-panel tbar-panel-cart toolbar-animate-out">
<div style="float:left;width: 100px">
                <legend>关注股票列表</legend>
                <div style='width:280px;height: 600px;overflow-y: auto' >
                    <table id="mytable">
                        <thead>
                        <tr>
                            <th>
                                编</br>号
                            </th>
                            <th>
                                名</br>称
                            </th>
                            <th>
                                最</br>新</br>价</br>格
                            </th>
                            <th>
                                涨</br>跌</br>幅
                            </th>
                            <th>
                                关</br>注</br>人</br>数
                            </th>
                        </tr>
                        </thead>
                        <tbody id="tbody">
                        </tbody>
                    </table>

                </div>
            </div>

                    </div>
                </div>

                <div class="toolbar-header"></div>

                <div class="toolbar-tabs J-tab">
                    <div class="toolbar-tab tbar-tab-cart" style="height:35px">
                        <i class="tab-ico"></i>
                        <img src="/static/5_24.png" style="margin-top: 7px;margin-left: 2px">
                        <em class="tab-text ">股票列表</em>
                    </div>

                </div>

                {#                <div class="toolbar-footer">#}
                {#                    <div class="toolbar-tab tbar-tab-top"><a href="#"> <i class="tab-ico  "></i> <em#}
                {#                            class="footer-tab-text">顶部</em> </a></div>#}
                {#                </div>#}


            </div>


        </div>
    </div>
    <script>
        var code_list = new Array();

        var name_list = new Array();

        var color = new Array();

        var order = ''
        var myChart1 = echarts.init(document.getElementById('echart1'));
        var selectedindex = new Array()
        var Uint = 1

        var indexdictionary = {
            '营业总收入': 'tot_oper_rev',
            '营业总成本': 'tot_oper_cost',
            '息税前利润率': 'ebit_rate',
            '财务费用': 'fin_exp_is',
            '利润总额': 'tot_profit',
            '净利润（总额）': 'net_profit_is',
            '净利润（股东）': 'wgsd_net_inc',
            '资产总计': 'tot_assets',
            '流动资产合计': 'tot_cur_assets',
            '非流动资产合计': 'tot_non_cur_assets',
            '负债合计': 'tot_liab',
            '流动负债合计': 'tot_cur_liab',
            '非流动负债合计': 'tot_non_cur_liab',
            '归属母公司股东权益': 'wgsd_com_eq',
            '经营活动现金净流量': 'operatecashflow_ttm2',
            '投资活动现金净流量': 'investcashflow_ttm2',
            '筹资活动现金净流量': 'financecashflow_ttm2',
            '现金净流量(TTM)': 'cashflow_ttm2',
            '货币资金': 'monetary_cap',
            '销售毛利率': 'grossprofitmargin',
            '投入资本回报率': 'roic',
            '营业周期': 'turndays',
            '存货周转天数': 'invturndays',
            '应收账款周转天数': 'arturndays',
            '应付账款周转天数': 'apturndays'
        }

        function get_selected(selected_cn) {
            if (selected_cn == '营业总收入')
                return 'tot_oper_rev'
            else if (selected_cn == '营业总成本')
                return 'tot_oper_cost'
            else if (selected_cn == '息税前利润率')
                return 'ebit_rate'
            else if (selected_cn == '财务费用')
                return 'fin_exp_is'
            else if (selected_cn == '利润总额')
                return 'tot_profit'
            else if (selected_cn == '净利润（总额）')
                return 'net_profit_is'
            else if (selected_cn == '净利润（股东）')
                return 'wgsd_net_inc'
            else if (selected_cn == '资产总计')
                return 'tot_assets'
            else if (selected_cn == '流动资产合计')
                return 'tot_cur_assets'
            else if (selected_cn == '非流动资产合计')
                return 'tot_non_cur_assets'
            else if (selected_cn == '负债合计')
                return 'tot_liab'
            else if (selected_cn == '流动负债合计')
                return 'tot_cur_liab'
            else if (selected_cn == '非流动负债合计')
                return 'tot_non_cur_liab'
            else if (selected_cn == '归属母公司股东权益')
                return 'wgsd_com_eq'
            else if (selected_cn == '经营活动现金净流量')
                return 'operatecashflow_ttm2'
            else if (selected_cn == '投资活动现金净流量')
                return 'investcashflow_ttm2'
            else if (selected_cn == '筹资活动现金净流量')
                return 'financecashflow_ttm2'
            else if (selected_cn == '现金净流量(TTM)')
                return 'cashflow_ttm2'
            else if (selected_cn == '货币资金')
                return 'monetary_cap'
            else if (selected_cn == '销售毛利率')
                return 'grossprofitmargin'
            else if (selected_cn == '投入资本回报率')
                return 'roic'
            else if (selected_cn == '营业周期')
                return 'turndays'
            else if (selected_cn == '存货周转天数')
                return 'invturndays'
            else if (selected_cn == '应收账款周转天数')
                return 'arturndays'
            else if (selected_cn == '应付账款周转天数')
                return 'apturndays'
        }

        function post_selected(selected_cn) {
            if (selected_cn == 'tot_oper_rev')
                return '营业总收入'
            else if (selected_cn == 'tot_oper_cost')
                return '营业总成本'
            else if (selected_cn == 'fin_exp_is')
                return '财务费用'
            else if (selected_cn == 'ebit_rate')
                return '息税前利润率'
            else if (selected_cn == 'tot_profit')
                return '利润总额'
            else if (selected_cn == 'net_profit_is')
                return '净利润（总额）'
            else if (selected_cn == 'wgsd_net_inc')
                return '净利润（股东）'
            else if (selected_cn == 'tot_assets')
                return '资产总计'
            else if (selected_cn == 'tot_cur_assets')
                return '流动资产合计'
            else if (selected_cn == 'tot_non_cur_assets')
                return '非流动资产合计'
            else if (selected_cn == 'tot_liab')
                return '负债合计'
            else if (selected_cn == 'tot_cur_liab')
                return '流动负债合计'
            else if (selected_cn == 'tot_non_cur_liab')
                return '非流动负债合计'
            else if (selected_cn == 'wgsd_com_eq')
                return '归属母公司股东权益'
            else if (selected_cn == 'operatecashflow_ttm2')
                return '经营活动现金净流量'
            else if (selected_cn == 'investcashflow_ttm2')
                return '投资活动现金净流量'
            else if (selected_cn == 'financecashflow_ttm2')
                return '筹资活动现金净流量'
            else if (selected_cn == 'cashflow_ttm2')
                return '现金净流量(TTM)'
            else if (selected_cn == 'monetary_cap')
                return '货币资金'
            else if (selected_cn == 'grossprofitmargin')
                return '销售毛利率'
            else if (selected_cn == 'roic')
                return '投入资本回报率'
            else if (selected_cn == 'turndays')
                return '营业周期'
            else if (selected_cn == 'invturndays')
                return '存货周转天数'
            else if (selected_cn == 'arturndays')
                return '应收账款周转天数'
            else if (selected_cn == 'apturndays')
                return '应付账款周转天数'
        }

        function getunitname(uint) {
            if (uint / 10000000 == 1) {
                return '千万'
            }
            else if (uint / 10000000 == 10) {
                return '亿'
            }
            else if (uint / 10000000 == 100) {
                return '十亿'
            }
            else if (uint / 1 == 1) {
                return '元'
            }
        }

        function set_timepicker(start, end) {
            document.getElementById('ui3').value = start
            document.getElementById('ui4').value = end
        }


        {#        对比指标生成&&关注股票列表生成#}
        function creat_select_option() {
            for (var key in indexdictionary) {
                $("#index_select").append("<option  value='" + indexdictionary[key] + "' id='" + indexdictionary[key] + "'>" + key + "</option>")
            }
            for (i = 0; i < code_list.length; i++) {
                $("#code_show").append(
                        "<div style='width:100%;height:30px;margin-top:10px;background-color:lightgray' class='divcheckbox'>" +
                        "<div class='checkbox' style='width:80%;height:20px;float:left;margin-left:25px'>" +
                        "<input type='checkbox' class='checkbox' value='" + name_list[i] + "' id='" + code_list[i] + "' >" + name_list[i] +
                        "<div id='div_" + code_list[i] + "' style='height: 10px;width: 10px;float: right;margin: 5px'></div> " +
                        "</div>" +
                        "</div>")
            }
        }

        function creatdatatable() {
            $.ajax({
                type: 'POST',
                url: '{{url_for("restfulapi.search")}}',
                data: {
                    'code': '000001',
                },
                dataType: 'json',
                async: false,
                success: function (data) {
                    console.log(data)
                    code_list = data.code_list
                    name_list = data.name_list
                    for (i = 0; i < data.code_list.length; i++) {
                        str = "<tr ><td>" + data.code_list[i] + "</td" +
                                "><td>" + data.name_list[i] + "</td>" +
                                "<td>暂无</td>" +
                                "<td >暂无 </td>" +
                                "<td >" + data.count_list[i] + " </td></tr>"
                        $("#tbody").append(str)
                    }
                    var table = $('#mytable').DataTable({
                        {#                        "info": false,#}
                        {#                        "processing": true,#}
                        {#                        "scrollX": true,#}
                        {#                        "searching": true,#}
                        {#                        "fixedColumns": { //固定列的配置项#}
                        {#                            "leftColumns": 1//固定左边第一列#}
                        {#                        },#}
                        "columnDefs": [
                            {"width": 30, "targets": 0},
                                {"width": 30, "targets": 0},
                                {"width": 30, "targets": 0},
                                {"width": 30, "targets": 0},
                                {"width": 30, "targets": 0},
                        ],
                        "language": {
                            "emptyTable": "没有数据",
                            "loadingRecords": "加载中…",
                            "processing": "查询中…",
                            "search": "检索:",
                            "lengthMenu": "每页 _MENU_ 条",
                            "zeroRecords": "没有数据",
                            "paginate": {
                                "first": "第一页",
                                "last": "最后一页",
                                "next": "",
                                "previous": ""
                            },
                            "info": "第 _PAGE_ 页 / 总 _PAGES_ 页",
                            "infoEmpty": "没有数据",
                            "infoFiltered": "(过滤总件数 _MAX_ 条)"
                        },

                    })
                }
            })
        }


        $(document).ready(function () {
            function createchart(stock_code_list, unit, dzstart, dend) {
                var legenddata1 = new Array();
                var seriesdata1 = [];
                var result = {};
                var aAxisdata1 = new Array();
                for (k = 0; k < stock_code_list.length; k++) {
                    $.ajax({
                        type: 'POST',
                        url: '{{url_for("restfulapi.get_ajax_compare")}}',
                        data: {
                            'code': stock_code_list[k],
                            'date': ['1991', '2016'],
                            'index': selectedindex
                        },
                        dataType: 'json',
                        success: function (data) {
                            if (order == 'desc') {
                                for (i = 0; i < data.indexs.length; i++) {
                                    legenddata1.push(data.the_name)
                                    index_title = post_selected(data.indexs[i])
                                }
                                aAxisdata1 = data.the_year_list
                                for (i = 0; i < data.indexs.length; i++) {
                                    str = "data." + data.indexs[i]
                                    value = eval(str)
                                    var value2 = [];
                                    for (var j = 0; j < value.length; j++) {
                                        value2.push((value[j] / unit).toFixed(2))
                                    }
                                    result = {
                                        name: data.the_name,
                                        type: 'line',
                                        smooth: true,
                                        {#                                    itemStyle: {#}
                                        {#                                        normal: {#}
                                        {#                                            color: color[data.the_code],#}
                                        {#                                            lineStyle: {#}
                                        {#                                                color: color[data.the_code]#}
                                        {#                                            },#}
                                        {#                                        }#}
                                        {#                                    },#}
                                        symbolSize: 8,
                                        data: value2
                                    }
                                    seriesdata1.push(result)
                                }
                                option = {
                                    title: {
                                        text: "对比数据:" + index_title + "（单位：" + getunitname(unit) + "）"
                                    },
                                    tooltip: {
                                        trigger: 'axis'
                                    },
                                    legend: {
                                        type: 'scroll',
                                        orient: 'vertical',
                                        left: 5,
                                        top: 50,
                                        width: 80,
                                        bottom: 20,
                                        data: legenddata1
                                    },
                                    grid: {
                                        left: 100,
                                        right: '4%',
                                        bottom: '3%',
                                        containLabel: true
                                    },
                                    toolbox: {

                                        feature: {
                                            saveAsImage: {},
                                            magicType: {
                                                type: ['line', 'bar', 'stack', 'tiled']
                                            }
                                        }
                                    },
                                    xAxis: {
                                        type: 'category',
                                        boundaryGap: false,
                                        axisTick: {
                                            show: false
                                        },
                                        data: aAxisdata1,
                                    },
                                    yAxis: {
                                        type: 'value',
                                        axisTick: {
                                            show: false
                                        },
                                    },
                                    dataZoom: [
                                        {
                                            {#                                id: 'dataZoomX',#}
                                            type: 'slider',
                                            xAxisIndex: [0],
                                            height: 20,
                                            filterMode: 'filter',
                                            {#                                show : true,#}
                                            startValue: dzstart,
                                            endValue: dend,
                                        },

                                    ],
                                    series: seriesdata1
                                };
                                myChart1.setOption(option, true);
                                myChart1.on('dataZoom', function (params) {
                                    var nendyear = 2016 - Math.ceil(params.start / 100 * 25)
                                    if (Math.ceil(1 - params.end / 100)) {
                                        var nstartyear = 1991 + Math.ceil((1 - params.end / 100) * 25) - 1
                                    }
                                    else {
                                        var nstartyear = '1991'
                                    }
                                    set_timepicker(nstartyear, nendyear)
                                });
                            }
                            else if (order == 'asc') {
                                for (i = data.indexs.length - 1; i >= 0; i--) {
                                    legenddata1.push(data.the_name)
                                    index_title = post_selected(data.indexs[i])
                                }

                                aAxisdata1 = data.the_year_list.sort()

                                for (i = data.indexs.length - 1; i >= 0; i--) {
                                    str = "data." + data.indexs[i]
                                    value = eval(str)
                                    var value2 = [];
                                    for (var j = value.length - 1; j >= 0; j--) {
                                        value2.push((value[j] / unit).toFixed(2))
                                    }
                                    result = {
                                        name: data.the_name,
                                        {#                                        + "(" + post_selected(data.indexs[i]) + ")"#}
                                        type: 'line',
                                        smooth: true,
                                        symbolSize: 8,
                                        {#                                    itemStyle: {#}
                                        {#                                        normal: {#}
                                        {#                                            color: color[data.the_code],#}
                                        {#                                            lineStyle: {#}
                                        {#                                                color: color[data.the_code]#}
                                        {#                                            }#}
                                        {#                                        }#}
                                        {#                                    },#}
                                        data: value2
                                    }
                                    seriesdata1.push(result)
                                }
                                option = {
                                    title: {
                                        text: "对比指标:" + index_title + "（单位：" + getunitname(unit) + "）"
                                    },
                                    tooltip: {
                                        trigger: 'axis'
                                    },
                                    legend: {
                                        type: 'scroll',
                                        orient: 'vertical',
                                        left: 5,
                                        top: 50,
                                        bottom: 20,
                                        width: 80,
                                        data: legenddata1
                                    },
                                    grid: {
                                        left: 100,
                                        right: '4%',
                                        bottom: '3%',
                                        containLabel: true
                                    },
                                    toolbox: {

                                        feature: {
                                            saveAsImage: {},
                                            magicType: {
                                                type: ['line', 'bar', 'stack', 'tiled']
                                            }
                                        }
                                    },
                                    xAxis: {
                                        type: 'category',
                                        boundaryGap: false,
                                        axisTick: {
                                            show: false
                                        },
                                        data: aAxisdata1,
                                    },
                                    yAxis: {
                                        type: 'value',
                                        axisTick: {
                                            show: false
                                        },
                                    },
                                    dataZoom: [
                                        {
                                            {#                                id: 'dataZoomX',#}
                                            type: 'slider',
                                            xAxisIndex: [0],
                                            height: 20,
                                            filterMode: 'filter',
                                            {#                                show : true,#}
                                            startValue: dzstart,
                                            endValue: dend,
                                        },

                                    ],
                                    series: seriesdata1
                                };
                                myChart1.setOption(option, true);
                                myChart1.on('dataZoom', function (params) {
                                    var nstartyear = 1991 + Math.ceil(params.start / 100 * 25)
                                    var nendyear = 1991 + Math.ceil(params.end / 100 * 25) - 1
                                    set_timepicker(nstartyear, nendyear)
                                });
                            }

                        }
                    })

                }
            }

            function first_visit() {
                {# 首次访问，填充datatable   #}
                creatdatatable()
                {# 绘制对比图#}
                creat_select_option()
                Uint = 100000000
                order = 'asc'
                selectedindex = ['tot_oper_rev']
                set_timepicker('2010-q4', '2016-q4')
                createchart(code_list, Uint, '2010', '2016')

            }


            first_visit()
            $('select#index_select').change(function () {
                var unit = document.getElementById("unit").value;
                var dzstartyear = $('#ui3').val().substring(0, 4)
                var dzendyear = $('#ui4').val().substring(0, 4)
                order = document.getElementById("yearorder").value;
                Uint = unit
                selectedindex = []
                selectedindex.push(document.getElementById("index_select").value)
                createchart(code_list, Uint, dzstartyear, dzendyear)
                {#                if (!$(this).is(':checked')) {// 取消 用于记录-无用#}
                {#                    var unit = document.getElementById("unit").value;#}
                {#                    var dzstartyear = $('#ui3').val().substring(0, 4)#}
                {#                    var dzendyear = $('#ui4').val().substring(0, 4)#}
                {##}
                {#                    selectedindex = []#}
                {#                    createchart(code_list, unit, dzstartyear, dzendyear)#}
                {##}
                {##}
                {#                }#}
                {#                else {#}
                {#                    var unit = document.getElementById("unit").value;#}
                {#                    var dzstartyear = $('#ui3').val().substring(0, 4)#}
                {#                    var dzendyear = $('#ui4').val().substring(0, 4)#}
                {#                    $("input[type=checkbox]").each(function () {#}
                {#                        $(this).iCheck('uncheck');#}
                {#                    })#}
                {#                    $(this).iCheck('check')#}
                {#                    selectedindex = []#}
                {#                    selectedindex.push($(this).attr('value'))#}
                {#                    Uint = unit#}
                {#                    createchart(code_list, Uint, dzstartyear, dzendyear)#}

                {#            }#}
            })
            $("#ui3").datepicker({
                changeYear: true,
                dateFormat: 'yy',
                showButtonPanel: true,
                yearRange: "1991:2016",

                onClose: function (dateText, inst) {
                    var year = $("#ui-datepicker-div .ui-datepicker-year option:selected").val();//得到选中的年份值
                    $('#ui3').val(year + '-q4');
                    var unit = document.getElementById("unit").value;
                    var dzstartyear = $('#ui3').val().substring(0, 4)
                    var dzendyear = $('#ui4').val().substring(0, 4)
                    Uint = unit
                    createchart(code_list, Uint, dzstartyear, dzendyear)
                }
            });
            $("#ui4").datepicker({
                changeYear: true,
                dateFormat: 'yy',
                showButtonPanel: true,
                yearRange: "1991:2016",
                onClose: function (dateText, inst) {
                    var year = $("#ui-datepicker-div .ui-datepicker-year option:selected").val();//得到选中的年份值
                    $('#ui4').val(year + '-q4');//给input赋值，其中要对月值加1才是实际的月份
                    var unit = document.getElementById("unit").value;
                    var dzstartyear = $('#ui3').val().substring(0, 4)
                    var dzendyear = $('#ui4').val().substring(0, 4)
                    Uint = unit
                    createchart(code_list, Uint, dzstartyear, dzendyear)
                }
            });
            $("select#unit").change(function () {
                var unit = document.getElementById("unit").value;
                var dzstartyear = $('#ui3').val().substring(0, 4)
                var dzendyear = $('#ui4').val().substring(0, 4)
                Uint = unit
                createchart(code_list, Uint, dzstartyear, dzendyear)
            });
            $("select#yearorder").change(function () {
                var unit = document.getElementById("unit").value;
                var dzstartyear = $('#ui3').val().substring(0, 4)
                var dzendyear = $('#ui4').val().substring(0, 4)
                order = document.getElementById("yearorder").value;
                Uint = unit
                {#                option.dataZoom[0].startValue = dzstartyear#}
                {#                option.dataZoom[0].endValue = dzendyear#}
                {#                myChart1.setOption(option)#}
                createchart(code_list, Uint, dzstartyear, dzendyear)
            });
            $("#hyfb").click(function () {
                $(".fb").hide()
                $("#div_hyfb").toggle();

            });
            $("#dqfb").click(function () {
                $(".fb").hide()
                $("#div_dqfb").toggle();
            });
            $("#sssj").click(function () {
                $(".fb").hide()
                $("#div_sssj").toggle();
            });

        })
    </script>
{% endblock %}